
<!DOCTYPE html>
<html lang="en">   
    
    <head>

        <meta charset="UTF-8">
        <title>2ⁿ</title>
        <meta lang="en">
        <meta name="viewport" content="width=device-width, height=device-height, initial-scale=1.0, shrink-to-fit=no, viewport-fit=cover">
        <link rel="icon" type="image/svg+xml" href="favicon.svg"/>
        <link rel="icon" type="image/png" sizes="256x256" href="favicon.png"/>
        <meta name="theme-color" content="#000000"/>
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Exo+2:wght@500&display=swap" rel="stylesheet">
        <meta property="og:title" content="2ⁿ"/>
        <meta property="og:description" content="2ⁿ game">
        <meta property="twitter:title" content="2ⁿ"/>
        <meta property="twitter:description" content="2ⁿ game">
    
    </head>

    <style>

        :root {
            --accent-color: rgb(40, 40, 40);
            --background-color: white;
            --text-color: black;
            --pale-color: rgb(230, 230, 230);
            --box-background: rgb(255, 255, 255);
            --box-size: 60px;
            --box-margin: 5px;
            --box-scale: scale(0.98);
            --box-border-radius: 6px;
            --block-font-size: 24px;
            --block-transitions: top 120ms ease-in-out, left 120ms ease-in-out, transform 120ms ease-in-out, background-color 240ms ease-in-out, color 240ms ease-in-out;
            --play-board-background: rgb(40, 40, 40);
            --power1-color: rgb(182, 215, 168);
            --power2-color: rgb(147, 196, 125);
            --power3-color: rgb(106, 168, 79);
            --power4-color: rgb(234, 153, 153);
            --power5-color: rgb(224, 102, 102);
            --power6-color: rgb(204, 0, 0);
            --power7-color: rgb(159, 197, 232);
            --power8-color: rgb(111, 168, 220);
            --power9-color: rgb(61, 133, 198);
            --power10-color: rgb(249, 203, 156);
            --power11-color: rgb(246, 178, 107);
            --power12-color: rgb(230, 145, 56);
            --power13-color: rgb(180, 167, 214);
            --power14-color: rgb(142, 124, 195);
            --power15-color: rgb(103, 78, 167);
        }

        body {
            color: var(--text-color);
            overflow-x: hidden;
            background-color: var(--background-color);
            text-align: center;
            font-family: 'Exo 2', Arial;
        }

        input {
            font-family: inherit;
            color: inherit;
        }

        button {
            cursor: pointer;
            padding: 8px 12px;
            margin: 10px 16px;
            font-family: inherit;
            background-color: var(--accent-color);
            border-radius: 9px;
            border: none;
            color: var(--background-color);
            text-transform: uppercase;
            display: inline-flex;
            justify-content: center;
            align-items: center;
            user-select: none;
            transition: transform 60ms ease-in-out, outline 60ms ease-in-out;
        }

        hr {
            opacity: 0.5;
            margin: 5px 0;
            border: none;
            height: 3px;
            background-color: var(--text-color);
        }

        button:hover {
            filter: brightness(1.2);
        }

        button:active {
            outline: 3px solid var(--accent-color);
            outline-offset: 2px;
        }

        input[type=range] {
            cursor: grab;
        }

        input[type=number] {
            background-color: var(--pale-color);
            border: none;
            outline: none;
            border-bottom: 3px solid var(--text-color);
        }

        input[type=number]:focus {
            background-color: var(--background-color);
        }

        [id^=row] {
            display: flex;
        }

        [id$=-option] {
            padding: 12px 15px;
            display: flex;
            justify-content: center;
            align-items: center;
            text-align: center;
        }

        [id$=-fab] {
            position: fixed;
            padding: 12px;
            box-shadow: 5px 5px 8px 0px rgba(0,0,0,0.5);
        }

        .color-input-container:active {
            outline: 3px solid var(--accent-color);
            outline-offset: 2.5px;
        }

        .box {
            transform: var(--box-scale);
            margin: var(--box-margin);
            width: var(--box-size);
            height: var(--box-size);
            background-color: var(--box-background);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            border-radius: var(--box-border-radius);
        }

        .button-svg {
            vertical-align: middle;
            margin-right: 5px;
        }

        .block {
            font-size: var(--block-font-size);
            z-index: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            position: absolute;
            width: var(--box-size);
            height: var(--box-size);
            border-radius: var(--box-border-radius);
            background-color: var(--power1-color);
            color: white;
            transform: scale(0);
            transition: var(--block-transitions);
        }

        .expand-container {
            display: flex;
            flex-direction: column;
        }

        .expand-head-container {
            user-select: none;
            display: flex;
            align-items: center;
            cursor: pointer;
        }

        .expand-head-container:hover {
            filter: brightness(0.8);
        }

        .expand-title, .expand-svg {
            vertical-align: middles;
            margin: 10px;
        }

        .expand-svg {
            transition: transform 200ms ease-in-out;
        }

        .expand-animator {
            height: 0;
            overflow: hidden;
            transition: opacity 200ms linear, height 200ms ease-in-out;
        }

        .expand-content {
            padding: 5px 0 5px 0;
        }

        .range-option {
            padding: 12px 0;
            display: flex;
            align-items: center;
            justify-content: left;
        }

        .range-option .icon {
            width: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 10px;
            flex-shrink: 0;
        }

        .range-option .icon .color-preview {
            width: 40px;
            height: 40px;
            border-radius: 9px;
            background-color: black;
        }

        .range-option .value {
            padding: 0 10px;
            width: 100%;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            flex-direction: column;
        }

        .range-option .value .title {
            padding-bottom: 8px;
        }

        .range-option .value .input {
            width: 100%;
            display: flex;
            align-items: center;
        }

        .range-option .value .input .range {
            width: 100%;
        }

        .range-option .value .input .number {
            margin-left: 15px;
            flex-shrink: 0;
            width: 38px;
            text-align: left;
        }

        #game-area {
            margin: 6px 0;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        #play-fab {
            bottom: 25px;
            right: 25px;
        }

        #menu-fab{
            z-index: 4;
            left: 25px;
        }

        #play-board {
            user-select: none;;
            cursor: pointer;
            margin: 6px;
            border: var(--box-margin) solid var(--play-board-background);
            background-color: var(--play-board-background);
            width: -moz-fit-content;
            width: fit-content;
            height: -moz-fit-content;
            height: fit-content;
        }

        #game-score, #game-highest-score {
            font-weight: 500;
            font-size: 24px;
            padding: 5px 10px 5px 10px;
            transition: color 120ms ease-in-out;
        }

        #dimmer {
            display: none;
            position: fixed;
            z-index: 2;
            left: 0;
            right: 0;
            bottom: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.6);
            opacity: 0;
            transition: opacity 300ms linear;
        }

        #menu {
            padding: 10px;
            overflow-y: auto;
            border-radius: 9px 9px 0 0;
            z-index: 2;
            background-color: var(--background-color);
            position: fixed;
            height: calc(100% + 9px);
            margin: auto;
            transition: transform 300ms ease-in-out;
        }

        #game-container {
            padding-top: 10px;
            touch-action: pinch-zoom;
            position: fixed;
            left: 0;
            right: 0;
            top: 0;
            bottom: 0;
            margin: auto;
        }

        #splashscreen {
            z-index: 5;
            position: fixed;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
            height: 100%;
            background-color: rgb(40, 40, 40);
            left: 0;
            right: 0;
            bottom: 0;
            top: 0;
            margin: auto;
            transition: opacity 150ms linear;
        }

        #splash-block1, #splash-block2, #splash-block3, #splash-block4 {
            width: 65px;
            height: 65px;
            border-radius: 9px;
            background-color: white;
            box-shadow: 0 0 8px 0 rgba(0,0,0,0.6);
            position: absolute;
        }

        @keyframes splash-block1 {

            0% {
                z-index: 1;
                transform: translate(-46px, -46px) scale(1.2);
            }

            25% {
                z-index: 0;
                transform: translate(-46px, 46px) scale(0);
            }

            50% {
                z-index: 0;
                transform: translate(-46px, -46px) scale(0);
            }

            75% {
                z-index: 1;
                transform: translate(-46px, -46px) scale(1);
            }

            100% {
                z-index: 1;
                transform: translate(-46px, -46px) scale(1.2);
            }

        }

        @keyframes splash-block2 {

            0% {
                z-index: 1;
                transform: translate(-46px, 46px) scale(1);
            }

            25% {
                z-index: 1;
                transform: translate(-46px, 46px) scale(1.2);
            }

            50% {
                z-index: 0;
                transform: translate(46px, 46px) scale(0);
            }

            75% {
                transform: translate(-46px, 46px) scale(0);
            }

            100% {
                z-index: 1;
                transform: translate(-46px, 46px) scale(1);
            }

        }

        @keyframes splash-block3 {

            0% {
                z-index: 0;
                transform: translate(46px, 46px) scale(0);
            }

            25% {
                z-index: 1;
                transform: translate(46px, 46px) scale(1);
            }

            50% {
                z-index: 1;
                transform: translate(46px, 46px) scale(1.2);
            }

            75% {
                z-index: 0;
                transform: translate(46px, -46px) scale(0);
            }

            100% {
                z-index: 0;
                transform: translate(46px, 46px) scale(0);
            }

        }

        @keyframes splash-block4 {

            0% {
                z-index: 0;
                transform: translate(46px, -46px) scale(0);
            }

            25% {
                z-index: 0;
                transform: translate(46px, -46px) scale(0);
            }

            50% {
                z-index: 1;
                transform: translate(46px, -46px) scale(1);
            }

            75% {
                z-index: 0;
                transform: translate(46px, -46px) scale(1.2);
            }

            100% {
                transform: translate(-46px, -46px) scale(0);
                z-index: 0;
            }

        }

    </style>

    <body>

        <!-- relative elements -->
        <div id="game-container">
            <div class="range-option" style="justify-content: center; padding: 8px 0;">
                <div class="icon">
                    <svg xmlns="http://www.w3.org/2000/svg" height="34px" viewBox="0 0 24 24" width="34px" fill=var(--text-color)><path d="M0 0h24v24H0V0z" fill="none"/><path d="M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zm7.48 7.16l-5.01-.43-2-4.71c3.21.19 5.91 2.27 7.01 5.14zm-5.07 6.26L12 13.98l-2.39 1.44.63-2.72-2.11-1.83 2.78-.24L12 8.06l1.09 2.56 2.78.24-2.11 1.83.64 2.73zm-2.86-11.4l-2 4.72-5.02.43c1.1-2.88 3.8-4.97 7.02-5.15zM4 12c0-.64.08-1.26.23-1.86l3.79 3.28-1.11 4.75C5.13 16.7 4 14.48 4 12zm3.84 6.82L12 16.31l4.16 2.5c-1.22.75-2.64 1.19-4.17 1.19-1.52 0-2.94-.44-4.15-1.18zm9.25-.65l-1.11-4.75 3.79-3.28c.14.59.23 1.22.23 1.86 0 2.48-1.14 4.7-2.91 6.17z"/></svg>
                </div>
                <div class="value" style="width: auto; font-size: 20px;">
                    <div class="title" style="padding-bottom: 5px;">Highest score</div>
                    <div class="input" id="game-highest-score-value" style="font-weight: 600;">0</div>
                </div>
            </div>
            <div class="range-option" style="justify-content: center; padding: 8px 0;">
                <div class="icon">
                    <svg xmlns="http://www.w3.org/2000/svg" height="34px" viewBox="0 0 24 24" width="34px" fill=var(--text-color)><path d="M0 0h24v24H0V0z" fill="none"/><path d="M12 7.13l.97 2.29.47 1.11 1.2.1 2.47.21-1.88 1.63-.91.79.27 1.18.56 2.41-2.12-1.28-1.03-.64-1.03.62-2.12 1.28.56-2.41.27-1.18-.91-.79-1.88-1.63 2.47-.21 1.2-.1.47-1.11.97-2.27M12 2L9.19 8.63 2 9.24l5.46 4.73L5.82 21 12 17.27 18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2z"/></svg>
                </div>
                <div class="value" style="width: auto; font-size: 20px;">
                    <div class="title" style="padding-bottom: 5px;">Current score</div>
                    <div class="input" id="game-score-value" style="font-weight: 600;">0</div>
                </div>
            </div>
            <div id="game-area">
                <div id="play-board">
                    <div id="grid-container">
                    </div>
                    <div id="blocks-container">
                    </div>
                </div>
            </div> 
            <div style="height: 111px;"></div>
        </div>

        <!-- fixed elements -->
        <div id="splashscreen">
            <div style="animation: splash-block1 1.3s ease-in-out infinite;" id="splash-block1"></div>
            <div style="animation: splash-block2 1.3s ease-in-out infinite;" id="splash-block2"></div>
            <div style="animation: splash-block3 1.3s ease-in-out infinite;" id="splash-block3"></div>
            <div style="animation: splash-block4 1.3s ease-in-out infinite;" id="splash-block4"></div>
        </div>
        <button type="button" id="play-fab" title="new game" onclick="startNewGame();">
            <svg xmlns="http://www.w3.org/2000/svg" height="35px" viewBox="0 0 24 24" width="35px" fill=var(--background-color)><path d="M0 0h24v24H0V0z" fill="none"/><path d="M10 8.64L15.27 12 10 15.36V8.64M8 5v14l11-7L8 5z"/></svg>
        </button>
        <button type="button" id="menu-fab" title="open menu" onclick="menu.open();">
            <svg id="menu-fab-open-svg" style="transition: opacity 150ms linear;" xmlns="http://www.w3.org/2000/svg" height="35px" viewBox="0 0 24 24" width="35px" fill=var(--background-color)><path d="M0 0h24v24H0V0z" fill="none"/><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg>
            <svg style="display: none; opacity: 0; transition: opacity 150ms linear;" id="menu-fab-close-svg" xmlns="http://www.w3.org/2000/svg" height="35px" viewBox="0 0 24 24" width="35px" fill=var(--background-color)><path d="M0 0h24v24H0V0z" fill="none"/><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
        </button>
        <div id="dimmer" onclick="menu.open();"></div>
        <div id="menu">
            <div id="top-menu-fab-placeholder" style="height: 111px;"></div>
            <h1>2ⁿ</h1>

            <hr>
            <div id="expand-info" class="expand-container">
                <div class="expand-head-container" onclick="expandPart('info');">
                    <svg id="expand-info-svg" class="expand-svg" xmlns="http://www.w3.org/2000/svg" height="30px" viewBox="0 0 24 24" width="30px" fill=var(--text-color)><path d="M24 24H0V0h24v24z" fill="none" opacity=".87"/><path d="M16.59 8.59L12 13.17 7.41 8.59 6 10l6 6 6-6-1.41-1.41z"/></svg>
                    <h2 class="expand-title">About game</h2>
                    <svg class="expand-svg" xmlns="http://www.w3.org/2000/svg" height="30px" viewBox="0 0 24 24" width="30px" fill=var(--text-color)><path d="M0 0h24v24H0V0z" fill="none"/><path d="M11 7h2v2h-2zm0 4h2v6h-2zm1-9C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8z"/></svg>
                </div>
                <div id="expand-info-animator" class="expand-animator">
                    <div class="expand-content" style="text-align: left;" id="expand-info-content">
                        <hr>
                        <div style="margin: 15px 5px 25px 5px;">Do you know game called 2048? Well this is really the same concept, just with some enhancements here and there.<br>If you don't, just swipe your finger on the play board that looks like grid if you are using a device with touchscreen or use arrow keys or wsad if you are on desktop and you will learn the game quickly. The goal is to get as much score as possible before you fill the whole grid with blocks and cannot move with them anymore. How long that will take depends on how well you manage your blocks and connect them.<br>For added accessibility you can also just tap or click on side of the grid to move blocks.<br> Here in menu you can customize your game and see statistics.</div>
                    </div>
                </div>
            </div>
            <hr>

            <div id="expand-configuration" class="expand-container">
                <div class="expand-head-container" onclick="expandPart('configuration');">
                    <svg id="expand-configuration-svg" class="expand-svg" xmlns="http://www.w3.org/2000/svg" height="30px" viewBox="0 0 24 24" width="30px" fill=var(--text-color)><path d="M24 24H0V0h24v24z" fill="none" opacity=".87"/><path d="M16.59 8.59L12 13.17 7.41 8.59 6 10l6 6 6-6-1.41-1.41z"/></svg>
                    <h2 class="expand-title">Configuration</h2>
                    <svg class="expand-svg" xmlns="http://www.w3.org/2000/svg" height="30px" viewBox="0 0 24 24" width="30px" fill=var(--text-color)><path d="M0 0h24v24H0V0z" fill="none"/><path d="M3 17v2h6v-2H3zM3 5v2h10V5H3zm10 16v-2h8v-2h-8v-2h-2v6h2zM7 9v2H3v2h4v2h2V9H7zm14 4v-2H11v2h10zm-6-4h2V7h4V5h-4V3h-2v6z"/></svg>
                </div>
                <div id="expand-configuration-animator" class="expand-animator">
                    <div id="expand-configuration-content">
                        <hr>

                        <div class="range-option">
                            <div class="icon">
                                <svg xmlns="http://www.w3.org/2000/svg" height="30px" viewBox="0 0 24 24" width="30px" fill=var(--text-color)><path d="M0 0h24v24H0V0z" fill="none"/><path d="M20 2H4c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zM8 20H4v-4h4v4zm0-6H4v-4h4v4zm0-6H4V4h4v4zm6 12h-4v-4h4v4zm0-6h-4v-4h4v4zm0-6h-4V4h4v4zm6 12h-4v-4h4v4zm0-6h-4v-4h4v4zm0-6h-4V4h4v4z"/></svg>
                            </div>
                            <div class="value">
                                <div class="title">Grid size</div>
                                <div class="input">
                                    <input class="range" title="grid size" id="grid-size-range" type="range" min="2" max="6">
                                    <input class="number" type="number" id="grid-size-value">
                                </div>
                            </div>
                        </div>

                        <div class="range-option">
                            <div class="icon">
                                <svg xmlns="http://www.w3.org/2000/svg" enable-background="new 0 0 24 24" height="30px" viewBox="0 0 24 24" width="30px" fill=var(--text-color)><g><path d="M0,0h24v24H0V0z" fill="none"/></g><g><g><path d="M22,7V5h-3V2h-2v3h-4V2h-2v3H7V2H5v3H2v2h3v4H2v2h3v4H2v2h3v3h2v-3h4v3h2v-3h4v3h2v-3h3v-2h-3v-4h3v-2h-3V7H22z M7,7h4v4 H7V7z M7,17v-4h4v4H7z M17,17h-4v-4h4V17z M17,11h-4V7h4V11z"/></g></g></svg>
                            </div>
                            <div class="value">
                                <div class="title">Box margin multiplier</div>
                                <div class="input">
                                    <input class="range" title="box margin multiplier" id="box-margin-range" type="range" min="0" max="20">
                                    <input class="number" type="number" id="box-margin-value">
                                </div>
                            </div>
                        </div>

                        <div class="range-option">
                            <div class="icon">
                                <svg xmlns="http://www.w3.org/2000/svg" height="30px" viewBox="0 0 24 24" width="30px" fill=var(--text-color)><path d="M0 0h24v24H0z" fill="none"/><path d="M19 19h2v2h-2v-2zm0-2h2v-2h-2v2zM3 13h2v-2H3v2zm0 4h2v-2H3v2zm0-8h2V7H3v2zm0-4h2V3H3v2zm4 0h2V3H7v2zm8 16h2v-2h-2v2zm-4 0h2v-2h-2v2zm4 0h2v-2h-2v2zm-8 0h2v-2H7v2zm-4 0h2v-2H3v2zM21 8c0-2.76-2.24-5-5-5h-5v2h5c1.65 0 3 1.35 3 3v5h2V8z"/></svg>
                            </div>
                            <div class="value">
                                <div class="title">Box border radius multiplier</div>
                                <div class="input">
                                    <input class="range" title="Box border radius multiplier" id="box-border-radius-range" type="range" min="0" max="20">
                                    <input class="number" type="number" id="box-border-radius-value">
                                </div>
                            </div>
                        </div>

                        <div class="range-option">
                            <div class="icon">
                                <svg xmlns="http://www.w3.org/2000/svg" enable-background="new 0 0 24 24" height="30px" viewBox="0 0 24 24" width="30px" fill=var(--text-color)><g><rect fill="none" height="24" width="24" x="0"/></g><g><g><path d="M15,2c-2.71,0-5.05,1.54-6.22,3.78c-1.28,0.67-2.34,1.72-3,3C3.54,9.95,2,12.29,2,15c0,3.87,3.13,7,7,7 c2.71,0,5.05-1.54,6.22-3.78c1.28-0.67,2.34-1.72,3-3C20.46,14.05,22,11.71,22,9C22,5.13,18.87,2,15,2z M9,20c-2.76,0-5-2.24-5-5 c0-1.12,0.37-2.16,1-3c0,3.87,3.13,7,7,7C11.16,19.63,10.12,20,9,20z M12,17c-2.76,0-5-2.24-5-5c0-1.12,0.37-2.16,1-3 c0,3.86,3.13,6.99,7,7C14.16,16.63,13.12,17,12,17z M16.7,13.7C16.17,13.89,15.6,14,15,14c-2.76,0-5-2.24-5-5 c0-0.6,0.11-1.17,0.3-1.7C10.83,7.11,11.4,7,12,7c2.76,0,5,2.24,5,5C17,12.6,16.89,13.17,16.7,13.7z M19,12c0-3.86-3.13-6.99-7-7 c0.84-0.63,1.87-1,3-1c2.76,0,5,2.24,5,5C20,10.12,19.63,11.16,19,12z"/></g></g></svg>
                            </div>
                            <div class="value">
                                <div class="title">Transitions (animations) multiplier</div>
                                <div class="input">
                                    <input class="range" title="Transitions (animations) multiplier" id="transitions-range" type="range" min="0" max="20">
                                    <input class="number" type="number" id="transitions-value">
                                </div>
                            </div>
                        </div>

                    </div>
                </div>
            </div>
            <hr>

            <div id="expand-colors" class="expand-container">
                <div class="expand-head-container" onclick="expandPart('colors');">
                    <svg id="expand-colors-svg" class="expand-svg" xmlns="http://www.w3.org/2000/svg" height="30px" viewBox="0 0 24 24" width="30px" fill=var(--text-color)><path d="M24 24H0V0h24v24z" fill="none" opacity=".87"/><path d="M16.59 8.59L12 13.17 7.41 8.59 6 10l6 6 6-6-1.41-1.41z"/></svg>
                    <h2 class="expand-title">Colors</h2>
                    <svg class="expand-svg" xmlns="http://www.w3.org/2000/svg" enable-background="new 0 0 24 24" height="30px" viewBox="0 0 24 24" width="30px" fill=var(--text-color)><g><rect fill="none" height="24" width="24"/></g><g><g><g><g><path d="M12,22C6.49,22,2,17.51,2,12S6.49,2,12,2s10,4.04,10,9c0,3.31-2.69,6-6,6h-1.77c-0.28,0-0.5,0.22-0.5,0.5 c0,0.12,0.05,0.23,0.13,0.33c0.41,0.47,0.64,1.06,0.64,1.67C14.5,20.88,13.38,22,12,22z M12,4c-4.41,0-8,3.59-8,8s3.59,8,8,8 c0.28,0,0.5-0.22,0.5-0.5c0-0.16-0.08-0.28-0.14-0.35c-0.41-0.46-0.63-1.05-0.63-1.65c0-1.38,1.12-2.5,2.5-2.5H16 c2.21,0,4-1.79,4-4C20,7.14,16.41,4,12,4z"/><circle cx="6.5" cy="11.5" r="1.5"/><circle cx="9.5" cy="7.5" r="1.5"/><circle cx="14.5" cy="7.5" r="1.5"/><circle cx="17.5" cy="11.5" r="1.5"/></g></g></g></g></svg>
                </div>
                <div id="expand-colors-animator" class="expand-animator">
                    <div class="expand-content" style="text-align: left;" id="expand-colors-content">
                        <hr>

                        <div class="range-option">
                            <div class="icon">
                                <div class="color-preview" id="play-board-color-preview"></div>
                            </div>
                            <div class="value">
                                <div class="title">Play board RGB</div>
                                <div class="input">
                                    <input class="range" title="Play board red color" id="play-board-R-range" type="range" min="0" max="255">
                                    <input class="number" type="number" id="play-board-R-value" min="0" max="255">
                                </div>
                                <div class="input" style="padding: 6px 0;">
                                    <input class="range" title="Play board green color" id="play-board-G-range" type="range" min="0" max="255">
                                    <input class="number" type="number" id="play-board-G-value" min="0" max="255">
                                </div>
                                <div class="input">
                                    <input class="range" title="Play board blue color" id="play-board-B-range" type="range" min="0" max="255">
                                    <input class="number" type="number" id="play-board-B-value" min="0" max="255">
                                </div>
                            </div>
                        </div>

                        <div class="range-option">
                            <div class="icon">
                                <div class="color-preview" id="box-color-preview"></div>
                            </div>
                            <div class="value">
                                <div class="title">Box RGB</div>
                                <div class="input">
                                    <input class="range" title="Box red color" id="box-R-range" type="range" min="0" max="255">
                                    <input class="number" type="number" id="box-R-value" min="0" max="255">
                                </div>
                                <div class="input" style="padding: 6px 0;">
                                    <input class="range" title="Box green color" id="box-G-range" type="range" min="0" max="255">
                                    <input class="number" type="number" id="box-G-value" min="0" max="255">
                                </div>
                                <div class="input">
                                    <input class="range" title="Box blue color" id="box-B-range" type="range" min="0" max="255">
                                    <input class="number" type="number" id="box-B-value" min="0" max="255">
                                </div>
                            </div>
                        </div>

                        <div class="range-option">
                            <div class="icon">
                                <div class="color-preview" id="2power1-color-preview"></div>
                            </div>
                            <div class="value">
                                <div class="title">2¹ block RGB</div>
                                <div class="input">
                                    <input class="range" title="2 power 1 block red color" id="2power1-R-range" type="range" min="0" max="255">
                                    <input class="number" type="number" id="2power1-R-value" min="0" max="255">
                                </div>
                                <div class="input" style="padding: 6px 0;">
                                    <input class="range" title="2 power 1 block green color" id="2power1-G-range" type="range" min="0" max="255">
                                    <input class="number" type="number" id="2power1-G-value" min="0" max="255">
                                </div>
                                <div class="input">
                                    <input class="range" title="2 power 1 block blue color" id="2power1-B-range" type="range" min="0" max="255">
                                    <input class="number" type="number" id="2power1-B-value" min="0" max="255">
                                </div>
                            </div>
                        </div>

                        <div class="range-option">
                            <div class="icon">
                                <div class="color-preview" id="2power2-color-preview"></div>
                            </div>
                            <div class="value">
                                <div class="title">2² block RGB</div>
                                <div class="input">
                                    <input class="range" title="2 power 2 block red color" id="2power2-R-range" type="range" min="0" max="255">
                                    <input class="number" type="number" id="2power2-R-value" min="0" max="255">
                                </div>
                                <div class="input" style="padding: 6px 0;">
                                    <input class="range" title="2 power 2 block green color" id="2power2-G-range" type="range" min="0" max="255">
                                    <input class="number" type="number" id="2power2-G-value" min="0" max="255">
                                </div>
                                <div class="input">
                                    <input class="range" title="2 power 2 block blue color" id="2power2-B-range" type="range" min="0" max="255">
                                    <input class="number" type="number" id="2power2-B-value" min="0" max="255">
                                </div>
                            </div>
                        </div>

                        <div class="range-option">
                            <div class="icon">
                                <div class="color-preview" id="2power3-color-preview"></div>
                            </div>
                            <div class="value">
                                <div class="title">2³ block RGB</div>
                                <div class="input">
                                    <input class="range" title="2 power 3 block red color" id="2power3-R-range" type="range" min="0" max="255">
                                    <input class="number" type="number" id="2power3-R-value" min="0" max="255">
                                </div>
                                <div class="input" style="padding: 6px 0;">
                                    <input class="range" title="2 power 3 block green color" id="2power3-G-range" type="range" min="0" max="255">
                                    <input class="number" type="number" id="2power3-G-value" min="0" max="255">
                                </div>
                                <div class="input">
                                    <input class="range" title="2 power 3 block blue color" id="2power3-B-range" type="range" min="0" max="255">
                                    <input class="number" type="number" id="2power3-B-value" min="0" max="255">
                                </div>
                            </div>
                        </div>

                        <div class="range-option">
                            <div class="icon">
                                <div class="color-preview" id="2power4-color-preview"></div>
                            </div>
                            <div class="value">
                                <div class="title">2⁴ block RGB</div>
                                <div class="input">
                                    <input class="range" title="2 power 4 block red color" id="2power4-R-range" type="range" min="0" max="255">
                                    <input class="number" type="number" id="2power4-R-value" min="0" max="255">
                                </div>
                                <div class="input" style="padding: 6px 0;">
                                    <input class="range" title="2 power 4 block green color" id="2power4-G-range" type="range" min="0" max="255">
                                    <input class="number" type="number" id="2power4-G-value" min="0" max="255">
                                </div>
                                <div class="input">
                                    <input class="range" title="2 power 4 block blue color" id="2power4-B-range" type="range" min="0" max="255">
                                    <input class="number" type="number" id="2power4-B-value" min="0" max="255">
                                </div>
                            </div>
                        </div>

                        <div class="range-option">
                            <div class="icon">
                                <div class="color-preview" id="2power5-color-preview"></div>
                            </div>
                            <div class="value">
                                <div class="title">2⁵ block RGB</div>
                                <div class="input">
                                    <input class="range" title="2 power 5 block red color" id="2power5-R-range" type="range" min="0" max="255">
                                    <input class="number" type="number" id="2power5-R-value" min="0" max="255">
                                </div>
                                <div class="input" style="padding: 6px 0;">
                                    <input class="range" title="2 power 5 block green color" id="2power5-G-range" type="range" min="0" max="255">
                                    <input class="number" type="number" id="2power5-G-value" min="0" max="255">
                                </div>
                                <div class="input">
                                    <input class="range" title="2 power 5 block blue color" id="2power5-B-range" type="range" min="0" max="255">
                                    <input class="number" type="number" id="2power5-B-value" min="0" max="255">
                                </div>
                            </div>
                        </div>

                        <div class="range-option">
                            <div class="icon">
                                <div class="color-preview" id="2power6-color-preview"></div>
                            </div>
                            <div class="value">
                                <div class="title">2⁶ block RGB</div>
                                <div class="input">
                                    <input class="range" title="2 power 6 block red color" id="2power6-R-range" type="range" min="0" max="255">
                                    <input class="number" type="number" id="2power6-R-value" min="0" max="255">
                                </div>
                                <div class="input" style="padding: 6px 0;">
                                    <input class="range" title="2 power 6 block green color" id="2power6-G-range" type="range" min="0" max="255">
                                    <input class="number" type="number" id="2power6-G-value" min="0" max="255">
                                </div>
                                <div class="input">
                                    <input class="range" title="2 power 6 block blue color" id="2power6-B-range" type="range" min="0" max="255">
                                    <input class="number" type="number" id="2power6-B-value" min="0" max="255">
                                </div>
                            </div>
                        </div>

                        <div class="range-option">
                            <div class="icon">
                                <div class="color-preview" id="2power7-color-preview"></div>
                            </div>
                            <div class="value">
                                <div class="title">2⁷ block RGB</div>
                                <div class="input">
                                    <input class="range" title="2 power 7 block red color" id="2power7-R-range" type="range" min="0" max="255">
                                    <input class="number" type="number" id="2power7-R-value" min="0" max="255">
                                </div>
                                <div class="input" style="padding: 6px 0;">
                                    <input class="range" title="2 power 7 block green color" id="2power7-G-range" type="range" min="0" max="255">
                                    <input class="number" type="number" id="2power7-G-value" min="0" max="255">
                                </div>
                                <div class="input">
                                    <input class="range" title="2 power 7 block blue color" id="2power7-B-range" type="range" min="0" max="255">
                                    <input class="number" type="number" id="2power7-B-value" min="0" max="255">
                                </div>
                            </div>
                        </div>

                        <div class="range-option">
                            <div class="icon">
                                <div class="color-preview" id="2power8-color-preview"></div>
                            </div>
                            <div class="value">
                                <div class="title">2⁸ block RGB</div>
                                <div class="input">
                                    <input class="range" title="2 power 8 block red color" id="2power8-R-range" type="range" min="0" max="255">
                                    <input class="number" type="number" id="2power8-R-value" min="0" max="255">
                                </div>
                                <div class="input" style="padding: 6px 0;">
                                    <input class="range" title="2 power 8 block green color" id="2power8-G-range" type="range" min="0" max="255">
                                    <input class="number" type="number" id="2power8-G-value" min="0" max="255">
                                </div>
                                <div class="input">
                                    <input class="range" title="2 power 8 block blue color" id="2power8-B-range" type="range" min="0" max="255">
                                    <input class="number" type="number" id="2power8-B-value" min="0" max="255">
                                </div>
                            </div>
                        </div>

                        <div class="range-option">
                            <div class="icon">
                                <div class="color-preview" id="2power9-color-preview"></div>
                            </div>
                            <div class="value">
                                <div class="title">2⁹ block RGB</div>
                                <div class="input">
                                    <input class="range" title="2 power 9 block red color" id="2power9-R-range" type="range" min="0" max="255">
                                    <input class="number" type="number" id="2power9-R-value" min="0" max="255">
                                </div>
                                <div class="input" style="padding: 6px 0;">
                                    <input class="range" title="2 power 9 block green color" id="2power9-G-range" type="range" min="0" max="255">
                                    <input class="number" type="number" id="2power9-G-value" min="0" max="255">
                                </div>
                                <div class="input">
                                    <input class="range" title="2 power 9 block blue color" id="2power9-B-range" type="range" min="0" max="255">
                                    <input class="number" type="number" id="2power9-B-value" min="0" max="255">
                                </div>
                            </div>
                        </div>

                        <div class="range-option">
                            <div class="icon">
                                <div class="color-preview" id="2power10-color-preview"></div>
                            </div>
                            <div class="value">
                                <div class="title">2¹⁰ block RGB</div>
                                <div class="input">
                                    <input class="range" title="2 power 10 block red color" id="2power10-R-range" type="range" min="0" max="255">
                                    <input class="number" type="number" id="2power10-R-value" min="0" max="255">
                                </div>
                                <div class="input" style="padding: 6px 0;">
                                    <input class="range" title="2 power 10 block green color" id="2power10-G-range" type="range" min="0" max="255">
                                    <input class="number" type="number" id="2power10-G-value" min="0" max="255">
                                </div>
                                <div class="input">
                                    <input class="range" title="2 power 10 block blue color" id="2power10-B-range" type="range" min="0" max="255">
                                    <input class="number" type="number" id="2power10-B-value" min="0" max="255">
                                </div>
                            </div>
                        </div>

                        <div class="range-option">
                            <div class="icon">
                                <div class="color-preview" id="2power11-color-preview"></div>
                            </div>
                            <div class="value">
                                <div class="title">2¹¹ block RGB</div>
                                <div class="input">
                                    <input class="range" title="2 power 11 block red color" id="2power11-R-range" type="range" min="0" max="255">
                                    <input class="number" type="number" id="2power11-R-value" min="0" max="255">
                                </div>
                                <div class="input" style="padding: 6px 0;">
                                    <input class="range" title="2 power 11 block green color" id="2power11-G-range" type="range" min="0" max="255">
                                    <input class="number" type="number" id="2power11-G-value" min="0" max="255">
                                </div>
                                <div class="input">
                                    <input class="range" title="2 power 11 block blue color" id="2power11-B-range" type="range" min="0" max="255">
                                    <input class="number" type="number" id="2power11-B-value" min="0" max="255">
                                </div>
                            </div>
                        </div>

                        <div class="range-option">
                            <div class="icon">
                                <div class="color-preview" id="2power12-color-preview"></div>
                            </div>
                            <div class="value">
                                <div class="title">2¹² block RGB</div>
                                <div class="input">
                                    <input class="range" title="2 power 12 block red color" id="2power12-R-range" type="range" min="0" max="255">
                                    <input class="number" type="number" id="2power12-R-value" min="0" max="255">
                                </div>
                                <div class="input" style="padding: 6px 0;">
                                    <input class="range" title="2 power 12 block green color" id="2power12-G-range" type="range" min="0" max="255">
                                    <input class="number" type="number" id="2power12-G-value" min="0" max="255">
                                </div>
                                <div class="input">
                                    <input class="range" title="2 power 12 block blue color" id="2power12-B-range" type="range" min="0" max="255">
                                    <input class="number" type="number" id="2power12-B-value" min="0" max="255">
                                </div>
                            </div>
                        </div>

                        <div class="range-option">
                            <div class="icon">
                                <div class="color-preview" id="2power13-color-preview"></div>
                            </div>
                            <div class="value">
                                <div class="title">2¹³ block RGB</div>
                                <div class="input">
                                    <input class="range" title="2 power 13 block red color" id="2power13-R-range" type="range" min="0" max="255">
                                    <input class="number" type="number" id="2power13-R-value" min="0" max="255">
                                </div>
                                <div class="input" style="padding: 6px 0;">
                                    <input class="range" title="2 power 13 block green color" id="2power13-G-range" type="range" min="0" max="255">
                                    <input class="number" type="number" id="2power13-G-value" min="0" max="255">
                                </div>
                                <div class="input">
                                    <input class="range" title="2 power 13 block blue color" id="2power13-B-range" type="range" min="0" max="255">
                                    <input class="number" type="number" id="2power13-B-value" min="0" max="255">
                                </div>
                            </div>
                        </div>

                        <div class="range-option">
                            <div class="icon">
                                <div class="color-preview" id="2power14-color-preview"></div>
                            </div>
                            <div class="value">
                                <div class="title">2¹⁴ block RGB</div>
                                <div class="input">
                                    <input class="range" title="2 power 14 block red color" id="2power14-R-range" type="range" min="0" max="255">
                                    <input class="number" type="number" id="2power14-R-value" min="0" max="255">
                                </div>
                                <div class="input" style="padding: 6px 0;">
                                    <input class="range" title="2 power 14 block green color" id="2power14-G-range" type="range" min="0" max="255">
                                    <input class="number" type="number" id="2power14-G-value" min="0" max="255">
                                </div>
                                <div class="input">
                                    <input class="range" title="2 power 14 block blue color" id="2power14-B-range" type="range" min="0" max="255">
                                    <input class="number" type="number" id="2power14-B-value" min="0" max="255">
                                </div>
                            </div>
                        </div>

                        <div class="range-option">
                            <div class="icon">
                                <div class="color-preview" id="2power15-color-preview"></div>
                            </div>
                            <div class="value">
                                <div class="title">2¹⁵ block RGB</div>
                                <div class="input">
                                    <input class="range" title="2 power 15 block red color" id="2power15-R-range" type="range" min="0" max="255">
                                    <input class="number" type="number" id="2power15-R-value" min="0" max="255">
                                </div>
                                <div class="input" style="padding: 6px 0;">
                                    <input class="range" title="2 power 15 block green color" id="2power15-G-range" type="range" min="0" max="255">
                                    <input class="number" type="number" id="2power15-G-value" min="0" max="255">
                                </div>
                                <div class="input">
                                    <input class="range" title="2 power 15 block blue color" id="2power15-B-range" type="range" min="0" max="255">
                                    <input class="number" type="number" id="2power15-B-value" min="0" max="255">
                                </div>
                            </div>
                        </div>

                    </div>
                </div>
            </div>
            <hr>

            <div id="bottom-menu-fab-placeholder" style="height: 111px;"></div>
        </div>

    </body>

    <script type="text/javascript">

        // setting up global objects
        cssVariables = document.querySelector(":root");
        expanded = {};
        menu = {opened: false, style: null, open() {
            dimmer = document.getElementById("dimmer");
            menuElement = document.getElementById("menu");
            openSvg = document.getElementById("menu-fab-open-svg");
            closeSvg = document.getElementById("menu-fab-close-svg");
            if (this.opened) {
                menuElement.style.removeProperty("transform")
                closeSvg.style.opacity = 0;
                setTimeout(function() {
                    closeSvg.style.display = "none";
                    openSvg.style.display = "block";
                    setTimeout(function() {
                        openSvg.style.opacity = 1;
                    }, 10);
                }, 160);
                dimmer.style.opacity = 0;
                setTimeout(function() {
                    dimmer.style.display = "none";
                }, 310);
                this.opened = false;
                mode = "play";
            } else {
                dimmer.style.display = "block";
                setTimeout(function() {
                    dimmer.style.opacity = 1;
                }, 10);
                if (this.style == "bottom") {
                    menuElement.style.transform = "translateY(calc(-100% + 9px))";
                } else {
                    menuElement.style.transform = "translateX(420px)";
                }
                openSvg.style.opacity = 0;
                setTimeout(function() {
                    openSvg.style.display = "none";
                    closeSvg.style.display = "block";
                    setTimeout(function() {
                        closeSvg.style.opacity = 1;
                    }, 10);
                }, 160);
                setTimeout(function() {
                }, 300);
                this.opened = true;
                mode = "menu";
            }
        }, updateStyle() {
            menuFab = document.getElementById("menu-fab");
            menuElement = document.getElementById("menu");
            menuForceClosed = false;
            if (innerWidth > innerHeight && innerWidth > 450 && this.style != "side") {
                menuFab.style.bottom = "";
                menuFab.style.top = "25px";
                if (this.opened) {
                    this.open();
                    menuForceClosed = true;
                }
                menuElement.style.top = "0";
                menuElement.style.bottom = "0";
                menuElement.style.left = "-420px";
                menuElement.style.removeProperty("right");
                menuElement.style.width = "400px";
                menuElement.style.height = "100%";
                menuElement.style.borderRadius = "0";
                document.getElementById("bottom-menu-fab-placeholder").style.display = "none";
                document.getElementById("top-menu-fab-placeholder").style.height = "111px";
                this.style = "side";
            } else if ((innerWidth <= innerHeight || innerWidth <= 450) && this.style != "bottom") {
                menuFab.style.removeProperty("top");
                menuFab.style.bottom = "25px";
                if (this.opened) {
                    this.open();
                    menuForceClosed = true;
                }
                menuElement.style.left = "0";
                menuElement.style.right = "0";
                menuElement.style.top = "100%";
                menuElement.style.removeProperty("bottom");
                menuElement.style.removeProperty("width");
                menuElement.style.height = "calc(100% + 9px)";
                menuElement.style.removeProperty("border-radius");
                document.getElementById("bottom-menu-fab-placeholder").style.display = "block";
                document.getElementById("top-menu-fab-placeholder").style.height = "85px";
                this.style = "bottom";
            }
            if (menuForceClosed) {
                setTimeout(function() {
                    menu.open();
                }, 310);
            }
        }};

        if (navigator.cookieEnabled) {
            storage = "localStorage";
        } else {
            storage = "globalStorage";
        }

        globalStorage = {getItem(id) {
            return this.values[id];
        }, setItem(id, value) {
            this.values[id] = value;
        }, clear() {
            for (item of Object.keys(this.values)) {
                delete this.values[item];
            }
        }, values: {}}

        move = {powerUpBlockPairs: [], nothingMoved: true};
        statistics = {blocksCreated: 0, hiddenBlocks: [], blocksToRemove: [], score: 0, highestScores: {grid4: 0}, moves: 0, blocksPowered: 0};
        configuration = {};
        unApplyedConfiguration = {};
        blocks = [];
        mode = "play";
        optionPowerColorValuePairsNumber = 15;

        chooseTheme();
        matchMedia('(prefers-color-scheme: dark)').addEventListener("change", chooseTheme);

        function chooseTheme() {
            if (matchMedia('(prefers-color-scheme: dark)').matches) {
                setTheme(true);
            } else {
                setTheme(false);
            }
        }

        function setTheme(dark) {
            if (dark) {
                cssVariables.style.setProperty('--accent-color', "rgb(240, 240, 240)");
                cssVariables.style.setProperty('--background-color', "rgb(50, 50, 50)");
                cssVariables.style.setProperty('--text-color', "white");
                cssVariables.style.setProperty('--pale-color', "rgb(70, 70, 70)");
            } else {
                cssVariables.style.setProperty('--accent-color', "rgb(40, 40, 40)");
                cssVariables.style.setProperty('--background-color', "white");
                cssVariables.style.setProperty('--text-color', "black");
                cssVariables.style.setProperty('--pale-color', "rgb(230, 230, 230)");
            }
        }

        if (window[storage].getItem("storageUsed") == null) {
            resetStorage();
        } else {
            restoreStorage();
            restoreGame();
        }

        Object.assign(unApplyedConfiguration, configuration);

        optionRangeValuePairs = [{optionDOM: "grid-size", optionJS: "gridSize", multiplier: 1}, {optionDOM: "box-margin", optionJS: "boxMargin", multiplier: 0.1}, {optionDOM: "box-border-radius", optionJS: "boxBorderRadius", multiplier: 0.1}, {optionDOM: "transitions", optionJS: "transitions", multiplier: 0.1}];

        for (pair of optionRangeValuePairs) {
            document.getElementById(`${pair.optionDOM}-range`).addEventListener("input", updateOptionRangeValuePair.bind(null, pair, "range"));
            document.getElementById(`${pair.optionDOM}-value`).addEventListener("input", updateOptionRangeValuePair.bind(null, pair, "value"));
        }

        for (loop = 1; loop <= optionPowerColorValuePairsNumber; loop++) {
            document.getElementById(`2power${loop}-R-range`).addEventListener("input", updateOptionPowerColorValuePair.bind(null, "range", loop));
            document.getElementById(`2power${loop}-G-range`).addEventListener("input", updateOptionPowerColorValuePair.bind(null, "range", loop));
            document.getElementById(`2power${loop}-B-range`).addEventListener("input", updateOptionPowerColorValuePair.bind(null, "range", loop));
            document.getElementById(`2power${loop}-R-value`).addEventListener("input", updateOptionPowerColorValuePair.bind(null, "value", loop));
            document.getElementById(`2power${loop}-G-value`).addEventListener("input", updateOptionPowerColorValuePair.bind(null, "value", loop));
            document.getElementById(`2power${loop}-B-value`).addEventListener("input", updateOptionPowerColorValuePair.bind(null, "value", loop));
        }

        optionPlayBoardColors = [{optionDOM: "play-board", optionJS: "playBoardBackground"}, {optionDOM: "box", optionJS: "boxBackground"}];

        for (option of optionPlayBoardColors) {
            document.getElementById(`${option.optionDOM}-R-range`).addEventListener("input", updateOptionPlayBoardColors.bind(null, "range", option));
            document.getElementById(`${option.optionDOM}-G-range`).addEventListener("input", updateOptionPlayBoardColors.bind(null, "range", option));
            document.getElementById(`${option.optionDOM}-B-range`).addEventListener("input", updateOptionPlayBoardColors.bind(null, "range", option));
            document.getElementById(`${option.optionDOM}-R-value`).addEventListener("input", updateOptionPlayBoardColors.bind(null, "value", option));
            document.getElementById(`${option.optionDOM}-G-value`).addEventListener("input", updateOptionPlayBoardColors.bind(null, "value", option));
            document.getElementById(`${option.optionDOM}-B-value`).addEventListener("input", updateOptionPlayBoardColors.bind(null, "value", option));
        }

        addEventListener("keydown", function(key) {
            if(["Space","ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].indexOf(key.code) > -1) {
                key.preventDefault();
            }
        }, false);

        addEventListener("keyup", function() {
            if (mode == "play") {
                switch (event.key) {
                    case "ArrowRight":
                    case "d":
                        moveBlocks("right");
                        break;
                    case "ArrowUp":
                    case "w":
                        moveBlocks("up");
                        break;
                    case "ArrowLeft":
                    case "a":
                        moveBlocks("left");
                        break;
                    case "ArrowDown":
                    case "s":
                        moveBlocks("down");
                        break;
                    case " ":
                        if (confirm("Confirm start of new game?")) {
                            startNewGame();
                        }
                        break;
                    default:
                        break;
                }
            }
        });

        if (matchMedia("(pointer: coarse)")) {
            document.getElementById("game-container").addEventListener("swiped-right", function(positions) {
            moveBlocks("right");
            });
            document.getElementById("game-container").addEventListener("swiped-up", function(positions) {
                moveBlocks("up");
            });
            document.getElementById("game-container").addEventListener("swiped-left", function(positions) {
                moveBlocks("left");
            });
            document.getElementById("game-container").addEventListener("swiped-down", function(positions) {
                moveBlocks("down");
            });
        }

        addEventListener("resize", function() {
            renderPlayBoard();
            updateBoard();
            menu.updateStyle()
        });

        document.getElementById("play-board").addEventListener("click", function() {
            x = event.clientX-this.getBoundingClientRect().left;
            y = event.clientY-this.getBoundingClientRect().top;
            playBoardSize = getComputedStyle(this).width.replace("px", "")*1;
            if (x > y && playBoardSize-y > x) {
                moveBlocks("up");
            } else if (y > x && playBoardSize-x > y) {
                moveBlocks("left");
            } else if (x > playBoardSize-y && y > x) {
                moveBlocks("down");
            } else if (y > playBoardSize-x && x > y) {
                moveBlocks("right");
            }
        });

        // setInterval(function() {
        //     random = getRandomNumber(1, 4);
        //     switch (random) {
        //         case 1:
        //             moveBlocks("right");
        //             break;
        //         case 2:
        //             moveBlocks("up");
        //             break;
        //         case 3:
        //             moveBlocks("left");
        //             break;
        //         case 4:
        //             moveBlocks("down");
        //         default:
        //             break;
        //     }
        // }, 20);

        for (pair of optionRangeValuePairs) {
            document.getElementById(`${pair.optionDOM}-value`).value = configuration[pair.optionJS];
            updateOptionRangeValuePair(pair, "value");
        }

        for (loop = 1; loop <= optionPowerColorValuePairsNumber; loop++) {
            value = configuration.powerColors[loop-1];
            RGB = getRGBvalues(value);
            R = RGB[1];
            G = RGB[2];
            B = RGB[3];
            document.getElementById(`2power${loop}-color-preview`).style.backgroundColor = value;
            document.getElementById(`2power${loop}-R-range`).value = R;
            document.getElementById(`2power${loop}-G-range`).value = G;
            document.getElementById(`2power${loop}-B-range`).value = B;
            document.getElementById(`2power${loop}-R-value`).value = R;
            document.getElementById(`2power${loop}-G-value`).value = G;
            document.getElementById(`2power${loop}-B-value`).value = B;
        }

        for (option of optionPlayBoardColors) {
            value = configuration[option.optionJS];
            RGB = getRGBvalues(value);
            R = RGB[1];
            G = RGB[2];
            B = RGB[3];
            document.getElementById(`${option.optionDOM}-color-preview`).style.backgroundColor = value;
            document.getElementById(`${option.optionDOM}-R-range`).value = R;
            document.getElementById(`${option.optionDOM}-G-range`).value = G;
            document.getElementById(`${option.optionDOM}-B-range`).value = B;
            document.getElementById(`${option.optionDOM}-R-value`).value = R;
            document.getElementById(`${option.optionDOM}-G-value`).value = G;
            document.getElementById(`${option.optionDOM}-B-value`).value = B;
        }

        menu.updateStyle();
        if (window[storage].getItem("storageUsed") == null) {
            window[storage].setItem("storageUsed", 1);
            startNewGame();
        }

        setTimeout(function() {
            updateBoard();
            splashscreen = document.getElementById("splashscreen");
            splashscreen.style.opacity = 0;
            setTimeout(function() {
                splashscreen.style.display = "none";
            }, 170);
        }, 100)

        function expandPart(expanderId) {
            expandContent = document.getElementById(`expand-${expanderId}-content`);
            if (typeof expanded[expanderId] == "undefined") {
                expanded[expanderId] = false;
            }
            if (!expanded[expanderId]) {
                expanded[expanderId] = true;
                document.getElementById(`expand-${expanderId}-svg`).style.transform = "scaleY(-100%)";
                document.getElementById(`expand-${expanderId}-animator`).style.height = (getComputedStyle(expandContent).height.replace("px", "")*1)+5 + "px";
            } else {
                expanded[expanderId] = false;
                document.getElementById(`expand-${expanderId}-svg`).style.removeProperty("transform");
                document.getElementById(`expand-${expanderId}-animator`).style.removeProperty("height");
            }
        }

        function renderPlayBoard() {
            cssVariables.style.setProperty("--box-size", "0");
            if (innerWidth > innerHeight) {
                boardSize = innerHeight*0.6;
            } else {
                boardSize = innerWidth*0.7;
            }
            boxMargin = ((boardSize/configuration.gridSize)/15)*configuration.boxMargin;
            cssVariables.style.setProperty("--box-margin", `${boxMargin}px`);
            cssVariables.style.setProperty("--box-size", `${(boardSize-(boxMargin*configuration.gridSize*2)-((boxMargin*2)/configuration.gridSize))/configuration.gridSize}px`);
            cssVariables.style.setProperty("--block-font-size", `${(boardSize/configuration.gridSize)/2.5}px`);
            boxBorderRadius = ((boardSize/configuration.gridSize)/20)*configuration.boxBorderRadius;
            cssVariables.style.setProperty("--box-border-radius", `${boxBorderRadius}px`);
            document.getElementById("play-board").style.borderRadius = `${Math.pow(configuration.gridSize, 1/2)*boxBorderRadius}px`;
        }

        function updateOptionPlayBoardColors(origin, option) {
            if (origin == "range") {
                applyedTo = "value";
            } else {
                applyedTo = "range";
            }
            R = document.getElementById(`${option.optionDOM}-R-${origin}`).value;
            G = document.getElementById(`${option.optionDOM}-G-${origin}`).value;
            B = document.getElementById(`${option.optionDOM}-B-${origin}`).value;
            value = `rgb(${R}, ${G}, ${B})`;
            unApplyedConfiguration[option.optionJS] = value;
            document.getElementById(`${option.optionDOM}-color-preview`).style.backgroundColor = value;
            document.getElementById(`${option.optionDOM}-R-${applyedTo}`).value = R;
            document.getElementById(`${option.optionDOM}-G-${applyedTo}`).value = G;
            document.getElementById(`${option.optionDOM}-B-${applyedTo}`).value = B;
        }

        function updateOptionPowerColorValuePair(origin, power) {
            if (origin == "range") {
                applyedTo = "value";
            } else {
                applyedTo = "range";
            }
            R = document.getElementById(`2power${power}-R-${origin}`).value;
            G = document.getElementById(`2power${power}-G-${origin}`).value;
            B = document.getElementById(`2power${power}-B-${origin}`).value;
            value = `rgb(${R}, ${G}, ${B})`;
            unApplyedConfiguration.powerColors[power-1] = value;
            document.getElementById(`2power${power}-color-preview`).style.backgroundColor = value;
            document.getElementById(`2power${power}-R-${applyedTo}`).value = R;
            document.getElementById(`2power${power}-G-${applyedTo}`).value = G;
            document.getElementById(`2power${power}-B-${applyedTo}`).value = B;
            // cssVariables.style.setProperty(`--power${power}-color`, value);
        }

        function updateOptionRangeValuePair(pair, origin) {
            if (origin == "range") {
                valueMultiplier = pair.multiplier;
                DOMMultiplier = 1;
                applyedTo = "value";
            } else {
                valueMultiplier = 1;
                DOMMultiplier = 1/pair.multiplier;
                applyedTo = "range";
            }
            value = document.getElementById(`${pair.optionDOM}-${origin}`).value*valueMultiplier;
            unApplyedConfiguration[pair.optionJS] = value;
            document.getElementById(`${pair.optionDOM}-${applyedTo}`).value = Math.round(value*DOMMultiplier*10)/10;
        }

        function startNewGame() {
            Object.assign(configuration, unApplyedConfiguration);
            window[storage].setItem("configuration", JSON.stringify(configuration));
            statistics = {blocksCreated: 0, hiddenBlocks: [], blocksToRemove: [], score: 0, highestScores: statistics.highestScores, moves: 0, blocksPowered: 0};
            blocks = [];
            if (typeof statistics.highestScores[`grid${configuration.gridSize}`] == "undefined") {
                statistics.highestScores[`grid${configuration.gridSize}`] = 0;
            }
            updateUserStatistics();
            document.getElementById("blocks-container").innerHTML = "";
            document.getElementById("grid-container").innerHTML = "";
            configureGameSetup();
            renderPlayBoard();
            createBlock(1);
            createBlock(1);
            updateBoard();
            window[storage].setItem("blocks", JSON.stringify(blocks));
            window[storage].setItem("statistics", JSON.stringify(statistics));
        }

        function getRGBvalues(RGBColor) {
            return RGBColor.match(/rgb\((\d*?), (\d*?), (\d*?)\)/);
        }

        function restoreStorage() {
            Object.assign(configuration, JSON.parse(window[storage].getItem("configuration")));
            Object.assign(blocks, JSON.parse(window[storage].getItem("blocks")));
            Object.assign(statistics, JSON.parse(window[storage].getItem("statistics")));
        }

        function restoreGame() {
            if (typeof statistics.highestScores[`grid${configuration.gridSize}`] == "undefined") {
                statistics.highestScores[`grid${configuration.gridSize}`] = 0;
            }
            updateUserStatistics();
            document.getElementById("blocks-container").innerHTML = "";
            document.getElementById("grid-container").innerHTML = "";
            configureGameSetup();
            renderPlayBoard();
            statistics.hiddenBlocks = [];
            for (block of blocks) {
                block = restoreBlock(block);
            }
            updateBoard();
        }

        function resetStorage() {
            configuration = {gridSize: 4, transitions: 1, boxBackground: "rgb(255, 255, 255)", boxBorderRadius: 1, boxMargin: 1, playBoardBackground: "rgb(40, 40, 40)", powerColors: ["rgb(182, 215, 168)", "rgb(147, 196, 125)", "rgb(106, 168, 79)", "rgb(234, 153, 153)", "rgb(224, 102, 102)", "rgb(204, 0, 0)", "rgb(159, 197, 232)", "rgb(111, 168, 220)", "rgb(61, 133, 198)", "rgb(249, 203, 156)", "rgb(246, 178, 107)", "rgb(230, 145, 56)", "rgb(180, 167, 214)", "rgb(142, 124, 195)", "rgb(103, 78, 167)"]};
            window[storage].setItem("configuration", JSON.stringify(configuration));
        }

        function configureGameSetup() {
            // console.log(`configuring game setup: ${JSON.stringify(configuration)}`);

            // console.log("setting play board styles");
            cssVariables.style.setProperty("--box-background", `${configuration.boxBackground}`);
            cssVariables.style.setProperty("--play-board-background", `${configuration.playBoardBackground}`);
            cssVariables.style.setProperty("--block-transitions", `top ${120*configuration.transitions}ms ease-in-out, left ${120*configuration.transitions}ms ease-in-out, transform ${120*configuration.transitions}ms ease-in-out, background-color ${240*configuration.transitions}ms ease-in-out, color ${240*configuration.transitions}ms ease-in-out`);
            for (loop = 1; loop <= optionPowerColorValuePairsNumber; loop++) {
                cssVariables.style.setProperty(`--power${loop}-color`, configuration.powerColors[loop-1]);
            }

            // console.log("writing play board grid");
            gridContainer = document.getElementById("grid-container");
            for (row = 0; row < configuration.gridSize; row++) {
                rowElement = document.createElement("div");
                rowElement.id = `row${row}`;
                gridContainer.appendChild(rowElement);
                // console.log(`created row ${row}`);
                for (box = 0; box < configuration.gridSize; box++) {
                    boxElement = document.createElement("div");
                    boxElement.id = `box${row}-${box}`;
                    boxElement.setAttribute("class", "box");
                    rowElement.appendChild(boxElement);
                    // console.log(`created box ${box} in row ${row}`);
                }
            }
        }

        function checkMoveOptions(x, y, direction) {
            // console.log(`reading ${x},${y}`);
            canMove = false;
            powerUp = false;
            localBlock = getBlockFromPosition(x, y);
            if (localBlock !== false) {
                // console.log(`found local block ${blocks[localBlock].element.id}`);
                moveSteps = 1;
                obstructingBlock = false;
                while (obstructingBlock === false && ((direction == "right" && moveSteps+y < configuration.gridSize) || (direction == "up" && x-moveSteps >= 0) || (direction == "left" && y-moveSteps >= 0) || (direction == "down" && moveSteps+x < configuration.gridSize))) {
                    // console.log(`checking move to ${direction} by ${moveSteps}`);
                    switch (direction) {
                        case "right":
                            obstructingBlock = getBlockFromPosition(x, y+moveSteps);
                            break;
                        case "up":
                            obstructingBlock = getBlockFromPosition(x-moveSteps, y);
                            break;
                        case "left":
                            obstructingBlock = getBlockFromPosition(x, y-moveSteps);
                            break;
                        case "down":
                            obstructingBlock = getBlockFromPosition(x+moveSteps, y);
                            break;
                        default:
                            break;
                    }
                    moveSteps++;
                }
                if (obstructingBlock !== false) {
                    // console.log(`found obstructing block ${blocks[obstructingBlock].element.id} in ${direction}`);
                    if (blocks[obstructingBlock].power == blocks[localBlock].power) {
                        // console.log(`obstructing block has same power of ${blocks[localBlock].power}`);
                        canMove = true;
                        powerUp = true;
                        blocks[localBlock].element.style.zIndex = 0;
                    } else if (moveSteps > 2) {
                        // console.log(`moving as far as possible before obstructing block`);
                        canMove = true;
                        moveSteps--;
                    }
                } else {
                    canMove = true;
                }
                if (canMove) {
                    moveSingleBlock(localBlock, obstructingBlock, powerUp, direction, moveSteps);
                }
            }  
        }

        function moveBlocks(direction) {
            // console.log(`moving blocks ${direction}`);
            move.nothingMoved = true;
            switch (direction) {
                case "right":
                    for (y = configuration.gridSize-2; y >= 0; y--) {
                        for (x = 0; x < configuration.gridSize; x++) {
                            checkMoveOptions(x, y, direction);
                        }
                    }
                    break;
                case "up":
                    for (x = 1; x < configuration.gridSize; x++) {
                        for (y = 0; y < configuration.gridSize; y++) {
                            checkMoveOptions(x, y, direction);
                        }
                    }
                    break;
                case "left":
                    for (y = 1; y < configuration.gridSize; y++) {
                        for (x = configuration.gridSize-1; x >= 0; x--) {
                            checkMoveOptions(x, y, direction);
                        }
                    }
                    break;
                case "down":
                    for (x = configuration.gridSize-2; x >= 0; x--) {
                        for (y = configuration.gridSize-1; y >= 0; y--) {
                            checkMoveOptions(x, y, direction);
                        }
                    }
                    break;
                default:
                    break;
            }
            // console.log("moving blocks finalized");
            blocksLog = "";
            for (block of blocks) {
                blocksLog += ` ${block.x}, ${block.y}, ${block.element.id};`;
            }
            // console.log(blocksLog);
            if (!move.nothingMoved) {
                updateBlock(createBlock(1));
                statistics.moves++;
            }
            window[storage].setItem("blocks", JSON.stringify(blocks));
            window[storage].setItem("statistics", JSON.stringify(statistics));
        }

        function moveSingleBlock(localBlock, obstructingBlock, powerUp, direction, moveSteps) {
            move.nothingMoved = false;
            // console.log(`moving block ${blocks[localBlock].element.id} ${direction} by ${moveSteps-1} steps`);
            if (powerUp) {
                blocks[obstructingBlock].power++;
                statistics.blocksPowered++;
                statistics.score += Math.pow(2, blocks[obstructingBlock].power);
                if (statistics.score > statistics.highestScores[`grid${configuration.gridSize}`]) {
                    statistics.highestScores[`grid${configuration.gridSize}`] = statistics.score;
                }
                blocks[obstructingBlock].element.style.transform = "scale(1.2)";
                blocks[localBlock].element.style.transform = "scale(0)";
                blocks[obstructingBlock].element.style.backgroundColor = `var(--power${blocks[obstructingBlock].power}-color)`;
                blocks[obstructingBlock].element.style.color = getReadableTextColor(configuration.powerColors[blocks[obstructingBlock].power-1]);
                move.powerUpBlockPairs.push(blocks[localBlock], blocks[obstructingBlock]);
                statistics.blocksToRemove.push(blocks[localBlock]);
                // powerUpPairLog = "pushed powerUpBlockPair:";
                // for (pair = 0; pair < move.powerUpBlockPairs.length; pair += 2) {
                //     powerUpPairLog += ` ${move.powerUpBlockPairs[pair].x}, ${move.powerUpBlockPairs[pair].y}, ${move.powerUpBlockPairs[pair].element.id}; ${move.powerUpBlockPairs[pair].x}, ${move.powerUpBlockPairs[pair].y}, ${move.powerUpBlockPairs[pair].element.id}|`;
                // }
                // console.log(powerUpPairLog);
                setTimeout(function() {
                    updateUserStatistics();
                    updateBlock(move.powerUpBlockPairs[1]);
                    move.powerUpBlockPairs[1].element.style.transform = "scale(1)";
                    removeBlock(move.powerUpBlockPairs[0]);
                    move.powerUpBlockPairs.splice(0, 2);
                    statistics.blocksToRemove.splice(0, 1);
                    window[storage].setItem("blocks", JSON.stringify(blocks));
                    // powerUpPairLog = "removed powerUpBlockPair:";
                    // for (pair = 0; pair < move.powerUpBlockPairs.length; pair += 2) {
                    //     powerUpPairLog += ` ${move.powerUpBlockPairs[pair].x}, ${move.powerUpBlockPairs[pair].y}, ${move.powerUpBlockPairs[pair].element.id}; ${move.powerUpBlockPairs[pair].x}, ${move.powerUpBlockPairs[pair].y}, ${move.powerUpBlockPairs[pair].element.id}|`;
                    // }
                    // console.log(powerUpPairLog);
                }, (120*configuration.transitions)+10);
            }
            switch (direction) {
                case "right":
                    blocks[localBlock].y += moveSteps-1;
                    break;
                case "up":
                    blocks[localBlock].x -= moveSteps-1;
                    break;
                case "left":
                    blocks[localBlock].y -= moveSteps-1;
                    break;
                case "down":
                    blocks[localBlock].x += moveSteps-1;
                    break;
                default:
                    break;
            }
            updateBlock(blocks[localBlock]);
        }

        function updateUserStatistics() {
            document.getElementById("game-score-value").innerHTML = Math.round(statistics.score);
            document.getElementById("game-highest-score-value").innerHTML = Math.round(statistics.highestScores[`grid${configuration.gridSize}`]);
        }

        function removeBlock(blockObject) {
            // console.log(`removing block ${blockObject.element.id}`);
            blockObject.element.remove();
            blockindex = 0;
            for ([index, block] of blocks.entries()) {
                if (blockObject == block) {
                    blockIndex = index;
                }
            }
            blocks.splice(blockIndex, 1);
        }

        function getBlockFromPosition(x, y) {
            // console.log(`getting block from position ${x}, ${y}`);
            blockIndex = false;
            for ([index, block] of blocks.entries()) {
                if (block.x == x && block.y == y) {
                    // console.log(`${block.element.id} has same position of ${x}, ${y}, checking if it isn't about to be removed`);
                    blockRemoved = false;
                    for (blockToRemove of statistics.blocksToRemove) {
                        if (blockToRemove == block) {
                            blockRemoved = true;
                        }
                    }
                    if (!blockRemoved) {
                        if (blockIndex != false) {
                            // console.error(`both blocks ${block.element.id} and ${blocks[blockIndex].element.id} were found on position ${x}, ${y}`);
                        }
                        // console.log(`${block.element.id} was not removed hence setting as a result`);
                        blockIndex = index;
                    }
                }
            }
            return blockIndex;
        }

        function getReadableTextColor(backgroundRGB) {
            backgroundRGB = getRGBvalues(backgroundRGB);
            R = backgroundRGB[1]*1;
            G = backgroundRGB[2]*1;
            B = backgroundRGB[3]*1;
            if (R <= 10) {
                Rg = R/3294;
            } else {
                Rg = Math.pow(R/269 + 0.0513, 2.4);
            }
            if (G <= 10) {
                Gg = G/3294;
            } else {
                Gg = Math.pow(G/269 + 0.0513, 2.4);
            }
            if (B <= 10) {
                Bg = B/3294;
            } else {
                Bg = Math.pow(B/269 + 0.0513, 2.4);
            }
            relativeLumninance = 0.2126 * Rg + 0.7152 * Gg + 0.0722 * Bg;
            if (relativeLumninance < 0.5) {
                return "white";
            } else {
                return "black";
            }
        }

        function createBlock(power) {
            do {
                startX = getRandomNumber(0, configuration.gridSize-1);
                startY = getRandomNumber(0, configuration.gridSize-1);
            }
            while (getBlockFromPosition(startX, startY) !== false);
            blockElement = document.createElement("div");
            blockElement.id = `block${statistics.blocksCreated}`;
            blockElement.setAttribute("class", "block");
            document.getElementById("blocks-container").appendChild(blockElement);
            statistics.hiddenBlocks.push(blockElement);
            setTimeout(function() {
                statistics.hiddenBlocks[0].style.transform = "scale(1)";
                statistics.hiddenBlocks.splice(0, 1);
            }, 10);
            blocks[blocks.length] = {x: startX, y: startY, power: power, element: blockElement, elementId: `block${statistics.blocksCreated}`};
            blocks[blocks.length-1].element.style.color = getReadableTextColor(configuration.powerColors[blocks[blocks.length-1].power-1]);
            statistics.blocksCreated++;
            // console.log(`created play block ${blocks[blocks.length-1].element.id} on position ${startX}, ${startY} with power of ${power}`);
            return blocks[blocks.length-1];
        }

        function restoreBlock(block) {
            blockElement = document.createElement("div");
            blockElement.id = block.elementId;
            blockElement.setAttribute("class", "block");
            blockElement.style.backgroundColor = `var(--power${block.power}-color)`;
            blockElement.style.color = getReadableTextColor(configuration.powerColors[block.power-1]);
            document.getElementById("blocks-container").appendChild(blockElement);
            statistics.hiddenBlocks.push(blockElement);
            setTimeout(function() {
                statistics.hiddenBlocks[0].style.transform = "scale(1)";
                statistics.hiddenBlocks.splice(0, 1);
            }, 10);
            block.element = blockElement;
            return block
        }
        
        if (window.location.href.includes("sweb.cz")) {
            setTimeout(function() {
                try {
                    var banners = document.querySelectorAll("div[id='sklik-banner']");
                    for (banner of banners) {
                        banner.style.display = "none";
                    }
                } catch (error) {
                    
                }
            }, 100);
        }

        function updateBoard(transitions) {
            // console.log("updating play board");
            for (block of blocks) {
                updateBlock(block);
            }
        }

        function updateBlock(block) {
            // console.log(`updating block ${block.element.id}`);
            originalBoxScale = cssVariables.style.getPropertyValue("--box-scale");
            cssVariables.style.setProperty("--box-scale", "scale(1)");
            block.element.style.top = document.getElementById(`box${block.x}-${block.y}`).getBoundingClientRect().top + scrollY + "px";
            block.element.style.left = document.getElementById(`box${block.x}-${block.y}`).getBoundingClientRect().left + scrollX + "px";
            cssVariables.style.setProperty("--box-scale", originalBoxScale);
            block.element.innerHTML = Math.pow(2, block.power);
            if (block.power > 9) {
                if (innerWidth > innerHeight) {
                    boardSize = innerHeight*0.65;
                } else {
                    boardSize = innerWidth*0.65;
                }
                if (block.power > 14) {
                    sizeMultiplier = 0.65;
                } else {
                    sizeMultiplier = 0.8;
                }
                block.element.style.fontSize = `${((boardSize/configuration.gridSize)/2.5)*sizeMultiplier}px`;
            }
            block.element.style.color = getReadableTextColor(configuration.powerColors[block.power-1]);
        }

        function getRandomNumber(from, to) {
            number = Math.round((Math.random()*(to+1-from))+(from-0.5))*1;
            if (number == -0) {
                number = 0;
            }
            return number;
        }

        // https://github.com/john-doherty/swiped-events
        (function (window, document) {

            'use strict';

            // patch CustomEvent to allow constructor creation (IE/Chrome)
            if (typeof window.CustomEvent !== 'function') {

                window.CustomEvent = function (event, params) {

                    params = params || { bubbles: false, cancelable: false, detail: undefined };

                    var evt = document.createEvent('CustomEvent');
                    evt.initCustomEvent(event, params.bubbles, params.cancelable, params.detail);
                    return evt;
                };

                window.CustomEvent.prototype = window.Event.prototype;
            }

            document.addEventListener('touchstart', handleTouchStart, false);
            document.addEventListener('touchmove', handleTouchMove, false);
            document.addEventListener('touchend', handleTouchEnd, false);

            var xDown = null;
            var yDown = null;
            var xDiff = null;
            var yDiff = null;
            var timeDown = null;
            var startEl = null;

            /**
             * Fires swiped event if swipe detected on touchend
             * @param {object} e - browser event object
             * @returns {void}
             */
            function handleTouchEnd(e) {

                // if the user released on a different target, cancel!
                if (startEl !== e.target) return;

                var swipeThreshold = parseInt(getNearestAttribute(startEl, 'data-swipe-threshold', '20'), 10); // default 20px
                var swipeTimeout = parseInt(getNearestAttribute(startEl, 'data-swipe-timeout', '500'), 10);    // default 500ms
                var timeDiff = Date.now() - timeDown;
                var eventType = '';
                var changedTouches = e.changedTouches || e.touches || [];

                if (Math.abs(xDiff) > Math.abs(yDiff)) { // most significant
                    if (Math.abs(xDiff) > swipeThreshold && timeDiff < swipeTimeout) {
                        if (xDiff > 0) {
                            eventType = 'swiped-left';
                        }
                        else {
                            eventType = 'swiped-right';
                        }
                    }
                }
                else if (Math.abs(yDiff) > swipeThreshold && timeDiff < swipeTimeout) {
                    if (yDiff > 0) {
                        eventType = 'swiped-up';
                    }
                    else {
                        eventType = 'swiped-down';
                    }
                }

                if (eventType !== '') {

                    var eventData = {
                        dir: eventType.replace(/swiped-/, ''),
                        touchType: (changedTouches[0] || {}).touchType || 'direct',
                        xStart: parseInt(xDown, 10),
                        xEnd: parseInt((changedTouches[0] || {}).clientX || -1, 10),
                        yStart: parseInt(yDown, 10),
                        yEnd: parseInt((changedTouches[0] || {}).clientY || -1, 10)
                    };

                    // fire `swiped` event event on the element that started the swipe
                    startEl.dispatchEvent(new CustomEvent('swiped', { bubbles: true, cancelable: true, detail: eventData }));

                    // fire `swiped-dir` event on the element that started the swipe
                    startEl.dispatchEvent(new CustomEvent(eventType, { bubbles: true, cancelable: true, detail: eventData }));
                }

                // reset values
                xDown = null;
                yDown = null;
                timeDown = null;
            }

            /**
             * Records current location on touchstart event
             * @param {object} e - browser event object
             * @returns {void}
             */
            function handleTouchStart(e) {

                // if the element has data-swipe-ignore="true" we stop listening for swipe events
                if (e.target.getAttribute('data-swipe-ignore') === 'true') return;

                startEl = e.target;

                timeDown = Date.now();
                xDown = e.touches[0].clientX;
                yDown = e.touches[0].clientY;
                xDiff = 0;
                yDiff = 0;
            }

            /**
             * Records location diff in px on touchmove event
             * @param {object} e - browser event object
             * @returns {void}
             */
            function handleTouchMove(e) {

                if (!xDown || !yDown) return;

                var xUp = e.touches[0].clientX;
                var yUp = e.touches[0].clientY;

                xDiff = xDown - xUp;
                yDiff = yDown - yUp;
            }

            /**
             * Gets attribute off HTML element or nearest parent
             * @param {object} el - HTML element to retrieve attribute from
             * @param {string} attributeName - name of the attribute
             * @param {any} defaultValue - default value to return if no match found
             * @returns {any} attribute value or defaultValue
             */
            function getNearestAttribute(el, attributeName, defaultValue) {

                // walk up the dom tree looking for attributeName
                while (el && el !== document.documentElement) {

                    var attributeValue = el.getAttribute(attributeName);

                    if (attributeValue) {
                        return attributeValue;
                    }

                    el = el.parentNode;
                }

                return defaultValue;
            }

        }(window, document));

    </script>

</html>
