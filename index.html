<!DOCTYPE html>
<html lang="en">   
    
    <head>

        <meta charset="UTF-8"/>
        <title>2ⁿ</title>
        <meta lang="en"/>
        <meta name="viewport" content="width=device-width, height=device-height, initial-scale=1.0, shrink-to-fit=no, viewport-fit=cover"/>
        <link rel="manifest" href="manifest.json"/>
        <link rel="icon" type="image/svg+xml" href="favicon.svg"/>
        <link rel="icon" type="image/png" sizes="256x256" href="favicon.png"/>
        <meta name="theme-color" content="#282828" />
        <meta property="og:title" content="2ⁿ"/>
        <meta property="og:description" content="2ⁿ game"/>
        <meta property="twitter:title" content="2ⁿ"/>
        <meta property="twitter:description" content="2ⁿ game"/>
    
    </head>

    <style>

        @font-face {
            font-family: 'Exo 2';
            src: url('fonts/Exo2-Regular.woff2') format('woff2'),
                url('fonts/Exo2-Regular.woff') format('woff');
            font-weight: normal;
            font-style: normal;
            font-display: swap;
        }

        @font-face {
            font-family: 'Exo 2';
            src: url('fonts/Exo2-Italic.woff2') format('woff2'),
                url('fonts/Exo2-Italic.woff') format('woff');
            font-weight: normal;
            font-style: italic;
            font-display: swap;
        }

        @keyframes splash-block1 {

            0% {
                z-index: 1;
                transform: translate(-46px, -46px) scale(1.2);
            }

            25% {
                z-index: 0;
                transform: translate(-46px, 46px) scale(0);
            }

            50% {
                z-index: 0;
                transform: translate(-46px, -46px) scale(0);
            }

            75% {
                z-index: 1;
                transform: translate(-46px, -46px) scale(1);
            }

            100% {
                z-index: 1;
                transform: translate(-46px, -46px) scale(1.2);
            }

        }

        @keyframes splash-block2 {

            0% {
                z-index: 1;
                transform: translate(-46px, 46px) scale(1);
            }

            25% {
                z-index: 1;
                transform: translate(-46px, 46px) scale(1.2);
            }

            50% {
                z-index: 0;
                transform: translate(46px, 46px) scale(0);
            }

            75% {
                transform: translate(-46px, 46px) scale(0);
            }

            100% {
                z-index: 1;
                transform: translate(-46px, 46px) scale(1);
            }

        }

        @keyframes splash-block3 {

            0% {
                z-index: 0;
                transform: translate(46px, 46px) scale(0);
            }

            25% {
                z-index: 1;
                transform: translate(46px, 46px) scale(1);
            }

            50% {
                z-index: 1;
                transform: translate(46px, 46px) scale(1.2);
            }

            75% {
                z-index: 0;
                transform: translate(46px, -46px) scale(0);
            }

            100% {
                z-index: 0;
                transform: translate(46px, 46px) scale(0);
            }

        }

        @keyframes splash-block4 {

            0% {
                z-index: 0;
                transform: translate(46px, -46px) scale(0);
            }

            25% {
                z-index: 0;
                transform: translate(46px, -46px) scale(0);
            }

            50% {
                z-index: 1;
                transform: translate(46px, -46px) scale(1);
            }

            75% {
                z-index: 0;
                transform: translate(46px, -46px) scale(1.2);
            }

            100% {
                transform: translate(-46px, -46px) scale(0);
                z-index: 0;
            }

        }

        @keyframes show-warnings {

            0% {
                opacity: 0;
            }

            0.2% {
                opacity: 1;
                transform: translateY(0);
            }

            100% {
                opacity: 1;
                transform: translateY(0);
            }

        }

        :root {
            --accent-color: rgb(80, 80, 80);
            --accent-text-color: white;
            --background-color: white;
            --text-color: black;
            --warning-color: rgb(255, 205, 0);
            --pale-color: rgb(230, 230, 230);
            --box-background: rgb(255, 255, 255);
            --box-size: 60px;
            --box-margin: 5px;
            --box-scale: scale(0.98);
            --box-border-radius: 6px;
            --block-font-size: 24px;
            --play-board-background: rgb(40, 40, 40);
            --play-board-shadows: 5px -5px 8px 0px rgba(0,0,0,0.35);
            /* --block-transitions: top 120ms ease-in-out, left 120ms ease-in-out, transform 120ms ease-in-out, background-color 240ms ease-in-out, color 240ms ease-in-out;
            --power1-color: rgb(182, 215, 168);
            --power2-color: rgb(147, 196, 125);
            --power3-color: rgb(106, 168, 79);
            --power4-color: rgb(234, 153, 153);
            --power5-color: rgb(224, 102, 102);
            --power6-color: rgb(204, 0, 0);
            --power7-color: rgb(159, 197, 232);
            --power8-color: rgb(111, 168, 220);
            --power9-color: rgb(61, 133, 198);
            --power10-color: rgb(249, 203, 156);
            --power11-color: rgb(246, 178, 107);
            --power12-color: rgb(230, 145, 56);
            --power13-color: rgb(180, 167, 214);
            --power14-color: rgb(142, 124, 195);
            --power15-color: rgb(103, 78, 167); */
        }

        body {
            margin: 0;
            color: var(--text-color);
            overflow: hidden;
            background-color: var(--background-color);
            text-align: center;
            font-family: 'Exo 2', Arial;
        }

        input {
            font-family: inherit;
            color: inherit;
        }

        button {
            cursor: pointer;
            padding: 8px 12px;
            margin: 10px 16px;
            font-family: inherit;
            background-color: var(--accent-color);
            border-radius: 9px;
            border: none;
            color: var(--accent-text-color);
            text-transform: uppercase;
            display: inline-flex;
            justify-content: center;
            align-items: center;
            user-select: none;
            font-weight: bold;
            transition: transform 60ms ease-in-out, outline 60ms ease-in-out;
        }

        a {
            cursor: pointer;
            text-decoration: underline;
        }

        hr {
            opacity: 0.5;
            margin: 5px 0;
            border: none;
            height: 3px;
            background-color: var(--text-color);
        }

        button:hover {
            filter: brightness(1.2);
        }

        button:active {
            outline: 3px solid var(--accent-color);
            outline-offset: 2px;
        }

        input[type=range] {
            cursor: grab;
        }

        select {
            padding: 4px;
            outline: none;
            cursor: pointer;
            transition: outline 60ms cubic-bezier(0.7, 0, 0.3, 1);
        }

        select:active {
            outline: 3px solid var(--accent-color);
            outline-offset: 2px;
        }

        input[type=checkbox] {
            cursor: pointer;
            border-radius: 9px;
            width: 25px;
            height: 25px;
            transition: outline 60ms cubic-bezier(0.7, 0, 0.3, 1);
        }

        input[type=checkbox]:active {
            outline: 3px solid var(--accent-color);
            outline-offset: 2px;
        }

        input[type=number] {
            background-color: var(--pale-color);
            border: none;
            outline: none;
            border-bottom: 3px solid var(--text-color);
        }

        input[type=number]:focus {
            background-color: var(--background-color);
        }

        button .icon {
            margin-right: 5px;
        }

        nav {
            background-color: var(--accent-color);
            position: fixed;
            box-shadow: 5px -5px 6px 0px rgba(0,0,0,0.35);
        }

        nav.bottom {
            bottom: 0;
            display: flex;
            justify-content: space-evenly;
            align-items: center;
            height: 65px;
            width: 100%;
        }

        nav.side {
            padding-top: 12px;
            left: 0;
            height: 100%;
            width: 65px;
        }

        nav .item {
            display: flex;
            transition: opacity 150ms ease-in-out, transform 150ms ease-in-out;
            flex-shrink: 0;
            cursor: pointer;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            user-select: none;
        }

        nav .item.nonactive {
            opacity: 0.5;
            transform: scale(1);
        }

        nav .item.nonactive:hover {
            opacity: 0.75;
        }

        nav.bottom .item {
            height: 100%;
            width: 33%;
        }

        nav.side .item {
            padding: 12px 0;
        }

        nav .item.active {
            opacity: 1;
            transform: scale(1.15);
        }

        nav .item .title {
            color: var(--accent-text-color);
            font-size: 12px;
            margin-top: -1px;
        }

        main {
            position: fixed;
            left: 0;
            right: 0;
            top: 0;
            bottom: 0;
            margin: auto;
            display: flex;
            flex-direction: column;
        }

        [id^=row] {
            display: flex;
        }

        [id$=-option] {
            padding: 12px 15px;
            display: flex;
            justify-content: center;
            align-items: center;
            text-align: center;
        }

        [id$=-fab] {
            z-index: 2;
            position: fixed;
            padding: 12px;
            box-shadow: 5px -5px 8px 0px rgba(0,0,0,0.35);
        }

        .tab#play-tab {
            justify-content: center;
            align-items: center;
            width: 100%;
            height: 100%;
            flex-direction: column;
        }

        .tab {
            text-align: center;
            opacity: 0;
            display: none;
            transition: opacity 120ms linear;
        }

        .bottom-descriptor {
            font-style: italic;
            font-size: 12px;
            margin-top: -7px;
            text-align: left;
            padding: 0 10px 10px 10px;
        }

        .descriptor {
            font-style: italic;
            font-size: 14px;
            text-align: left;
            padding: 10px;
        }

        .color-input-container:active {
            outline: 3px solid var(--accent-color);
            outline-offset: 2.5px;
        }

        .box {
            transform: var(--box-scale);
            margin: var(--box-margin);
            width: var(--box-size);
            height: var(--box-size);
            background-color: var(--box-background);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            border-radius: var(--box-border-radius);
            box-shadow: inset var(--play-board-shadows);
        }

        .button-svg {
            vertical-align: middle;
            margin-right: 5px;
        }

        .block {
            left: 0;
            top: 0;
            font-size: var(--block-font-size);
            z-index: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            position: absolute;
            width: var(--box-size);
            height: var(--box-size);
            border-radius: var(--box-border-radius);
            background-color: var(--power1-color);
            color: white;
            transform: scale(0);
            transition: var(--block-transitions);
            box-shadow: var(--play-board-shadows);
        }

        .expand {
            display: flex;
            flex-direction: column;
        }

        .expand .head {
            padding: 8px 3px;
            user-select: none;
            display: flex;
            align-items: center;
            cursor: pointer;
            justify-content: left;
        }

        .expand .head:hover {
            filter: brightness(0.8);
        }

        .expand .head .icon {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 10px;
        }

        .expand .head .title {
            margin: 0;
            padding: 0 8px;
            width: 100%;
            text-align: left;
        }

        .expand .head .caret {
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            padding: 10px;
        }

        .expand .head .caret .svg {
            transition: transform 200ms ease-in-out;
        }

        .expand .animator {
            height: 0;
            overflow: hidden;
            transition: opacity 200ms linear, height 200ms ease-in-out;
        }

        .setup {
            padding: 8px 0;
            display: flex;
            align-items: center;
            justify-content: left;
        }

        .setup .name {
            font-size: 20px;
            padding: 10px;
            width: 100%;
            text-align: left;
        }

        .setup .actions {
            padding-right: 10px;
            flex-shrink: 0;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .setup .action {
            margin: 6px;
            padding: 8px;
        }

        .range-option, .check-option {
            padding: 14px 0 12px 0;
            display: flex;
            align-items: center;
            justify-content: left;
        }

        .statistic {
            border-radius: 9px;
            padding: 5px 13px 5px 0;
            margin: 7px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            border: 3px dashed var(--text-color);
        }

        .range-option .icon , .check-option .icon, .statistic .icon {
            width: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 10px;
            flex-shrink: 0;
        }

        .range-option .icon .color-preview {
            width: 40px;
            height: 40px;
            border-radius: 9px;
            background-color: black;
        }

        .range-option .value {
            padding: 0 10px;
            width: 100%;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            flex-direction: column;
        }

        .check-option .value {
            padding: 10px;
            width: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: row;
        }

        .range-option .value .title {
            padding-bottom: 8px;
        }

        .check-option .value .title {
            padding-right: 8px;
            text-align: left;
            width: 100%;
        }

        .statistic .value .title {
            padding-bottom: 6px;
        }

        .range-option .value .input {
            width: 100%;
            display: flex;
            align-items: center;
        }

        .check-option .value .input {
            flex-shrink: 0;
        }

        .statistic .value .input {
            width: 100%;
            display: flex;
            align-items: center;
            font-weight: bold;
        }

        .range-option .value .input .range {
            width: 100%;
        }

        .range-option .value .input .number {
            margin-left: 15px;
            flex-shrink: 0;
            width: 38px;
            text-align: left;
        }

        .warning {
            border: 3px solid var(--warning-color);
            padding: 6px;
            margin: 0 8px 8px 8px;
            display: inline-flex;
            justify-content: center;
            align-items: center;
            border-radius: 9px;
            max-width: 400px;
        }

        .warning .icon {
            width: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 10px;
            flex-shrink: 0;
        }

        .warning .text {
            font-size: 13px;
            color: var(--warning-color);
        }

        #game-area {
            margin: 6px 0;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        #play-fab {
            bottom: 85px;
            right: 20px;
            transition: transform 120ms ease-in-out;
        }

        #play-board {
            -webkit-tap-highlight-color: transparent;
            user-select: none;
            cursor: pointer;
            margin: 6px;
            border: var(--box-margin) solid var(--play-board-background);
            background-color: var(--play-board-background);
            width: -moz-fit-content;
            width: fit-content;
            height: -moz-fit-content;
            height: fit-content;
            position: relative;
            box-shadow: var(--play-board-shadows);
        }

        #dimmer {
            display: none;
            position: fixed;
            z-index: 2;
            left: 0;
            right: 0;
            bottom: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.6);
            opacity: 0;
            transition: opacity 300ms linear;
        }

        #menu {
            padding: 10px;
            overflow-y: auto;
            border-radius: 9px 9px 0 0;
            z-index: 2;
            background-color: var(--background-color);
            position: fixed;
            height: calc(100% + 9px);
            margin: auto;
            transition: transform 300ms ease-in-out;
        }

        #game-container {
            padding-top: 10px;
            touch-action: pinch-zoom;
            position: fixed;
            left: 0;
            right: 0;
            top: 0;
            bottom: 0;
            margin: auto;
        }

        #splashscreen {
            z-index: 5;
            position: fixed;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
            height: 100%;
            background-color: rgb(40, 40, 40);
            left: 0;
            right: 0;
            bottom: 0;
            top: 0;
            margin: auto;
            transition: opacity 150ms linear;
        }

        #splash-block1, #splash-block2, #splash-block3, #splash-block4 {
            width: 65px;
            height: 65px;
            border-radius: 9px;
            background-color: white;
            box-shadow: 0 0 8px 0 rgba(0,0,0,0.35);
            position: absolute;
        }

        #warnings-container {
            opacity: 0;
            z-index: 6;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            margin: auto;
            transform: translateY(60%);
        }

        #warnings {
            background-color: rgb(40, 40, 40);
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column-reverse;
        }

        #add-setup {
            margin-top: 20px;
            padding: 10px;
        }

        #toast {
            z-index: 4;
            border: 3px solid var(--accent-color);
            cursor: pointer;
            width: fit-content;
            border-radius: 9px;
            box-shadow: 5px -5px 8px 0px rgba(0,0,0,0.35);
            background-color: var(--background-color);
            position: fixed;
            top: 25px;
            right: 0;
            left: 0;
            margin: auto;
            max-width: 85%;
            display: none;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transform: translateY(-20px);
            transition: opacity 120ms linear, transform 150ms ease-in-out;
        }

        #toast #toast-icon {
            display: flex;
            padding: 10px;
            align-items: center;
            justify-content: center;
        }

        #toast #toast-text {
            display: flex;
            padding: 10px 12px 10px 0;
            align-items: center;
            justify-content: center;
        }

        #version {
            padding: 8px;
            font-size: 14px;
            position: absolute;
            top: 0;
            right: 0;
            z-index: 7;
        }

        #tabs {
            padding: 12px;
            text-align: center;
            overflow: hidden;
        }

        #nav-placeholder.bottom {
            flex-shrink: 0;
            height: 65px;
            width: 100%;
        }

        #nav-placeholder.side {
            flex-shrink: 0;
            height: 100%;
            width: 65px;
        }

    </style>

    <body>

        <!-- RELATIVE ELEMENTS -->
        <main>

            <!-- place for current tab -->
            <div id="tabs" style="height: 100%;">

                <!-- settings tab -->
                <div id="configuration-tab" class="tab">

                    <div id="top-menu-fab-placeholder" style="height: 60px;"></div>

                    <!-- head title -->
                    <h1>Configuration & Other</h1>
                    <hr>

                    <!-- about game category -->
                    <div id="expand-info" class="expand">

                        <!-- expander header -->
                        <div class="head" onclick="expandPart('info');">
                            <div class="icon">
                                <svg xmlns="http://www.w3.org/2000/svg" height="30px" viewBox="0 0 24 24" width="30px" fill=var(--text-color)><path d="M0 0h24v24H0V0z" fill="none"/><path d="M11 7h2v2h-2zm0 4h2v6h-2zm1-9C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8z"/></svg>
                            </div>
                            <h2 class="title">About game</h2>
                            <div class="caret">
                                <svg id="expand-info-caret" class="svg" xmlns="http://www.w3.org/2000/svg" height="30px" viewBox="0 0 24 24" width="30px" fill=var(--text-color)><path d="M24 24H0V0h24v24z" fill="none" opacity=".87"/><path d="M16.59 8.59L12 13.17 7.41 8.59 6 10l6 6 6-6-1.41-1.41z"/></svg>
                            </div>
                        </div>
                        <div id="expand-info-animator" class="animator">
                            <!-- category content -->
                            <div style="text-align: left;" id="expand-info-content">
                                <hr>

                                <div style="padding: 10px;">
                                    <p>
                                        Do you know game called 2048? Well this is really the same concept, just with some enhancements here and there. <b>Tutorials are boring. This is a trivial game and you will learn while playing. This text is here for people who want to care. Move to the play tab via bottom bar.</b>
                                    </p>
                                    <h3>Rules</h3>
                                    <p>
                                        The game is fairly simple. you can move blocks in 4 directions over the grid and they collide with each other. If 2 blocks of the same number collide, they join and create a new block with 2 times bigger number. For joining a pair of blocks and creating a new block with higher number you earn same number of points as is the value of the new block. So if you join 2 + 2 = 4 you get 4 points.
                                        <br>
                                        The amount of space on the grid is not infinite of course and soon or later you will face a scarsity of free cells on the grid and you may get totally stuck without being able to move at all. If that happens you can undo your last move, but you can only do this 3 times in 1 game!
                                    </p>
                                    <h3>Controls</h3>
                                    <p>
                                        If you are on device with touchscreen you can swipe over any place on the play tab except the tab menu itself. This is propably the most convenient way how to play the game and of course on devices with keyboard you can use wsad or arrow keys to move the blocks.
                                        <br>
                                        For added accessibility for touchscreen devices without swipe support you can tap or click on parts of the play grid to move blocks in that direction. You can also press space to start a new game or press backspace to undo your last block move.
                                    </p>
                                </div>
                            </div>
                        </div>

                    </div>
                    <hr>

                    <!-- configuration category -->
                    <div id="expand-configuration" class="expand">

                        <!-- expand header -->
                        <div class="head" onclick="expandPart('configuration');">
                            <div class="icon">
                                <svg class="svg" xmlns="http://www.w3.org/2000/svg" height="30px" viewBox="0 0 24 24" width="30px" fill=var(--text-color)><path d="M0 0h24v24H0V0z" fill="none"/><path d="M3 17v2h6v-2H3zM3 5v2h10V5H3zm10 16v-2h8v-2h-8v-2h-2v6h2zM7 9v2H3v2h4v2h2V9H7zm14 4v-2H11v2h10zm-6-4h2V7h4V5h-4V3h-2v6z"/></svg>
                            </div>
                            <h2 class="title">Settings</h2>
                            <div class="caret">
                                <svg id="expand-configuration-caret" class="svg" xmlns="http://www.w3.org/2000/svg" height="30px" viewBox="0 0 24 24" width="30px" fill=var(--text-color)><path d="M24 24H0V0h24v24z" fill="none" opacity=".87"/><path d="M16.59 8.59L12 13.17 7.41 8.59 6 10l6 6 6-6-1.41-1.41z"/></svg>
                            </div>
                        </div>
                        <div id="expand-configuration-animator" class="animator">
                            <!-- category content -->
                            <div id="expand-configuration-content" style="display: none;">
                                <hr>

                                <div class="descriptor">
                                    Customize game rules, look and effects.
                                </div>

                                <div class="range-option">
                                    <div class="icon">
                                        <svg xmlns="http://www.w3.org/2000/svg" height="30px" viewBox="0 0 24 24" width="30px" fill=var(--text-color)><path d="M0 0h24v24H0V0z" fill="none"/><path d="M20 2H4c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zM8 20H4v-4h4v4zm0-6H4v-4h4v4zm0-6H4V4h4v4zm6 12h-4v-4h4v4zm0-6h-4v-4h4v4zm0-6h-4V4h4v4zm6 12h-4v-4h4v4zm0-6h-4v-4h4v4zm0-6h-4V4h4v4z"/></svg>
                                    </div>
                                    <div class="value">
                                        <div class="title">Grid size</div>
                                        <div class="input">
                                            <input class="range" title="grid size" id="grid-size-range" type="range" min="2" max="6">
                                            <input class="number" type="number" id="grid-size-value">
                                        </div>
                                    </div>
                                </div>
                                <div class="bottom-descriptor">
                                    Sets size of the grid blocks move in to n*n. You need to start a new game to apply this settings.
                                </div>

                                <div class="range-option">
                                    <div class="icon">
                                        <svg xmlns="http://www.w3.org/2000/svg" enable-background="new 0 0 24 24" height="30px" viewBox="0 0 24 24" width="30px" fill=var(--text-color)><g><path d="M0,0h24v24H0V0z" fill="none"/></g><g><g><path d="M22,7V5h-3V2h-2v3h-4V2h-2v3H7V2H5v3H2v2h3v4H2v2h3v4H2v2h3v3h2v-3h4v3h2v-3h4v3h2v-3h3v-2h-3v-4h3v-2h-3V7H22z M7,7h4v4 H7V7z M7,17v-4h4v4H7z M17,17h-4v-4h4V17z M17,11h-4V7h4V11z"/></g></g></svg>
                                    </div>
                                    <div class="value">
                                        <div class="title">Box margin multiplier</div>
                                        <div class="input">
                                            <input class="range" title="box margin multiplier" id="box-margin-range" type="range" min="-5" max="20">
                                            <input class="number" type="number" id="box-margin-value">
                                        </div>
                                    </div>
                                </div>
                                <div class="bottom-descriptor">
                                    Multiplies default space between empty cells and blocks. negative values should work.
                                </div>

                                <div class="range-option">
                                    <div class="icon">
                                        <svg xmlns="http://www.w3.org/2000/svg" height="30px" viewBox="0 0 24 24" width="30px" fill=var(--text-color)><path d="M0 0h24v24H0z" fill="none"/><path d="M19 19h2v2h-2v-2zm0-2h2v-2h-2v2zM3 13h2v-2H3v2zm0 4h2v-2H3v2zm0-8h2V7H3v2zm0-4h2V3H3v2zm4 0h2V3H7v2zm8 16h2v-2h-2v2zm-4 0h2v-2h-2v2zm4 0h2v-2h-2v2zm-8 0h2v-2H7v2zm-4 0h2v-2H3v2zM21 8c0-2.76-2.24-5-5-5h-5v2h5c1.65 0 3 1.35 3 3v5h2V8z"/></svg>
                                    </div>
                                    <div class="value">
                                        <div class="title">Box border radius multiplier</div>
                                        <div class="input">
                                            <input class="range" title="Box border radius multiplier" id="box-border-radius-range" type="range" min="0" max="20">
                                            <input class="number" type="number" id="box-border-radius-value">
                                        </div>
                                    </div>
                                </div>
                                <div class="bottom-descriptor">
                                    Multiplies default border radius of empty cells, blocks and whole board.
                                </div>

                                <div class="range-option">
                                    <div class="icon">
                                        <svg xmlns="http://www.w3.org/2000/svg" enable-background="new 0 0 24 24" height="30px" viewBox="0 0 24 24" width="30px" fill=var(--text-color)><g><rect fill="none" height="24" width="24" x="0"/></g><g><g><path d="M15,2c-2.71,0-5.05,1.54-6.22,3.78c-1.28,0.67-2.34,1.72-3,3C3.54,9.95,2,12.29,2,15c0,3.87,3.13,7,7,7 c2.71,0,5.05-1.54,6.22-3.78c1.28-0.67,2.34-1.72,3-3C20.46,14.05,22,11.71,22,9C22,5.13,18.87,2,15,2z M9,20c-2.76,0-5-2.24-5-5 c0-1.12,0.37-2.16,1-3c0,3.87,3.13,7,7,7C11.16,19.63,10.12,20,9,20z M12,17c-2.76,0-5-2.24-5-5c0-1.12,0.37-2.16,1-3 c0,3.86,3.13,6.99,7,7C14.16,16.63,13.12,17,12,17z M16.7,13.7C16.17,13.89,15.6,14,15,14c-2.76,0-5-2.24-5-5 c0-0.6,0.11-1.17,0.3-1.7C10.83,7.11,11.4,7,12,7c2.76,0,5,2.24,5,5C17,12.6,16.89,13.17,16.7,13.7z M19,12c0-3.86-3.13-6.99-7-7 c0.84-0.63,1.87-1,3-1c2.76,0,5,2.24,5,5C20,10.12,19.63,11.16,19,12z"/></g></g></svg>
                                    </div>
                                    <div class="value">
                                        <div class="title">Transitions (animations) multiplier</div>
                                        <div class="input">
                                            <input class="range" title="Transitions (animations) multiplier" id="transitions-range" type="range" min="0" max="20">
                                            <input class="number" type="number" id="transitions-value">
                                        </div>
                                    </div>
                                </div>
                                <div class="bottom-descriptor">
                                    Multiplies default transition lenght of block positions.
                                </div>

                                <div class="range-option">
                                    <div class="icon">
                                        <svg style="transform: scale(-1);" xmlns="http://www.w3.org/2000/svg" height="30px" viewBox="0 0 24 24" width="30px" fill=var(--text-color)><path d="M0 0h24v24H0V0z" fill="none"/><path d="M3 5H1v16c0 1.1.9 2 2 2h16v-2H3V5zm18-4H7c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V3c0-1.1-.9-2-2-2zm0 16H7V3h14v14z"/></svg>
                                    </div>
                                    <div class="value">
                                        <div class="title">Offset X multiplier</div>
                                        <div class="input">
                                            <input class="range" title="Offset X multiplier" id="offsetX-range" type="range" min="-20" max="20">
                                            <input class="number" type="number" id="offsetX-value">
                                        </div>
                                    </div>
                                </div>
                                <div class="bottom-descriptor">
                                    Adds horizontal offset to every block position against its cell.
                                </div>

                                <div class="range-option">
                                    <div class="icon">
                                        <svg style="transform: scale(-1);" xmlns="http://www.w3.org/2000/svg" height="30px" viewBox="0 0 24 24" width="30px" fill=var(--text-color)><path d="M0 0h24v24H0V0z" fill="none"/><path d="M3 5H1v16c0 1.1.9 2 2 2h16v-2H3V5zm18-4H7c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V3c0-1.1-.9-2-2-2zm0 16H7V3h14v14z"/></svg>
                                    </div>
                                    <div class="value">
                                        <div class="title">Offset Y multiplier</div>
                                        <div class="input">
                                            <input class="range" title="Offset Y multiplier" id="offsetY-range" type="range" min="-20" max="20">
                                            <input class="number" type="number" id="offsetY-value">
                                        </div>
                                    </div>
                                </div>
                                <div class="bottom-descriptor">
                                    Adds vertical offset to every block position against its cell.
                                </div>

                                <div class="check-option">
                                    <div class="icon">
                                        <svg style="transform: scale(-1.4) scaleY(0.8);" xmlns="http://www.w3.org/2000/svg" enable-background="new 0 0 24 24" height="30px" viewBox="0 0 24 24" width="30px" fill=var(--text-color)><rect fill="none" height="24" width="24"/><path d="M18,2H9C7.9,2,7,2.9,7,4v12c0,1.1,0.9,2,2,2h9c1.1,0,2-0.9,2-2V4C20,2.9,19.1,2,18,2z M18,16H9V4h9V16z M3,15v-2h2v2H3z M3,9.5h2v2H3V9.5z M10,20h2v2h-2V20z M3,18.5v-2h2v2H3z M5,22c-1.1,0-2-0.9-2-2h2V22z M8.5,22h-2v-2h2V22z M13.5,22L13.5,22l0-2h2 v0C15.5,21.1,14.6,22,13.5,22z M5,6L5,6l0,2H3v0C3,6.9,3.9,6,5,6z"/></svg>
                                    </div>
                                    <div class="value">
                                        <div class="title">Use shadows</div>
                                        <div class="input">
                                            <input type="checkbox" title="Shadows" id="shadows-check">
                                        </div>
                                    </div>
                                </div>
                                <div class="bottom-descriptor">
                                    If allowed shadow will be used for blocks, cells and play board. <b>May lower performance of transitions.</b>
                                </div>

                                <div class="check-option">
                                    <div class="icon">
                                        <svg xmlns="http://www.w3.org/2000/svg" height="30px" viewBox="0 0 24 24" width="30px" fill=var(--text-color)><path d="M0 0h24v24H0V0z" fill="none"/><path d="M7 18h2V6H7v12zm4 4h2V2h-2v20zm-8-8h2v-4H3v4zm12 4h2V6h-2v12zm4-8v4h2v-4h-2z"/></svg>
                                    </div>
                                    <div class="value">
                                        <div class="title">Sound effects</div>
                                        <div class="input">
                                            <input type="checkbox" title="Sound Effects" id="sound-effects-check">
                                        </div>
                                    </div>
                                </div>
                                <div class="bottom-descriptor">
                                    If allowed different sound effects will be played on some in-game events.
                                </div>

                                <div class="check-option">
                                    <div class="icon">
                                        <svg xmlns="http://www.w3.org/2000/svg" height="30px" viewBox="0 0 24 24" width="30px" fill=var(--text-color)><path d="M0 0h24v24H0V0z" fill="none"/><path d="M20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69zm-2 5.79V18h-3.52L12 20.48 9.52 18H6v-3.52L3.52 12 6 9.52V6h3.52L12 3.52 14.48 6H18v3.52L20.48 12 18 14.48zM12 6.5v11c3.03 0 5.5-2.47 5.5-5.5S15.03 6.5 12 6.5z"/></svg>
                                    </div>
                                    <div class="value">
                                        <div class="title">UI mode</div>
                                        <div class="input">
                                            <select id="theme-select">
                                                <option value="auto">Automatic</option>
                                                <option value="light">Light</option>
                                                <option value="dark">Dark</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                                <div class="bottom-descriptor">
                                    Choose your preferred UI mode. By default the mode should change automatically according to your system settings.
                                </div>

                            </div>

                        </div>
                    </div>
                    <hr>

                    <!-- colors category -->
                    <div id="expand-colors" class="expand">
                        <div class="head" onclick="expandPart('colors');">
                            <div class="icon">
                                <svg class="svg" xmlns="http://www.w3.org/2000/svg" enable-background="new 0 0 24 24" height="30px" viewBox="0 0 24 24" width="30px" fill=var(--text-color)><g><rect fill="none" height="24" width="24"/></g><g><g><g><g><path d="M12,22C6.49,22,2,17.51,2,12S6.49,2,12,2s10,4.04,10,9c0,3.31-2.69,6-6,6h-1.77c-0.28,0-0.5,0.22-0.5,0.5 c0,0.12,0.05,0.23,0.13,0.33c0.41,0.47,0.64,1.06,0.64,1.67C14.5,20.88,13.38,22,12,22z M12,4c-4.41,0-8,3.59-8,8s3.59,8,8,8 c0.28,0,0.5-0.22,0.5-0.5c0-0.16-0.08-0.28-0.14-0.35c-0.41-0.46-0.63-1.05-0.63-1.65c0-1.38,1.12-2.5,2.5-2.5H16 c2.21,0,4-1.79,4-4C20,7.14,16.41,4,12,4z"/><circle cx="6.5" cy="11.5" r="1.5"/><circle cx="9.5" cy="7.5" r="1.5"/><circle cx="14.5" cy="7.5" r="1.5"/><circle cx="17.5" cy="11.5" r="1.5"/></g></g></g></g></svg>
                            </div>
                            <h2 class="title">Colors</h2>
                            <div class="caret">
                                <svg id="expand-colors-caret" class="svg" xmlns="http://www.w3.org/2000/svg" height="30px" viewBox="0 0 24 24" width="30px" fill=var(--text-color)><path d="M24 24H0V0h24v24z" fill="none" opacity=".87"/><path d="M16.59 8.59L12 13.17 7.41 8.59 6 10l6 6 6-6-1.41-1.41z"/></svg>
                            </div>
                        </div>
                        <div id="expand-colors-animator" class="animator">
                            <div class="expand-colors-content" style="text-align: left; display: none;" id="expand-colors-content">
                                <hr>

                                <div class="descriptor">
                                    Customize block color for every power of 2 from 2² up to 2¹⁵ and few other colors.
                                </div>

                                <div class="range-option">
                                    <div class="icon">
                                        <div class="color-preview" id="play-board-color-preview"></div>
                                    </div>
                                    <div class="value">
                                        <div class="title">Play board RGB</div>
                                        <div class="input">
                                            <input class="range" title="Play board red color" id="play-board-R-range" type="range" min="0" max="255">
                                            <input class="number" type="number" id="play-board-R-value" min="0" max="255">
                                        </div>
                                        <div class="input" style="padding: 6px 0;">
                                            <input class="range" title="Play board green color" id="play-board-G-range" type="range" min="0" max="255">
                                            <input class="number" type="number" id="play-board-G-value" min="0" max="255">
                                        </div>
                                        <div class="input">
                                            <input class="range" title="Play board blue color" id="play-board-B-range" type="range" min="0" max="255">
                                            <input class="number" type="number" id="play-board-B-value" min="0" max="255">
                                        </div>
                                    </div>
                                </div>

                                <div class="range-option">
                                    <div class="icon">
                                        <div class="color-preview" id="box-color-preview"></div>
                                    </div>
                                    <div class="value">
                                        <div class="title">Box RGB</div>
                                        <div class="input">
                                            <input class="range" title="Box red color" id="box-R-range" type="range" min="0" max="255">
                                            <input class="number" type="number" id="box-R-value" min="0" max="255">
                                        </div>
                                        <div class="input" style="padding: 6px 0;">
                                            <input class="range" title="Box green color" id="box-G-range" type="range" min="0" max="255">
                                            <input class="number" type="number" id="box-G-value" min="0" max="255">
                                        </div>
                                        <div class="input">
                                            <input class="range" title="Box blue color" id="box-B-range" type="range" min="0" max="255">
                                            <input class="number" type="number" id="box-B-value" min="0" max="255">
                                        </div>
                                    </div>
                                </div>

                                <div class="range-option">
                                    <div class="icon">
                                        <div class="color-preview" id="2power1-color-preview"></div>
                                    </div>
                                    <div class="value">
                                        <div class="title">2¹ block RGB</div>
                                        <div class="input">
                                            <input class="range" title="2 power 1 block red color" id="2power1-R-range" type="range" min="0" max="255">
                                            <input class="number" type="number" id="2power1-R-value" min="0" max="255">
                                        </div>
                                        <div class="input" style="padding: 6px 0;">
                                            <input class="range" title="2 power 1 block green color" id="2power1-G-range" type="range" min="0" max="255">
                                            <input class="number" type="number" id="2power1-G-value" min="0" max="255">
                                        </div>
                                        <div class="input">
                                            <input class="range" title="2 power 1 block blue color" id="2power1-B-range" type="range" min="0" max="255">
                                            <input class="number" type="number" id="2power1-B-value" min="0" max="255">
                                        </div>
                                    </div>
                                </div>

                                <div class="range-option">
                                    <div class="icon">
                                        <div class="color-preview" id="2power2-color-preview"></div>
                                    </div>
                                    <div class="value">
                                        <div class="title">2² block RGB</div>
                                        <div class="input">
                                            <input class="range" title="2 power 2 block red color" id="2power2-R-range" type="range" min="0" max="255">
                                            <input class="number" type="number" id="2power2-R-value" min="0" max="255">
                                        </div>
                                        <div class="input" style="padding: 6px 0;">
                                            <input class="range" title="2 power 2 block green color" id="2power2-G-range" type="range" min="0" max="255">
                                            <input class="number" type="number" id="2power2-G-value" min="0" max="255">
                                        </div>
                                        <div class="input">
                                            <input class="range" title="2 power 2 block blue color" id="2power2-B-range" type="range" min="0" max="255">
                                            <input class="number" type="number" id="2power2-B-value" min="0" max="255">
                                        </div>
                                    </div>
                                </div>

                                <div class="range-option">
                                    <div class="icon">
                                        <div class="color-preview" id="2power3-color-preview"></div>
                                    </div>
                                    <div class="value">
                                        <div class="title">2³ block RGB</div>
                                        <div class="input">
                                            <input class="range" title="2 power 3 block red color" id="2power3-R-range" type="range" min="0" max="255">
                                            <input class="number" type="number" id="2power3-R-value" min="0" max="255">
                                        </div>
                                        <div class="input" style="padding: 6px 0;">
                                            <input class="range" title="2 power 3 block green color" id="2power3-G-range" type="range" min="0" max="255">
                                            <input class="number" type="number" id="2power3-G-value" min="0" max="255">
                                        </div>
                                        <div class="input">
                                            <input class="range" title="2 power 3 block blue color" id="2power3-B-range" type="range" min="0" max="255">
                                            <input class="number" type="number" id="2power3-B-value" min="0" max="255">
                                        </div>
                                    </div>
                                </div>

                                <div class="range-option">
                                    <div class="icon">
                                        <div class="color-preview" id="2power4-color-preview"></div>
                                    </div>
                                    <div class="value">
                                        <div class="title">2⁴ block RGB</div>
                                        <div class="input">
                                            <input class="range" title="2 power 4 block red color" id="2power4-R-range" type="range" min="0" max="255">
                                            <input class="number" type="number" id="2power4-R-value" min="0" max="255">
                                        </div>
                                        <div class="input" style="padding: 6px 0;">
                                            <input class="range" title="2 power 4 block green color" id="2power4-G-range" type="range" min="0" max="255">
                                            <input class="number" type="number" id="2power4-G-value" min="0" max="255">
                                        </div>
                                        <div class="input">
                                            <input class="range" title="2 power 4 block blue color" id="2power4-B-range" type="range" min="0" max="255">
                                            <input class="number" type="number" id="2power4-B-value" min="0" max="255">
                                        </div>
                                    </div>
                                </div>

                                <div class="range-option">
                                    <div class="icon">
                                        <div class="color-preview" id="2power5-color-preview"></div>
                                    </div>
                                    <div class="value">
                                        <div class="title">2⁵ block RGB</div>
                                        <div class="input">
                                            <input class="range" title="2 power 5 block red color" id="2power5-R-range" type="range" min="0" max="255">
                                            <input class="number" type="number" id="2power5-R-value" min="0" max="255">
                                        </div>
                                        <div class="input" style="padding: 6px 0;">
                                            <input class="range" title="2 power 5 block green color" id="2power5-G-range" type="range" min="0" max="255">
                                            <input class="number" type="number" id="2power5-G-value" min="0" max="255">
                                        </div>
                                        <div class="input">
                                            <input class="range" title="2 power 5 block blue color" id="2power5-B-range" type="range" min="0" max="255">
                                            <input class="number" type="number" id="2power5-B-value" min="0" max="255">
                                        </div>
                                    </div>
                                </div>

                                <div class="range-option">
                                    <div class="icon">
                                        <div class="color-preview" id="2power6-color-preview"></div>
                                    </div>
                                    <div class="value">
                                        <div class="title">2⁶ block RGB</div>
                                        <div class="input">
                                            <input class="range" title="2 power 6 block red color" id="2power6-R-range" type="range" min="0" max="255">
                                            <input class="number" type="number" id="2power6-R-value" min="0" max="255">
                                        </div>
                                        <div class="input" style="padding: 6px 0;">
                                            <input class="range" title="2 power 6 block green color" id="2power6-G-range" type="range" min="0" max="255">
                                            <input class="number" type="number" id="2power6-G-value" min="0" max="255">
                                        </div>
                                        <div class="input">
                                            <input class="range" title="2 power 6 block blue color" id="2power6-B-range" type="range" min="0" max="255">
                                            <input class="number" type="number" id="2power6-B-value" min="0" max="255">
                                        </div>
                                    </div>
                                </div>

                                <div class="range-option">
                                    <div class="icon">
                                        <div class="color-preview" id="2power7-color-preview"></div>
                                    </div>
                                    <div class="value">
                                        <div class="title">2⁷ block RGB</div>
                                        <div class="input">
                                            <input class="range" title="2 power 7 block red color" id="2power7-R-range" type="range" min="0" max="255">
                                            <input class="number" type="number" id="2power7-R-value" min="0" max="255">
                                        </div>
                                        <div class="input" style="padding: 6px 0;">
                                            <input class="range" title="2 power 7 block green color" id="2power7-G-range" type="range" min="0" max="255">
                                            <input class="number" type="number" id="2power7-G-value" min="0" max="255">
                                        </div>
                                        <div class="input">
                                            <input class="range" title="2 power 7 block blue color" id="2power7-B-range" type="range" min="0" max="255">
                                            <input class="number" type="number" id="2power7-B-value" min="0" max="255">
                                        </div>
                                    </div>
                                </div>

                                <div class="range-option">
                                    <div class="icon">
                                        <div class="color-preview" id="2power8-color-preview"></div>
                                    </div>
                                    <div class="value">
                                        <div class="title">2⁸ block RGB</div>
                                        <div class="input">
                                            <input class="range" title="2 power 8 block red color" id="2power8-R-range" type="range" min="0" max="255">
                                            <input class="number" type="number" id="2power8-R-value" min="0" max="255">
                                        </div>
                                        <div class="input" style="padding: 6px 0;">
                                            <input class="range" title="2 power 8 block green color" id="2power8-G-range" type="range" min="0" max="255">
                                            <input class="number" type="number" id="2power8-G-value" min="0" max="255">
                                        </div>
                                        <div class="input">
                                            <input class="range" title="2 power 8 block blue color" id="2power8-B-range" type="range" min="0" max="255">
                                            <input class="number" type="number" id="2power8-B-value" min="0" max="255">
                                        </div>
                                    </div>
                                </div>

                                <div class="range-option">
                                    <div class="icon">
                                        <div class="color-preview" id="2power9-color-preview"></div>
                                    </div>
                                    <div class="value">
                                        <div class="title">2⁹ block RGB</div>
                                        <div class="input">
                                            <input class="range" title="2 power 9 block red color" id="2power9-R-range" type="range" min="0" max="255">
                                            <input class="number" type="number" id="2power9-R-value" min="0" max="255">
                                        </div>
                                        <div class="input" style="padding: 6px 0;">
                                            <input class="range" title="2 power 9 block green color" id="2power9-G-range" type="range" min="0" max="255">
                                            <input class="number" type="number" id="2power9-G-value" min="0" max="255">
                                        </div>
                                        <div class="input">
                                            <input class="range" title="2 power 9 block blue color" id="2power9-B-range" type="range" min="0" max="255">
                                            <input class="number" type="number" id="2power9-B-value" min="0" max="255">
                                        </div>
                                    </div>
                                </div>

                                <div class="range-option">
                                    <div class="icon">
                                        <div class="color-preview" id="2power10-color-preview"></div>
                                    </div>
                                    <div class="value">
                                        <div class="title">2¹⁰ block RGB</div>
                                        <div class="input">
                                            <input class="range" title="2 power 10 block red color" id="2power10-R-range" type="range" min="0" max="255">
                                            <input class="number" type="number" id="2power10-R-value" min="0" max="255">
                                        </div>
                                        <div class="input" style="padding: 6px 0;">
                                            <input class="range" title="2 power 10 block green color" id="2power10-G-range" type="range" min="0" max="255">
                                            <input class="number" type="number" id="2power10-G-value" min="0" max="255">
                                        </div>
                                        <div class="input">
                                            <input class="range" title="2 power 10 block blue color" id="2power10-B-range" type="range" min="0" max="255">
                                            <input class="number" type="number" id="2power10-B-value" min="0" max="255">
                                        </div>
                                    </div>
                                </div>

                                <div class="range-option">
                                    <div class="icon">
                                        <div class="color-preview" id="2power11-color-preview"></div>
                                    </div>
                                    <div class="value">
                                        <div class="title">2¹¹ block RGB</div>
                                        <div class="input">
                                            <input class="range" title="2 power 11 block red color" id="2power11-R-range" type="range" min="0" max="255">
                                            <input class="number" type="number" id="2power11-R-value" min="0" max="255">
                                        </div>
                                        <div class="input" style="padding: 6px 0;">
                                            <input class="range" title="2 power 11 block green color" id="2power11-G-range" type="range" min="0" max="255">
                                            <input class="number" type="number" id="2power11-G-value" min="0" max="255">
                                        </div>
                                        <div class="input">
                                            <input class="range" title="2 power 11 block blue color" id="2power11-B-range" type="range" min="0" max="255">
                                            <input class="number" type="number" id="2power11-B-value" min="0" max="255">
                                        </div>
                                    </div>
                                </div>

                                <div class="range-option">
                                    <div class="icon">
                                        <div class="color-preview" id="2power12-color-preview"></div>
                                    </div>
                                    <div class="value">
                                        <div class="title">2¹² block RGB</div>
                                        <div class="input">
                                            <input class="range" title="2 power 12 block red color" id="2power12-R-range" type="range" min="0" max="255">
                                            <input class="number" type="number" id="2power12-R-value" min="0" max="255">
                                        </div>
                                        <div class="input" style="padding: 6px 0;">
                                            <input class="range" title="2 power 12 block green color" id="2power12-G-range" type="range" min="0" max="255">
                                            <input class="number" type="number" id="2power12-G-value" min="0" max="255">
                                        </div>
                                        <div class="input">
                                            <input class="range" title="2 power 12 block blue color" id="2power12-B-range" type="range" min="0" max="255">
                                            <input class="number" type="number" id="2power12-B-value" min="0" max="255">
                                        </div>
                                    </div>
                                </div>

                                <div class="range-option">
                                    <div class="icon">
                                        <div class="color-preview" id="2power13-color-preview"></div>
                                    </div>
                                    <div class="value">
                                        <div class="title">2¹³ block RGB</div>
                                        <div class="input">
                                            <input class="range" title="2 power 13 block red color" id="2power13-R-range" type="range" min="0" max="255">
                                            <input class="number" type="number" id="2power13-R-value" min="0" max="255">
                                        </div>
                                        <div class="input" style="padding: 6px 0;">
                                            <input class="range" title="2 power 13 block green color" id="2power13-G-range" type="range" min="0" max="255">
                                            <input class="number" type="number" id="2power13-G-value" min="0" max="255">
                                        </div>
                                        <div class="input">
                                            <input class="range" title="2 power 13 block blue color" id="2power13-B-range" type="range" min="0" max="255">
                                            <input class="number" type="number" id="2power13-B-value" min="0" max="255">
                                        </div>
                                    </div>
                                </div>

                                <div class="range-option">
                                    <div class="icon">
                                        <div class="color-preview" id="2power14-color-preview"></div>
                                    </div>
                                    <div class="value">
                                        <div class="title">2¹⁴ block RGB</div>
                                        <div class="input">
                                            <input class="range" title="2 power 14 block red color" id="2power14-R-range" type="range" min="0" max="255">
                                            <input class="number" type="number" id="2power14-R-value" min="0" max="255">
                                        </div>
                                        <div class="input" style="padding: 6px 0;">
                                            <input class="range" title="2 power 14 block green color" id="2power14-G-range" type="range" min="0" max="255">
                                            <input class="number" type="number" id="2power14-G-value" min="0" max="255">
                                        </div>
                                        <div class="input">
                                            <input class="range" title="2 power 14 block blue color" id="2power14-B-range" type="range" min="0" max="255">
                                            <input class="number" type="number" id="2power14-B-value" min="0" max="255">
                                        </div>
                                    </div>
                                </div>

                                <div class="range-option">
                                    <div class="icon">
                                        <div class="color-preview" id="2power15-color-preview"></div>
                                    </div>
                                    <div class="value">
                                        <div class="title">2¹⁵ block RGB</div>
                                        <div class="input">
                                            <input class="range" title="2 power 15 block red color" id="2power15-R-range" type="range" min="0" max="255">
                                            <input class="number" type="number" id="2power15-R-value" min="0" max="255">
                                        </div>
                                        <div class="input" style="padding: 6px 0;">
                                            <input class="range" title="2 power 15 block green color" id="2power15-G-range" type="range" min="0" max="255">
                                            <input class="number" type="number" id="2power15-G-value" min="0" max="255">
                                        </div>
                                        <div class="input">
                                            <input class="range" title="2 power 15 block blue color" id="2power15-B-range" type="range" min="0" max="255">
                                            <input class="number" type="number" id="2power15-B-value" min="0" max="255">
                                        </div>
                                    </div>
                                </div>

                                <div class="range-option">
                                    <div class="icon">
                                        <div class="color-preview" id="2power16-color-preview"></div>
                                    </div>
                                    <div class="value">
                                        <div class="title">2¹⁶ block RGB</div>
                                        <div class="input">
                                            <input class="range" title="2 power 16 block red color" id="2power16-R-range" type="range" min="0" max="255">
                                            <input class="number" type="number" id="2power16-R-value" min="0" max="255">
                                        </div>
                                        <div class="input" style="padding: 6px 0;">
                                            <input class="range" title="2 power 16 block green color" id="2power16-G-range" type="range" min="0" max="255">
                                            <input class="number" type="number" id="2power16-G-value" min="0" max="255">
                                        </div>
                                        <div class="input">
                                            <input class="range" title="2 power 16 block blue color" id="2power16-B-range" type="range" min="0" max="255">
                                            <input class="number" type="number" id="2power16-B-value" min="0" max="255">
                                        </div>
                                    </div>
                                </div>

                                <div class="range-option">
                                    <div class="icon">
                                        <div class="color-preview" id="2power17-color-preview"></div>
                                    </div>
                                    <div class="value">
                                        <div class="title">2¹⁷ block RGB</div>
                                        <div class="input">
                                            <input class="range" title="2 power 17 block red color" id="2power17-R-range" type="range" min="0" max="255">
                                            <input class="number" type="number" id="2power17-R-value" min="0" max="255">
                                        </div>
                                        <div class="input" style="padding: 6px 0;">
                                            <input class="range" title="2 power 17 block green color" id="2power17-G-range" type="range" min="0" max="255">
                                            <input class="number" type="number" id="2power17-G-value" min="0" max="255">
                                        </div>
                                        <div class="input">
                                            <input class="range" title="2 power 17 block blue color" id="2power17-B-range" type="range" min="0" max="255">
                                            <input class="number" type="number" id="2power17-B-value" min="0" max="255">
                                        </div>
                                    </div>
                                </div>

                                <div class="range-option">
                                    <div class="icon">
                                        <div class="color-preview" id="2power18-color-preview"></div>
                                    </div>
                                    <div class="value">
                                        <div class="title">2¹⁸ block RGB</div>
                                        <div class="input">
                                            <input class="range" title="2 power 18 block red color" id="2power18-R-range" type="range" min="0" max="255">
                                            <input class="number" type="number" id="2power18-R-value" min="0" max="255">
                                        </div>
                                        <div class="input" style="padding: 6px 0;">
                                            <input class="range" title="2 power 18 block green color" id="2power18-G-range" type="range" min="0" max="255">
                                            <input class="number" type="number" id="2power18-G-value" min="0" max="255">
                                        </div>
                                        <div class="input">
                                            <input class="range" title="2 power 18 block blue color" id="2power18-B-range" type="range" min="0" max="255">
                                            <input class="number" type="number" id="2power18-B-value" min="0" max="255">
                                        </div>
                                    </div>
                                </div>

                            </div>
                        </div>
                    </div>
                    <hr>

                    <!-- setups category -->
                    <div id="expand-setups" class="expand">
                        <div class="head" onclick="expandPart('setups');">
                            <div class="icon">
                                <svg xmlns="http://www.w3.org/2000/svg" enable-background="new 0 0 24 24" height="30px" viewBox="0 0 24 24" width="30px" fill=var(--text-color)><g><path d="M0,0h24v24H0V0z" fill="none"/></g><g><g><path d="M4,18v-0.65c0-0.34,0.16-0.66,0.41-0.81C6.1,15.53,8.03,15,10,15c0.03,0,0.05,0,0.08,0.01c0.1-0.7,0.3-1.37,0.59-1.98 C10.45,13.01,10.23,13,10,13c-2.42,0-4.68,0.67-6.61,1.82C2.51,15.34,2,16.32,2,17.35V20h9.26c-0.42-0.6-0.75-1.28-0.97-2H4z"/><path d="M10,12c2.21,0,4-1.79,4-4s-1.79-4-4-4C7.79,4,6,5.79,6,8S7.79,12,10,12z M10,6c1.1,0,2,0.9,2,2s-0.9,2-2,2 c-1.1,0-2-0.9-2-2S8.9,6,10,6z"/><path d="M20.75,16c0-0.22-0.03-0.42-0.06-0.63l1.14-1.01l-1-1.73l-1.45,0.49c-0.32-0.27-0.68-0.48-1.08-0.63L18,11h-2l-0.3,1.49 c-0.4,0.15-0.76,0.36-1.08,0.63l-1.45-0.49l-1,1.73l1.14,1.01c-0.03,0.21-0.06,0.41-0.06,0.63s0.03,0.42,0.06,0.63l-1.14,1.01 l1,1.73l1.45-0.49c0.32,0.27,0.68,0.48,1.08,0.63L16,21h2l0.3-1.49c0.4-0.15,0.76-0.36,1.08-0.63l1.45,0.49l1-1.73l-1.14-1.01 C20.72,16.42,20.75,16.22,20.75,16z M17,18c-1.1,0-2-0.9-2-2s0.9-2,2-2s2,0.9,2,2S18.1,18,17,18z"/></g></g></svg>
                            </div>
                            <h2 class="title">Configurations</h2>
                            <div class="caret">
                                <svg id="expand-setups-caret" class="svg" xmlns="http://www.w3.org/2000/svg" height="30px" viewBox="0 0 24 24" width="30px" fill=var(--text-color)><path d="M24 24H0V0h24v24z" fill="none" opacity=".87"/><path d="M16.59 8.59L12 13.17 7.41 8.59 6 10l6 6 6-6-1.41-1.41z"/></svg>
                            </div>
                        </div>
                        <div id="expand-setups-animator" class="animator">
                            <div id="expand-setups-content">
                                <hr>

                                <div class="descriptor">
                                    Save your favourite colors and settings configurations and use them later.
                                </div>

                                <div id="setups"></div>

                                <button type="button" title="add setup" id="add-setup" onclick="addSetup()" title="save current configuration">
                                    <svg class="icon" xmlns="http://www.w3.org/2000/svg" height="30px" viewBox="0 0 24 24" width="30px" fill=var(--accent-text-color)><path d="M0 0h24v24H0V0z" fill="none"/><path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/></svg>
                                    <div>save configuration</div>
                                </button>

                            </div>
                        </div>
                    </div>
                    <hr>

                    <button type="button" id="install-app-button" title="install app" style="margin-top: 15px; margin: 14px 8px;" onclick="installApp();">
                        <svg class="icon" xmlns="http://www.w3.org/2000/svg" enable-background="new 0 0 24 24" height="35px" viewBox="0 0 24 24" width="35px" fill=var(--accent-text-color)><g><rect fill="none" height="24" width="24"/></g><g><path d="M18,15v3H6v-3H4v3c0,1.1,0.9,2,2,2h12c1.1,0,2-0.9,2-2v-3H18z M17,11l-1.41-1.41L13,12.17V4h-2v8.17L8.41,9.59L7,11l5,5 L17,11z"/></g></svg>
                        <div>install app</div>
                    </button>

                    <button type="button" title="clear cookies" style="margin-top: 15px; margin: 12px 8px;" onclick="clearStorage();">
                        <svg class="icon" xmlns="http://www.w3.org/2000/svg" height="35px" viewBox="0 0 24 24" width="35px" fill=var(--accent-text-color)><path d="M0 0h24v24H0V0z" fill="none"></path><path d="M14.12 10.47L12 12.59l-2.13-2.12-1.41 1.41L10.59 14l-2.12 2.12 1.41 1.41L12 15.41l2.12 2.12 1.41-1.41L13.41 14l2.12-2.12zM15.5 4l-1-1h-5l-1 1H5v2h14V4zM6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM8 9h8v10H8V9z"></path></svg>
                        <div>clear cookies</div>
                    </button>

                </div>

                <!-- play tab -->
                <div id="play-tab" style="display: flex; opacity: 1" class="tab">

                    <div id="play-board">
                        <div id="grid-container">
                        </div>
                        <div id="blocks-container">
                        </div>
                    </div>

                </div>

                <!-- statistics tab -->
                <div id="statistics-tab" class="tab">

                    <div id="top-menu-fab-placeholder" style="height: 60px;"></div>

                    <!-- head title -->
                    <h1>Game statistics</h1>

                    <div class="check-option">
                        <div class="icon">
                            <svg xmlns="http://www.w3.org/2000/svg" height="30px" viewBox="0 0 24 24" width="30px" fill=var(--text-color)><path d="M0 0h24v24H0V0z" fill="none"/><path d="M8 4v.89l2 2V4h4v4h-2.89l2 2H14v.89l2 2V10h4v4h-2.89l2 2H20v.89l2 2V4c0-1.1-.9-2-2-2H5.11l2 2H8zm8 0h4v4h-4V4zM1.41 1.14L0 2.55l2 2V20c0 1.1.9 2 2 2h15.45l2.01 2.01 1.41-1.41L1.41 1.14zM10 12.55L11.45 14H10v-1.45zm-6-6L5.45 8H4V6.55zM8 20H4v-4h4v4zm0-6H4v-4h3.45l.55.55V14zm6 6h-4v-4h3.45l.55.55V20zm2 0v-1.45L17.45 20H16z"/></svg>
                        </div>
                        <div class="value">
                            <div class="title">Ignore grid size</div>
                            <div class="input">
                                <input type="checkbox" id="ignore-grid-size-check">
                            </div>
                        </div>
                    </div>
                    <div class="bottom-descriptor">
                        If allowed highest and total statistics will show for all grid sizes connected and not only the current grid size.
                    </div>

                    <hr>

                    <h2>Current</h2>
                    
                    <div style="text-align: center;">

                        <div class="statistic">
                            <div class="icon">
                                <svg xmlns="http://www.w3.org/2000/svg" height="34px" viewBox="0 0 24 24" width="34px" fill=var(--text-color)><path d="M0 0h24v24H0V0z" fill="none"/><path d="M12 7.13l.97 2.29.47 1.11 1.2.1 2.47.21-1.88 1.63-.91.79.27 1.18.56 2.41-2.12-1.28-1.03-.64-1.03.62-2.12 1.28.56-2.41.27-1.18-.91-.79-1.88-1.63 2.47-.21 1.2-.1.47-1.11.97-2.27M12 2L9.19 8.63 2 9.24l5.46 4.73L5.82 21 12 17.27 18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2z"/></svg>
                            </div>
                            <div class="value">
                                <div class="title">Score</div>
                                <div class="input" id="game-score-value">0</div>
                            </div>
                        </div>

                        <div class="statistic">
                            <div class="icon">
                                <svg xmlns="http://www.w3.org/2000/svg" height="34px" viewBox="0 0 24 24" width="34px" fill=var(--text-color)><path d="M0 0h24v24H0V0z" fill="none"/><path d="M10 9h4V6h3l-5-5-5 5h3v3zm-1 1H6V7l-5 5 5 5v-3h3v-4zm14 2l-5-5v3h-3v4h3v3l5-5zm-9 3h-4v3H7l5 5 5-5h-3v-3z"/></svg>
                            </div>
                            <div class="value">
                                <div class="title">Moves</div>
                                <div class="input" id="game-moves-value">0</div>
                            </div>
                        </div>

                        <div class="statistic">
                            <div class="icon">
                                <svg xmlns="http://www.w3.org/2000/svg" height="34px" viewBox="0 0 24 24" width="34px" fill=var(--text-color)><path d="M0 0h24v24H0V0z" fill="none"/><path d="M13 7h-2v4H7v2h4v4h2v-4h4v-2h-4V7zm-1-5C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8z"/></svg>
                            </div>
                            <div class="value">
                                <div class="title">Blocks created</div>
                                <div class="input" id="game-blocksCreated-value">0</div>
                            </div>
                        </div>

                        <div class="statistic">
                            <div class="icon">
                                <svg xmlns="http://www.w3.org/2000/svg" enable-background="new 0 0 24 24" height="34px" viewBox="0 0 24 24" width="34px" fill=var(--text-color)><g><rect fill="none" height="24" width="24"/></g><g><g><g><ellipse cx="12" cy="12" rx="3" ry="5.74"/></g><g><path d="M16.5,12c0,0.97-0.23,4.16-3.03,6.5C14.25,18.81,15.1,19,16,19c3.86,0,7-3.14,7-7s-3.14-7-7-7c-0.9,0-1.75,0.19-2.53,0.5 C16.27,7.84,16.5,11.03,16.5,12z"/></g><g><path d="M8,19c0.9,0,1.75-0.19,2.53-0.5c-0.61-0.51-1.1-1.07-1.49-1.63C8.71,16.95,8.36,17,8,17c-2.76,0-5-2.24-5-5s2.24-5,5-5 c0.36,0,0.71,0.05,1.04,0.13c0.39-0.56,0.88-1.12,1.49-1.63C9.75,5.19,8.9,5,8,5c-3.86,0-7,3.14-7,7S4.14,19,8,19z"/></g></g></g></svg>
                            </div>
                            <div class="value">
                                <div class="title">Blocks joined</div>
                                <div class="input" id="game-blocksPowered-value">0</div>
                            </div>
                        </div>

                        <div class="statistic">
                            <div class="icon">
                                <svg xmlns="http://www.w3.org/2000/svg" height="34px" viewBox="0 0 24 24" width="34px" fill=var(--text-color)><path d="M0 0h24v24H0V0z" fill="none"/><path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V5h14v14zm-4-4h-4v-2h2c1.1 0 2-.89 2-2V9c0-1.11-.9-2-2-2H9v2h4v2h-2c-1.1 0-2 .89-2 2v4h6v-2z"/></svg>
                            </div>
                            <div class="value">
                                <div class="title">Biggest number</div>
                                <div class="input" id="game-highestPower-value">0</div>
                            </div>
                        </div>

                    </div>

                    <h2>Highest</h2>

                        <div style="text-align: center;">

                            <div class="statistic">
                                <div class="icon">
                                    <svg xmlns="http://www.w3.org/2000/svg" height="34px" viewBox="0 0 24 24" width="34px" fill=var(--text-color)><path d="M0 0h24v24H0V0z" fill="none"/><path d="M12 7.13l.97 2.29.47 1.11 1.2.1 2.47.21-1.88 1.63-.91.79.27 1.18.56 2.41-2.12-1.28-1.03-.64-1.03.62-2.12 1.28.56-2.41.27-1.18-.91-.79-1.88-1.63 2.47-.21 1.2-.1.47-1.11.97-2.27M12 2L9.19 8.63 2 9.24l5.46 4.73L5.82 21 12 17.27 18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2z"/></svg>
                                </div>
                                <div class="value">
                                    <div class="title">Score</div>
                                    <div class="input" id="game-highestScore-value">0</div>
                                </div>
                            </div>

                            <div class="statistic">
                                <div class="icon">
                                    <svg xmlns="http://www.w3.org/2000/svg" height="34px" viewBox="0 0 24 24" width="34px" fill=var(--text-color)><path d="M0 0h24v24H0V0z" fill="none"/><path d="M10 9h4V6h3l-5-5-5 5h3v3zm-1 1H6V7l-5 5 5 5v-3h3v-4zm14 2l-5-5v3h-3v4h3v3l5-5zm-9 3h-4v3H7l5 5 5-5h-3v-3z"/></svg>
                                </div>
                                <div class="value">
                                    <div class="title">Moves</div>
                                    <div class="input" id="game-highestMoves-value">0</div>
                                </div>
                            </div>

                            <div class="statistic">
                                <div class="icon">
                                    <svg xmlns="http://www.w3.org/2000/svg" height="34px" viewBox="0 0 24 24" width="34px" fill=var(--text-color)><path d="M0 0h24v24H0V0z" fill="none"/><path d="M13 7h-2v4H7v2h4v4h2v-4h4v-2h-4V7zm-1-5C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8z"/></svg>
                                </div>
                                <div class="value">
                                    <div class="title">Blocks created</div>
                                    <div class="input" id="game-highestBlocksCreated-value">0</div>
                                </div>
                            </div>

                            <div class="statistic">
                                <div class="icon">
                                    <svg xmlns="http://www.w3.org/2000/svg" enable-background="new 0 0 24 24" height="34px" viewBox="0 0 24 24" width="34px" fill=var(--text-color)><g><rect fill="none" height="24" width="24"/></g><g><g><g><ellipse cx="12" cy="12" rx="3" ry="5.74"/></g><g><path d="M16.5,12c0,0.97-0.23,4.16-3.03,6.5C14.25,18.81,15.1,19,16,19c3.86,0,7-3.14,7-7s-3.14-7-7-7c-0.9,0-1.75,0.19-2.53,0.5 C16.27,7.84,16.5,11.03,16.5,12z"/></g><g><path d="M8,19c0.9,0,1.75-0.19,2.53-0.5c-0.61-0.51-1.1-1.07-1.49-1.63C8.71,16.95,8.36,17,8,17c-2.76,0-5-2.24-5-5s2.24-5,5-5 c0.36,0,0.71,0.05,1.04,0.13c0.39-0.56,0.88-1.12,1.49-1.63C9.75,5.19,8.9,5,8,5c-3.86,0-7,3.14-7,7S4.14,19,8,19z"/></g></g></g></svg>
                                </div>
                                <div class="value">
                                    <div class="title">Blocks joined</div>
                                    <div class="input" id="game-highestBlocksPowered-value">0</div>
                                </div>
                            </div>

                            <div class="statistic">
                                <div class="icon">
                                    <svg xmlns="http://www.w3.org/2000/svg" height="34px" viewBox="0 0 24 24" width="34px" fill=var(--text-color)><path d="M0 0h24v24H0V0z" fill="none"/><path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V5h14v14zm-4-4h-4v-2h2c1.1 0 2-.89 2-2V9c0-1.11-.9-2-2-2H9v2h4v2h-2c-1.1 0-2 .89-2 2v4h6v-2z"/></svg>
                                </div>
                                <div class="value">
                                    <div class="title">Biggest number</div>
                                    <div class="input" id="game-highestHighestPower-value">0</div>
                                </div>
                            </div>

                        </div>

                    <h2>Total</h2>

                    <div style="text-align: center;">

                        <div class="statistic">
                            <div class="icon">
                                <svg xmlns="http://www.w3.org/2000/svg" height="34px" viewBox="0 0 24 24" width="34px" fill=var(--text-color)><path d="M0 0h24v24H0V0z" fill="none"/><path d="M12 7.13l.97 2.29.47 1.11 1.2.1 2.47.21-1.88 1.63-.91.79.27 1.18.56 2.41-2.12-1.28-1.03-.64-1.03.62-2.12 1.28.56-2.41.27-1.18-.91-.79-1.88-1.63 2.47-.21 1.2-.1.47-1.11.97-2.27M12 2L9.19 8.63 2 9.24l5.46 4.73L5.82 21 12 17.27 18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2z"/></svg>
                            </div>
                            <div class="value">
                                <div class="title">Score</div>
                                <div class="input" id="game-totalScore-value">0</div>
                            </div>
                        </div>

                        <div class="statistic">
                            <div class="icon">
                                <svg xmlns="http://www.w3.org/2000/svg" height="34px" viewBox="0 0 24 24" width="34px" fill=var(--text-color)><path d="M0 0h24v24H0V0z" fill="none"/><path d="M10 9h4V6h3l-5-5-5 5h3v3zm-1 1H6V7l-5 5 5 5v-3h3v-4zm14 2l-5-5v3h-3v4h3v3l5-5zm-9 3h-4v3H7l5 5 5-5h-3v-3z"/></svg>
                            </div>
                            <div class="value">
                                <div class="title">Moves</div>
                                <div class="input" id="game-totalMoves-value">0</div>
                            </div>
                        </div>

                        <div class="statistic">
                            <div class="icon">
                                <svg xmlns="http://www.w3.org/2000/svg" height="34px" viewBox="0 0 24 24" width="34px" fill=var(--text-color)><path d="M0 0h24v24H0V0z" fill="none"/><path d="M13 7h-2v4H7v2h4v4h2v-4h4v-2h-4V7zm-1-5C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8z"/></svg>
                            </div>
                            <div class="value">
                                <div class="title">Blocks created</div>
                                <div class="input" id="game-totalBlocksCreated-value">0</div>
                            </div>
                        </div>

                        <div class="statistic">
                            <div class="icon">
                                <svg xmlns="http://www.w3.org/2000/svg" enable-background="new 0 0 24 24" height="34px" viewBox="0 0 24 24" width="34px" fill=var(--text-color)><g><rect fill="none" height="24" width="24"/></g><g><g><g><ellipse cx="12" cy="12" rx="3" ry="5.74"/></g><g><path d="M16.5,12c0,0.97-0.23,4.16-3.03,6.5C14.25,18.81,15.1,19,16,19c3.86,0,7-3.14,7-7s-3.14-7-7-7c-0.9,0-1.75,0.19-2.53,0.5 C16.27,7.84,16.5,11.03,16.5,12z"/></g><g><path d="M8,19c0.9,0,1.75-0.19,2.53-0.5c-0.61-0.51-1.1-1.07-1.49-1.63C8.71,16.95,8.36,17,8,17c-2.76,0-5-2.24-5-5s2.24-5,5-5 c0.36,0,0.71,0.05,1.04,0.13c0.39-0.56,0.88-1.12,1.49-1.63C9.75,5.19,8.9,5,8,5c-3.86,0-7,3.14-7,7S4.14,19,8,19z"/></g></g></g></svg>
                            </div>
                            <div class="value">
                                <div class="title">Blocks joined</div>
                                <div class="input" id="game-totalBlocksPowered-value">0</div>
                            </div>
                        </div>

                    </div>

                </div>

                <!-- fast action button -->
                <button type="button" id="play-fab" title="undo (press) / new game (long press)">
                    <svg style="transform: scale(-1, 1);" xmlns="http://www.w3.org/2000/svg" height="35px" viewBox="0 0 24 24" width="35px" fill=var(--accent-text-color)><path d="M0 0h24v24H0V0z" fill="none"/><path d="M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z"/></svg>
                </button>

            </div>

            <!-- navigation bar placeholder -->
            <div id="nav-placeholder" class="bottom"></div>

        </main>

        <!-- FIXED ELEMENTS -->

        <!-- navigation bar -->
        <nav role="navigation" class="bottom" role="menubar">

            <!-- statistics item -->
            <div class="item nonactive" id="statistics-item" onclick="openTab('statistics');" role="menuitem" title="statistics tab">
                <svg xmlns="http://www.w3.org/2000/svg" height="30px" viewBox="0 0 24 24" width="30px" fill=var(--accent-text-color)><path d="M0 0h24v24H0V0z" fill="none"/><path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V5h14v14zM7 10h2v7H7zm4-3h2v10h-2zm4 6h2v4h-2z"/></svg>
                <div class="title">
                    Stats
                </div>
            </div>

            <!-- play item -->
            <div class="item active" id="play-item" onclick="openTab('play');" role="menuitem" title="play tab">
                <svg xmlns="http://www.w3.org/2000/svg" height="30px" viewBox="0 0 24 24" width="30px" fill="var(--accent-text-color)"><path d="M0 0h24v24H0V0z" fill="none"></path><path d="M10 8.64L15.27 12 10 15.36V8.64M8 5v14l11-7L8 5z"></path></svg>
                <div class="title">
                    Play
                </div>
            </div>

            <!-- configuration item -->
            <div class="item nonactive" id="configuration-item" onclick="openTab('configuration');" role="menuitem" title="configuration tab">
                <svg class="svg" xmlns="http://www.w3.org/2000/svg" height="30px" viewBox="0 0 24 24" width="30px" fill="var(--accent-text-color)"><path d="M0 0h24v24H0V0z" fill="none"></path><path d="M3 17v2h6v-2H3zM3 5v2h10V5H3zm10 16v-2h8v-2h-8v-2h-2v6h2zM7 9v2H3v2h4v2h2V9H7zm14 4v-2H11v2h10zm-6-4h2V7h4V5h-4V3h-2v6z"></path></svg>
                <div class="title">
                    Config
                </div>
            </div>

        </nav>

        <!-- toast popup (quick message) -->
        <div id="toast" onclick="hideToast();">
            <div id="toast-icon"></div>
            <div id="toast-text"></div>
        </div>

        <!-- loading splashscreen -->
        <div id="splashscreen">
            <div style="animation: splash-block1 1.3s ease-in-out infinite;" id="splash-block1"></div>
            <div style="animation: splash-block2 1.3s ease-in-out infinite;" id="splash-block2"></div>
            <div style="animation: splash-block3 1.3s ease-in-out infinite;" id="splash-block3"></div>
            <div style="animation: splash-block4 1.3s ease-in-out infinite;" id="splash-block4"></div>
            <div id="warnings-container" style="animation: show-warnings 300s ease-in-out infinite; animation-delay: 3s;">
                <div style="height: 50px; width: 100%; background-image: linear-gradient(to top, rgb(40, 40, 40), transparent);"></div>
                <div style="height: 10px; width: 100%; background-color: rgb(40, 40, 40);"></div>
                <div id="warnings">
                    <div class="warning">
                        <div class="icon">
                            <svg xmlns="http://www.w3.org/2000/svg" height="30px" viewBox="0 0 24 24" width="30px" fill=var(--warning-color)><path d="M12 5.99L19.53 19H4.47L12 5.99M12 2L1 21h22L12 2zm1 14h-2v2h2v-2zm0-6h-2v4h2v-4z"/></svg>
                        </div>
                        <div class="text">If the app won't load for long time it's possible you will need to clear cookies. I am sorry. This is propably because I made some changes to the app that don't align with what you have saved in your cookies and I am too lazy to make some in-code recoveries of your invalid cookies.<br><br><a style="color: var(--warning-text); padding: 8px;" href="javascript: clearStorage()">CLEAR COOKIES</a></div>
                    </div>
                    <noscript class="warning">
                        <div class="icon">
                            <svg xmlns="http://www.w3.org/2000/svg" height="30px" viewBox="0 0 24 24" width="30px" fill=var(--warning-color)><path d="M12 5.99L19.53 19H4.47L12 5.99M12 2L1 21h22L12 2zm1 14h-2v2h2v-2zm0-6h-2v4h2v-4z"/></svg>
                        </div>
                        <div class="text">This app requires JavaScript for basic functioning. Please allow this app to use JavaScript. This app (excluding third parties I do not have in control) does not collect or use any personal information outside of your device.</div>
                    </noscript>
                </div>
            </div>
        </div>

        <!-- version info -->
        <div id="version">
            2.1.1
        </div>

    </body>

    <!-- https://github.com/goldfire/howler.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/howler/2.2.3/howler.min.js" integrity="sha512-6+YN/9o9BWrk6wSfGxQGpt3EUK6XeHi6yeHV+TYD2GR0Sj/cggRpXr1BrAQf0as6XslxomMUxXp2vIl+fv0QRA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

    <script type="text/javascript">

        // check PWA compatability
        if ("serviceWorker" in navigator && location.href.includes("https://")) {
            addEventListener("load", function() {
                navigator.serviceWorker.register("serviceWorker.js").then((response) => {
                }).catch((error) => {
                    console.error(error);
                });
            });
        } else {
            document.getElementById("install-app-button").style.setProperty("display", "none");
        }

        // hide install button if running as PWA
        if (matchMedia('(display-mode: standalone)').matches) {
            document.getElementById("install-app-button").style.setProperty("display", "none");
        }

        // prevent the prompt to show by defeault and show it when user clicks istall
        addEventListener("beforeinstallprompt", function(arg) {
            event.preventDefault();
            pwaInstallPrompt = arg;
        });

        // setting up global objects
        const cssVariables = document.querySelector(":root");
        const joinAudioEffect = new Howl({src: ["audio/join.ogg"]});
        const stuckAudioEffect = new Howl({src: ["audio/stuck.ogg"]});
        const undoAudioEffect = new Howl({src: ["audio/undo.ogg"]});
        const userStatisticsIds = {score: {total: true}, blocksCreated: {total: true}, blocksPowered: {total: true}, moves: {total: true}, highestPower: {total: false}};
        if (navigator.cookieEnabled) {
            storage = "localStorage";
        } else {
            storage = "globalStorage";
        }
        globalStorage = {getItem(id) {
            return this.values[id];
        }, setItem(id, value) {
            this.values[id] = value;
        }, clear() {
            for (item of Object.keys(this.values)) {
                delete this.values[item];
            }
        }, values: {}}
        expanded = {};
        menuOpened = false;
        navStyle = null;
        activeTab = "play";
        move = {powerUpBlockPairs: [], nothingMoved: true};
        statistics = {hiddenBlocks: [], blocksToRemove: [], ignoreGridSize: false, blockMovesUndoed: 0};
        configuration = {};
        unApplyedConfiguration = {};
        blocks = {};
        board = [];
        setups = [];
        saves = [];
        optionPowerColorValuePairsNumber = 18;
        throttleResize = false;
        matchMedia('(prefers-color-scheme: dark)').addEventListener("change", updateTheme);

        // reset storage if not used or restore it
        if (window[storage].getItem("storageUsed") == null) {
            resetStorage();
            openTab("configuration");
            expandPart("info");
        } else {
            restoreStorage();
            restoreGame();
        }

        Object.assign(unApplyedConfiguration, configuration);

        optionRangeValuePairs = [{optionDOM: "offsetY", optionJS: "offsetY", multiplier: 1}, {optionDOM: "offsetX", optionJS: "offsetX", multiplier: 1}, {optionDOM: "grid-size", optionJS: "gridSize", multiplier: 1}, {optionDOM: "box-margin", optionJS: "boxMargin", multiplier: 0.1}, {optionDOM: "box-border-radius", optionJS: "boxBorderRadius", multiplier: 0.1}, {optionDOM: "transitions", optionJS: "transitions", multiplier: 0.1}];

        for (pair of optionRangeValuePairs) {
            document.getElementById(`${pair.optionDOM}-range`).addEventListener("input", updateOptionRangeValuePair.bind(null, pair, "range"));
            document.getElementById(`${pair.optionDOM}-value`).addEventListener("input", updateOptionRangeValuePair.bind(null, pair, "value"));
        }

        function updateOptionRangeValuePair(pair, origin) {
            if (origin == "range") {
                var valueMultiplier = pair.multiplier;
                var DOMMultiplier = 1;
                var applyedTo = "value";
            } else {
                var valueMultiplier = 1;
                var DOMMultiplier = 1/pair.multiplier;
                var applyedTo = "range";
            }
            var value = document.getElementById(`${pair.optionDOM}-${origin}`).value*valueMultiplier;
            unApplyedConfiguration[pair.optionJS] = value;
            document.getElementById(`${pair.optionDOM}-${applyedTo}`).value = Math.round(value*DOMMultiplier*10)/10;

            applyPartialConfiguration(unApplyedConfiguration);
        }

        for (loop = 1; loop <= optionPowerColorValuePairsNumber; loop++) {
            document.getElementById(`2power${loop}-R-range`).addEventListener("input", updateOptionPowerColorValuePair.bind(null, "range", loop));
            document.getElementById(`2power${loop}-G-range`).addEventListener("input", updateOptionPowerColorValuePair.bind(null, "range", loop));
            document.getElementById(`2power${loop}-B-range`).addEventListener("input", updateOptionPowerColorValuePair.bind(null, "range", loop));
            document.getElementById(`2power${loop}-R-value`).addEventListener("input", updateOptionPowerColorValuePair.bind(null, "value", loop));
            document.getElementById(`2power${loop}-G-value`).addEventListener("input", updateOptionPowerColorValuePair.bind(null, "value", loop));
            document.getElementById(`2power${loop}-B-value`).addEventListener("input", updateOptionPowerColorValuePair.bind(null, "value", loop));
        }

        optionPlayBoardColors = [{optionDOM: "play-board", optionJS: "playBoardBackground"}, {optionDOM: "box", optionJS: "boxBackground"}];

        function updateOptionPlayBoardColors(origin, option) {
            if (origin == "range") {
                applyedTo = "value";
            } else {
                applyedTo = "range";
            }
            var R = document.getElementById(`${option.optionDOM}-R-${origin}`).value;
            var G = document.getElementById(`${option.optionDOM}-G-${origin}`).value;
            var B = document.getElementById(`${option.optionDOM}-B-${origin}`).value;
            var value = `rgb(${R}, ${G}, ${B})`;
            unApplyedConfiguration[option.optionJS] = value;
            document.getElementById(`${option.optionDOM}-color-preview`).style.setProperty("background-color", value);
            document.getElementById(`${option.optionDOM}-R-${applyedTo}`).value = R;
            document.getElementById(`${option.optionDOM}-G-${applyedTo}`).value = G;
            document.getElementById(`${option.optionDOM}-B-${applyedTo}`).value = B;

            applyPartialConfiguration(unApplyedConfiguration);
        }

        for (option of optionPlayBoardColors) {
            document.getElementById(`${option.optionDOM}-R-range`).addEventListener("input", updateOptionPlayBoardColors.bind(null, "range", option));
            document.getElementById(`${option.optionDOM}-G-range`).addEventListener("input", updateOptionPlayBoardColors.bind(null, "range", option));
            document.getElementById(`${option.optionDOM}-B-range`).addEventListener("input", updateOptionPlayBoardColors.bind(null, "range", option));
            document.getElementById(`${option.optionDOM}-R-value`).addEventListener("input", updateOptionPlayBoardColors.bind(null, "value", option));
            document.getElementById(`${option.optionDOM}-G-value`).addEventListener("input", updateOptionPlayBoardColors.bind(null, "value", option));
            document.getElementById(`${option.optionDOM}-B-value`).addEventListener("input", updateOptionPlayBoardColors.bind(null, "value", option));
        }

        function updateOptionPowerColorValuePair(origin, power) {
            if (origin == "range") {
                applyedTo = "value";
            } else {
                applyedTo = "range";
            }
            var R = document.getElementById(`2power${power}-R-${origin}`).value;
            var G = document.getElementById(`2power${power}-G-${origin}`).value;
            var B = document.getElementById(`2power${power}-B-${origin}`).value;
            var value = `rgb(${R}, ${G}, ${B})`;
            unApplyedConfiguration.powerColors[power-1] = value;
            document.getElementById(`2power${power}-color-preview`).style.setProperty("background-color", value);
            document.getElementById(`2power${power}-R-${applyedTo}`).value = R;
            document.getElementById(`2power${power}-G-${applyedTo}`).value = G;
            document.getElementById(`2power${power}-B-${applyedTo}`).value = B;
            // cssVariables.style.setProperty(`--power${power}-color`, value);

            applyPartialConfiguration(unApplyedConfiguration);
        }

        // listeners for check boxes
        document.getElementById("shadows-check").addEventListener("click", function() {
            unApplyedConfiguration.shadows = document.getElementById("shadows-check").checked;

            applyPartialConfiguration(unApplyedConfiguration);
        });

        document.getElementById("sound-effects-check").addEventListener("click", function() {
            unApplyedConfiguration.soundEffects = document.getElementById("sound-effects-check").checked;

            applyPartialConfiguration(unApplyedConfiguration);
        });

        document.getElementById("theme-select").addEventListener("change", function() {
            var select = document.getElementById("theme-select");
            unApplyedConfiguration.theme = select.value;
            configuration.theme = select.value;

            applyPartialConfiguration(unApplyedConfiguration);
        });

        document.getElementById("ignore-grid-size-check").addEventListener("click", function() {
            statistics.ignoreGridSize = document.getElementById("ignore-grid-size-check").checked;
            updateUserStatisticsDOM();
            window[storage].setItem("statistics", JSON.stringify(statistics));
        });

        addEventListener("keydown", function(key) {
            if(["Space","ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].indexOf(key.code) > -1) {
                key.preventDefault();
            }
        }, false);

        addEventListener("keyup", function() {
            if (activeTab == "play") {
                switch (event.key) {
                    case "ArrowRight":
                    case "d":
                        moveBlocks("right");
                        break;
                    case "ArrowUp":
                    case "w":
                        moveBlocks("up");
                        break;
                    case "ArrowLeft":
                    case "a":
                        moveBlocks("left");
                        break;
                    case "ArrowDown":
                    case "s":
                        moveBlocks("down");
                        break;
                    case " ":
                        if (confirm("Start a new game?")) {
                            startNewGame();
                        }
                        break;
                    case "Backspace":
                        undoBlockMove();
                        break;
                    default:
                        break;
                }
            }
        });

        // long press and short press listeners for play fab
        if (matchMedia("(pointer: coarse)").matches) {
            document.getElementById("play-fab").addEventListener("touchstart", playFabPressStart, {passive: true});
            document.getElementById("play-fab").addEventListener("touchend", playFabPressEnd, {passive: true});
            document.getElementById("play-fab").addEventListener("touchmove", function(event) {
                var touch = event.touches[0];
                var touchedElement = document.elementFromPoint(touch.clientX, touch.clientY);
                var playFab = document.getElementById("play-fab");
                if (!(touchedElement == playFab || playFab.contains(touchedElement))) {
                    playFabPressEnd(true);
                }
            }, {passive: true});
        } else {
            document.getElementById("play-fab").addEventListener("mousedown", playFabPressStart, {passive: true});
            document.getElementById("play-fab").addEventListener("mouseup", playFabPressEnd, {passive: true});
            document.getElementById("play-fab").addEventListener("mouseleave", playFabPressEnd.bind(null, true), {passive: true});
        }

        function playFabPressStart() {
            if (window[storage].getItem("playFabUseInformed") != 1) {
                window[storage].setItem("playFabUseInformed", 1);
                showToast("long press to start a new game", `<svg xmlns="http://www.w3.org/2000/svg" enable-background="new 0 0 24 24" height="30px" viewBox="0 0 24 24" width="30px" fill=var(--text-color)><g><rect fill="none" height="24" width="24"/></g><g><g><path d="M18.19,12.44l-3.24-1.62c1.29-1,2.12-2.56,2.12-4.32c0-3.03-2.47-5.5-5.5-5.5s-5.5,2.47-5.5,5.5c0,2.13,1.22,3.98,3,4.89 v3.26c-2.15-0.46-2.02-0.44-2.26-0.44c-0.53,0-1.03,0.21-1.41,0.59L4,16.22l5.09,5.09C9.52,21.75,10.12,22,10.74,22h6.3 c0.98,0,1.81-0.7,1.97-1.67l0.8-4.71C20.03,14.32,19.38,13.04,18.19,12.44z M17.84,15.29L17.04,20h-6.3 c-0.09,0-0.17-0.04-0.24-0.1l-3.68-3.68l4.25,0.89V6.5c0-0.28,0.22-0.5,0.5-0.5c0.28,0,0.5,0.22,0.5,0.5v6h1.76l3.46,1.73 C17.69,14.43,17.91,14.86,17.84,15.29z M8.07,6.5c0-1.93,1.57-3.5,3.5-3.5s3.5,1.57,3.5,3.5c0,0.95-0.38,1.81-1,2.44V6.5 c0-1.38-1.12-2.5-2.5-2.5c-1.38,0-2.5,1.12-2.5,2.5v2.44C8.45,8.31,8.07,7.45,8.07,6.5z"/></g></g></svg>`);
            }
            if (typeof playFabTimeout == "undefined") {
                playFabTimeout = setTimeout(function() {
                    startNewGame();
                    delete playFabTimeout;
                }, 250)
            }
        }

        function playFabPressEnd(cancel = false) {
            if (typeof playFabTimeout != "undefined") {
                clearTimeout(playFabTimeout);
                delete playFabTimeout;
                if (cancel !== true) {
                    undoBlockMove();
                }
            }
        }

        // swipe listeners
        if (matchMedia("(pointer: coarse)").matches) {
            document.getElementById("play-tab").addEventListener("swiped-right", function(positions) {
            moveBlocks("right");
            });
            document.getElementById("play-tab").addEventListener("swiped-up", function(positions) {
                moveBlocks("up");
            });
            document.getElementById("play-tab").addEventListener("swiped-left", function(positions) {
                moveBlocks("left");
            });
            document.getElementById("play-tab").addEventListener("swiped-down", function(positions) {
                moveBlocks("down");
            });
        }

        // update elements on resize
        addEventListener("resize", function() {
            if (!throttleResize) {
                applyResizeStyle();
            }
            if (typeof applyResizeTimeout == "undefined") {
                throttleResize = true;
                applyResizeTimeout = setTimeout(applyResizeStyle, 200);
            } else {
                clearTimeout(applyResizeTimeout);
                applyResizeTimeout = setTimeout(applyResizeStyle, 200);
            }
        });

        function applyResizeStyle() {
            delete applyResizeTimeout;
            updateNavStyle();
            renderPlayBoard();
            updateBoard(false);
            updateBoard(false);
            throttleResize = false;
        }

        document.getElementById("play-board").addEventListener("click", function() {
            var x = event.clientX-this.getBoundingClientRect().left;
            var y = event.clientY-this.getBoundingClientRect().top;
            var playBoardSize = getComputedStyle(this).width.replace("px", "")*1;
            if (x > y && playBoardSize-y > x) {
                moveBlocks("up");
            } else if (y > x && playBoardSize-x > y) {
                moveBlocks("left");
            } else if (x > playBoardSize-y && y > x) {
                moveBlocks("down");
            } else if (y > playBoardSize-x && x > y) {
                moveBlocks("right");
            }
        });

        // setInterval(function() {
            //     random = getRandomNumber(1, 4);
            //     switch (random) {
            //         case 1:
            //             moveBlocks("right");
            //             break;
            //         case 2:
            //             moveBlocks("up");
            //             break;
            //         case 3:
            //             moveBlocks("left");
            //             break;
            //         case 4:
            //             moveBlocks("down");
            //         default:
            //             break;
            //     }
        // }, 20);

        // setup some properties and styles
        updateTheme();
        setCurrentOptionValues(configuration);
        updateNavStyle();

        if (window[storage].getItem("storageUsed") == null) {
            window[storage].setItem("storageUsed", 1);
            startNewGame();
        }

        // hide splashscreen after app loads
        setTimeout(function() {

            updateBoard(false);
            splashscreen = document.getElementById("splashscreen");
            splashscreen.style.setProperty("opacity", 0);

            setTimeout(function() {

                splashscreen.style.setProperty("display", "none");

            }, 170);

        }, 100)

        function updateNavStyle() {

            // get changed elements
            var nav = document.getElementsByTagName("nav")[0];
            var navPlaceHolder = document.getElementById("nav-placeholder");
            var main = document.getElementsByTagName("main")[0];
            var tabs = document.getElementById("tabs");
            var fab = document.getElementById("play-fab");

            // change elements
            if (innerWidth > (innerHeight + 180) && navStyle != "side") {
                navStyle = "side";
                nav.setAttribute("class", "side");
                navPlaceHolder.setAttribute("class", "side");
                main.style.setProperty("flex-direction", "row-reverse");
                tabs.style.setProperty("width", "100%");
                fab.style.setProperty("bottom", "20px");
            } else if (innerWidth < (innerHeight + 180)) {
                navStyle = "bottom";
                nav.setAttribute("class", "bottom");
                navPlaceHolder.setAttribute("class", "bottom");
                main.style.setProperty("flex-direction", "column");
                tabs.style.removeProperty("width");
                fab.style.removeProperty("bottom");
            }

        }

        function openTab(tab) {

            // don't open again if opened already
            if (tab != activeTab) {

                // update activeTab variable
                var previousTab = activeTab;
                activeTab = tab;

                // set styles
                document.getElementById(`${previousTab}-item`).setAttribute("class", "item nonactive");
                document.getElementById(`${tab}-item`).setAttribute("class", "item active");
                document.getElementById(`${previousTab}-tab`).style.setProperty("opacity", 0);
                setTimeout(function() {
                    document.getElementById(`${previousTab}-tab`).style.setProperty("display", "none");
                    if (tab == "play") {
                        document.getElementById(`${tab}-tab`).style.setProperty("display", "flex");
                        document.getElementById("play-fab").style.removeProperty("transform");
                        document.getElementById("tabs").style.setProperty("height", "100%");
                        document.getElementById("tabs").style.removeProperty("overflow");
                        updateBoard(false);
                    } else {
                        document.getElementById(`${tab}-tab`).style.setProperty("display", "block");
                        document.getElementById("play-fab").style.setProperty("transform", "scale(0)");
                        document.getElementById("tabs").style.removeProperty("height");
                        document.getElementById("tabs").style.setProperty("overflow", "auto");
                    }
                    if (previousTab == "configuration") {
                        closeAllExpanders();
                        if (!JSON.stringify(unApplyedConfiguration) == JSON.stringify(configuration)) {
                            showToast("settings saved", `<svg xmlns="http://www.w3.org/2000/svg" height="30px" viewBox="0 0 24 24" width="30px" fill=var(--text-color)><path d="M0 0h24v24H0V0z" fill="none"/><path d="M17 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V7l-4-4zm2 16H5V5h11.17L19 7.83V19zm-7-7c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3zM6 6h9v4H6z"/></svg>`);
                        }
                        applyPartialConfiguration(unApplyedConfiguration);
                    }
                    setTimeout(function() {
                        document.getElementById(`${tab}-tab`).style.setProperty("opacity", "1");
                    }, 10);
                }, 130);
            }
            if (tab == "statistics") {
                updateUserStatisticsDOM();
            }

        }

        function updateTheme() {
            if (configuration.theme == "auto") {
                if (matchMedia('(prefers-color-scheme: dark)').matches) {
                    var theme = "dark";
                } else {
                    var theme = "light";
                }
            } else if (configuration.theme == "dark") {
                var theme = "dark";
            } else {
                var theme = "light";
            }
            if (theme == "dark") {
                cssVariables.style.setProperty('--background-color', "rgb(50, 50, 50)");
                cssVariables.style.setProperty('--text-color', "white");
                cssVariables.style.setProperty('--pale-color', "rgb(70, 70, 70)");
            } else {
                cssVariables.style.setProperty('--background-color', "white");
                cssVariables.style.setProperty('--text-color', "black");
                cssVariables.style.setProperty('--pale-color', "rgb(230, 230, 230)");
            }
        }

        function showToast(message, icon) {
            var toastElement = document.getElementById("toast");
            var toastText = document.getElementById("toast-text");
            var toastIcon = document.getElementById("toast-icon");

            toastText.innerHTML = message;
            toastIcon.innerHTML = icon;
            toastElement.style.setProperty("display", "flex");
            setTimeout(function() {
                toastElement.style.setProperty("opacity", 1);
                toastElement.style.setProperty("transform", "translateY(0)");
            }, 10);
            if (typeof toastTimeout == "undefined") {
                toastTimeout = setTimeout(function() {
                    delete toastTimeout;
                    hideToastElement();
                }, 1000 + (message.length * 60));
            } else {
                clearTimeout(toastTimeout);
                toastTimeout = setTimeout(function() {
                    delete toastTimeout;
                    hideToastElement();
                }, 3000);
            }
        }

        function hideToast() {
            if (typeof toastTimeout != "undefined") {
                clearTimeout(toastTimeout);
                delete toastTimeout;
            }
            hideToastElement();
        }

        function hideToastElement() {
            var toastElement = document.getElementById("toast");
            toastElement.style.removeProperty("opacity");
            toastElement.style.removeProperty("transform");
            setTimeout(function() {
                toastElement.style.setProperty("display", "none");
            }, 130);
        }

        function closeAllExpanders() {

            for (expandable in expanded) {
                if (expanded[expandable]) {
                    expandPart(expandable);
                }
            }

        }

        function expandPart(expanderId) {
            var expandContent = document.getElementById(`expand-${expanderId}-content`);
            if (typeof expanded[expanderId] == "undefined") {
                expanded[expanderId] = false;
            }
            if (!expanded[expanderId]) {
                expanded[expanderId] = true;
                expandContent.style.setProperty("display", "block");
                document.getElementById(`expand-${expanderId}-caret`).style.setProperty("transform", "scaleY(-100%)");
                document.getElementById(`expand-${expanderId}-animator`).style.setProperty("height", (getComputedStyle(expandContent).height.replace("px", "")*1)+5 + "px");
                expandCompleteTimeout = setTimeout(function() {
                    document.getElementById(`expand-${expanderId}-animator`).style.setProperty("height", (getComputedStyle(expandContent).height.replace("px", "")*1)+5 + "px");
                }, 200);
            } else {
                expanded[expanderId] = false;
                document.getElementById(`expand-${expanderId}-caret`).style.removeProperty("transform");
                document.getElementById(`expand-${expanderId}-animator`).style.removeProperty("height");
                clearTimeout(expandCompleteTimeout);
                setTimeout(function() {
                    expandContent.style.setProperty("display", "none");
                }, 210);
            }
        }

        function updateExpanderSize(expanderId) {
            var expandContent = document.getElementById(`expand-${expanderId}-content`);
            document.getElementById(`expand-${expanderId}-animator`).style.setProperty("height", (getComputedStyle(expandContent).height.replace("px", "")*1)+5 + "px");
        }

        function setCurrentOptionValues(applyedConfiguration) {
            for (pair of optionRangeValuePairs) {
                document.getElementById(`${pair.optionDOM}-value`).value = applyedConfiguration[pair.optionJS];
                updateOptionRangeValuePair(pair, "value");
            }
            for (loop = 1; loop <= optionPowerColorValuePairsNumber; loop++) {
                var value = applyedConfiguration.powerColors[loop-1];
                var RGB = getRGBvalues(value);
                var R = RGB[1];
                var G = RGB[2];
                var B = RGB[3];
                document.getElementById(`2power${loop}-color-preview`).style.setProperty("background-color", value);
                document.getElementById(`2power${loop}-R-range`).value = R;
                document.getElementById(`2power${loop}-G-range`).value = G;
                document.getElementById(`2power${loop}-B-range`).value = B;
                document.getElementById(`2power${loop}-R-value`).value = R;
                document.getElementById(`2power${loop}-G-value`).value = G;
                document.getElementById(`2power${loop}-B-value`).value = B;
            }
            for (option of optionPlayBoardColors) {
                var value = applyedConfiguration[option.optionJS];
                var RGB = getRGBvalues(value);
                var R = RGB[1];
                var G = RGB[2];
                var B = RGB[3];
                document.getElementById(`${option.optionDOM}-color-preview`).style.setProperty("background-color", value);
                document.getElementById(`${option.optionDOM}-R-range`).value = R;
                document.getElementById(`${option.optionDOM}-G-range`).value = G;
                document.getElementById(`${option.optionDOM}-B-range`).value = B;
                document.getElementById(`${option.optionDOM}-R-value`).value = R;
                document.getElementById(`${option.optionDOM}-G-value`).value = G;
                document.getElementById(`${option.optionDOM}-B-value`).value = B;
            }
            document.getElementById("sound-effects-check").checked = applyedConfiguration.soundEffects;
            document.getElementById("ignore-grid-size-check").checked = statistics.ignoreGridSize;
            renderSetups();
            document.getElementById("theme-select").value = applyedConfiguration.theme;
            document.getElementById("shadows-check").checked = applyedConfiguration.shadows;
        }

        function renderSetups() {
            setupsHTML = ""
            for (setup of setups) {
                setupsHTML += `
                <div class="setup">
                    <div class="name">
                        ${setup.name}
                    </div>
                    <div class="actions">
                        <button type="button" class="action" id="delete-${setup.id}" onclick="deleteSetup('${setup.id}')" title="delete setup ${setup.name}">
                            <svg xmlns="http://www.w3.org/2000/svg" height="30px" viewBox="0 0 24 24" width="30px" fill=var(--accent-text-color)><path d="M0 0h24v24H0V0z" fill="none"/><path d="M14.12 10.47L12 12.59l-2.13-2.12-1.41 1.41L10.59 14l-2.12 2.12 1.41 1.41L12 15.41l2.12 2.12 1.41-1.41L13.41 14l2.12-2.12zM15.5 4l-1-1h-5l-1 1H5v2h14V4zM6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM8 9h8v10H8V9z"/></svg>
                        </button>
                        <button type="button" class="action" id="edit-${setup.id}" onclick="editSetup('${setup.id}')" title="edit setup ${setup.name}">
                            <svg xmlns="http://www.w3.org/2000/svg" height="30px" viewBox="0 0 24 24" width="30px" fill=var(--accent-text-color)><path d="M0 0h24v24H0V0z" fill="none"/><path d="M14.06 9.02l.92.92L5.92 19H5v-.92l9.06-9.06M17.66 3c-.25 0-.51.1-.7.29l-1.83 1.83 3.75 3.75 1.83-1.83c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.2-.2-.45-.29-.71-.29zm-3.6 3.19L3 17.25V21h3.75L17.81 9.94l-3.75-3.75z"/></svg>
                        </button>
                        <button type="button" class="action" id="load-${setup.id}" onclick="loadSetup('${setup.id}')" title="load setup ${setup.name}">
                            <svg xmlns="http://www.w3.org/2000/svg" height="30px" viewBox="0 0 24 24" width="30px" fill=var(--accent-text-color)><path d="M0 0h24v24H0V0z" fill="none"/><path d="M19 19H5V5h7V3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2v-7h-2v7zM14 3v2h3.59l-9.83 9.83 1.41 1.41L19 6.41V10h2V3h-7z"/></svg>
                        </button>
                    </div>
                </div>
                `
            }
            document.getElementById("setups").innerHTML = setupsHTML;
        }

        function deleteSetup(id) {
            if (confirm("Are you sure you want to delete this configuration?")) {
                for ([index, setup] of setups.entries()) {
                    if (setup.id == id && (setup.name != "Default" || confirm("This seems to be default configuration. If you delete it you won't be able to restore default settings without clearing all data. Are you sure again?"))) {
                        setups.splice(index, 1);
                        break;
                    }
                }
                window[storage].setItem("setups", JSON.stringify(setups));
                renderSetups();
                updateExpanderSize("setups");
            }
        }

        function editSetup(id) {
            for ([index, setup] of setups.entries()) {
                if (setup.id == id) {
                    var newName = prompt("Change name of the configuration.", setups[index].name);
                    if (newName != null) {
                        setups[index].name = newName;
                    }
                    break;
                }
            }
            window[storage].setItem("setups", JSON.stringify(setups));
            renderSetups();
            updateExpanderSize("setups");
        }

        function loadSetup(id) {
            for ([index, setup] of setups.entries()) {
                if (setup.id == id) {
                    var newGameStarted = false;
                    var differentGridSize = setups[index].configuration.gridSize != configuration.gridSize;
                    Object.assign(unApplyedConfiguration, setups[index].configuration);
                    if (differentGridSize && confirm("This configuration has a different grid size. Start new game with different grid size [confirm] or keep current grid size until new game? [cancel]")) {
                        startNewGame();
                        var newGameStarted = true;
                    }
                    if (!newGameStarted) {
                        unApplyedConfiguration.gridSize = setups[index].configuration.gridSize;
                        applyPartialConfiguration(unApplyedConfiguration);
                    }
                    setCurrentOptionValues(unApplyedConfiguration);
                    showToast("configuration applyed", `<svg xmlns="http://www.w3.org/2000/svg" height="30px" viewBox="0 0 24 24" width="30px" fill="var(--text-color)"><path d="M0 0h24v24H0V0z" fill="none"></path><path d="M19 19H5V5h7V3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2v-7h-2v7zM14 3v2h3.59l-9.83 9.83 1.41 1.41L19 6.41V10h2V3h-7z"></path></svg>`);
                    break;
                }
            }
        }

        function addSetup() {
            var name = prompt("Name the configuration. Don't be too crazy with the name or you might regret.");
            if (name != null) {
                applyPartialConfiguration(unApplyedConfiguration);
                setups.push({name: name, id: getRandomId(4), configuration: structuredClone(unApplyedConfiguration)});
                window[storage].setItem("setups", JSON.stringify(setups));
                renderSetups();
                updateExpanderSize("setups");
            }
        }

        function getRandomId(characterPairs) {
            var consonants = ["b", "c", "d", "f", "g", "h", "j", "k", "l", "m", "n", "p", "q", "r", "s", "t", "v", "w", "x", "z"];
            var vowels = ["a", "e", "i", "o", "u", "y"];
            var id = "";
            for (loop = 0; loop < characterPairs; loop++) {
                id = id + consonants[getRandomNumber(0,consonants.length-1)];
                id = id + vowels[getRandomNumber(0,vowels.length-1)];
            }
            return id;
        }

        function getRandomNumber(bottomIndex, topIndex) {
            var number = Math.round((Math.random()*(topIndex+1-bottomIndex))+(bottomIndex-0.5))*1;
            if (number == -0) {
                number = 0;
            }
            return number;
        }

        function saveFullConfiguration(applyedConfiguration) {
            Object.assign(configuration, applyedConfiguration);
            window[storage].setItem("configuration", JSON.stringify(configuration));
        }

        function applyPartialConfiguration(applyedConfiguration) {
            var currentGridSize = configuration.gridSize;
            Object.assign(configuration, applyedConfiguration);
            configuration.gridSize = currentGridSize;
            window[storage].setItem("configuration", JSON.stringify(configuration));
            setPlayBoardStyles();
            updateTheme();
            setBlockColors();
            renderPlayBoard();
        }

        function setBlockColors() {
            for (loop = 1; loop <= optionPowerColorValuePairsNumber; loop++) {
                cssVariables.style.setProperty(`--power${loop}-color`, configuration.powerColors[loop-1]);
            }
        }

        function renderPlayBoard() {
            cssVariables.style.setProperty("--box-size", "0");
            var boardHeight = innerHeight*0.7;
            var boardWidth = innerWidth*0.75;
            if (boardHeight < boardWidth) {
                boardSize = boardHeight;
            } else {
                boardSize = boardWidth;
            }
            var boxMargin = ((boardSize/configuration.gridSize)/15)*configuration.boxMargin;
            cssVariables.style.setProperty("--box-margin", `${boxMargin}px`);
            cssVariables.style.setProperty("--box-size", `${(boardSize-(boxMargin*configuration.gridSize*2)-((boxMargin*2)/configuration.gridSize))/configuration.gridSize}px`);
            cssVariables.style.setProperty("--block-font-size", `${(boardSize/configuration.gridSize)/2.5}px`);
            var boxBorderRadius = ((boardSize/configuration.gridSize)/20)*configuration.boxBorderRadius;
            cssVariables.style.setProperty("--box-border-radius", `${boxBorderRadius}px`);
            document.getElementById("play-board").style.setProperty("border-radius", `${configuration.gridSize ** 1/2 * boxBorderRadius}px`);
        }

        function clearStorage() {
            if (confirm("This action will remove all data and preferences this app saved on your device. Are you sure?")) {
                window[storage].clear();
                location.reload();
            }
        }

        function resetCurrentStatistics() {
            statistics.hiddenBlocks = [];
            statistics.blocksToRemove = [];
            statistics.blockMovesUndoed = 0;

            for (statisticId in userStatisticsIds) {
                statistics[statisticId] = 0;
            }
        }

        function defineBaseUserStatistics() {
            for (statisticId in userStatisticsIds) {
                var highestId = `highest${capitalize(statisticId)}`;
                var totalId = `total${capitalize(statisticId)}`;

                statistics[statisticId] = 0;
                statistics[highestId] = {};
                statistics[highestId].grid = 0;
                if (userStatisticsIds[statisticId].total) {
                    statistics[totalId] = {};
                    statistics[totalId].grid = 0;
                }
            }
        }

        function predefineUserStatistics() {
            for (statisticId in userStatisticsIds) {
                var highestId = `highest${capitalize(statisticId)}`;
                var totalId = `total${capitalize(statisticId)}`;

                if (typeof statistics[highestId][`grid${configuration.gridSize}`] == "undefined") {
                    statistics[highestId][`grid${configuration.gridSize}`] = 0;
                }
                if (userStatisticsIds[statisticId].total) {
                    if (typeof statistics[totalId][`grid${configuration.gridSize}`] == "undefined") {
                        statistics[totalId][`grid${configuration.gridSize}`] = 0;
                    }
                }
            }
        }

        function startNewGame() {
            saveFullConfiguration(unApplyedConfiguration);
            resetCurrentStatistics();
            predefineUserStatistics();
            blocks = {};
            board = [];
            saves = [];
            updateUserStatisticsDOM();
            setPlayBoardStyles();
            setBlockColors();
            writePlayBoardGrid(false);
            renderPlayBoard();
            createBlock(1);
            createBlock(1);
            updateBoard(true);
            window[storage].setItem("blocks", JSON.stringify(blocks));
            window[storage].setItem("statistics", JSON.stringify(statistics));
            window[storage].setItem("saves", JSON.stringify(saves));
        }

        function getRGBvalues(RGBColor) {
            return RGBColor.match(/rgb\((\d*?), (\d*?), (\d*?)\)/);
        }

        function restoreStorage() {
            Object.assign(configuration, JSON.parse(window[storage].getItem("configuration")));
            Object.assign(blocks, JSON.parse(window[storage].getItem("blocks")));
            Object.assign(statistics, JSON.parse(window[storage].getItem("statistics")));
            Object.assign(setups, JSON.parse(window[storage].getItem("setups")));
            Object.assign(board, JSON.parse(window[storage].getItem("board")));
            Object.assign(saves, JSON.parse(window[storage].getItem("saves")));
        }

        function restoreGame() {
            updateUserStatisticsDOM();
            document.getElementById("blocks-container").innerHTML = "";
            document.getElementById("grid-container").innerHTML = "";
            setPlayBoardStyles();
            setBlockColors();
            writePlayBoardGrid(true);
            renderPlayBoard();
            statistics.hiddenBlocks = [];
            for (block in blocks) {
                restoreBlockElement(blocks[block]);
            }
            updateBoard(true);
        }

        function installApp() {
            if (typeof pwaInstallPrompt != "undefined") {
                pwaInstallPrompt.prompt();
            } else {
                alert("You can install the app from you browser action menu.");
            }
        }

        function resetStorage() {
            configuration = {shadows: false, offsetX: 0, offsetY: 0, theme: "auto", soundEffects: true, gridSize: 4, transitions: 1, boxBackground: "rgb(255, 255, 255)", boxBorderRadius: 1, boxMargin: 1, playBoardBackground: "rgb(40, 40, 40)", powerColors: ["rgb(182, 215, 168)", "rgb(147, 196, 125)", "rgb(106, 168, 79)", "rgb(234, 153, 153)", "rgb(224, 102, 102)", "rgb(204, 0, 0)", "rgb(159, 197, 232)", "rgb(111, 168, 220)", "rgb(61, 133, 198)", "rgb(249, 203, 156)", "rgb(246, 178, 107)", "rgb(230, 145, 56)", "rgb(180, 167, 214)", "rgb(142, 124, 195)", "rgb(103, 78, 167)", "rgb(183, 183, 183)", "rgb(153, 153, 153)", "rgb(102, 102, 102)"]};
            setups = [{name: "Default", id: getRandomId(4), configuration: structuredClone(configuration)}];
            setups.push({name: "Spectral", id: getRandomId(4), configuration: {shadows: false, offsetX: 0, offsetY: 0, theme: "auto", soundEffects: true, gridSize: 4, transitions: 1, boxBackground: "rgb(255, 255, 255)", boxBorderRadius: 1, boxMargin: 1, playBoardBackground: "rgb(40, 40, 40)", powerColors: ["rgb(175, 106, 106)", "rgb(175, 129, 106)", "rgb(175, 152, 106)", "rgb(175, 175, 106)", "rgb(152, 175, 106)", "rgb(129, 175, 106)", "rgb(106, 175, 106)", "rgb(106, 175, 129)", "rgb(106, 175, 152)", "rgb(106, 175, 175)", "rgb(106, 152, 175)", "rgb(106, 129, 175)", "rgb(106, 106, 175)", "rgb(129, 106, 175)", "rgb(152, 106, 175)", "rgb(175, 106, 175)", "rgb(175, 106, 152)", "rgb(175, 106, 129)"]}});
            window[storage].setItem("configuration", JSON.stringify(configuration));
            window[storage].setItem("setups", JSON.stringify(setups));
            defineBaseUserStatistics();
        }

        function writePlayBoardGrid(restore) {
            document.getElementById("blocks-container").innerHTML = "";
            document.getElementById("grid-container").innerHTML = "";
            var gridContainer = document.getElementById("grid-container");

            for (row = 0; row < configuration.gridSize; row++) {
                if (!restore) {
                    board[row] = [];
                }
                var rowElement = document.createElement("div");
                rowElement.id = `row${row}`;
                gridContainer.appendChild(rowElement);
                for (column = 0; column < configuration.gridSize; column++) {
                    if (!restore) {
                        board[row][column] = null;
                    }
                    var boxElement = document.createElement("div");
                    boxElement.id = `box-${row}-${column}`;
                    boxElement.setAttribute("class", "box");
                    rowElement.appendChild(boxElement);
                }
            }
        }

        function setPlayBoardStyles() {
            if (configuration.shadows) {
                cssVariables.style.setProperty("--play-board-shadows", "5px -5px 8px 0px rgba(0,0,0,0.35)");
            } else {
                cssVariables.style.setProperty("--play-board-shadows", "none");
            }
            cssVariables.style.setProperty("--box-background", `${configuration.boxBackground}`);
            cssVariables.style.setProperty("--play-board-background", `${configuration.playBoardBackground}`);
            cssVariables.style.setProperty("--block-transitions", `top ${120*configuration.transitions}ms ease-in-out, left ${120*configuration.transitions}ms ease-in-out, transform ${120*configuration.transitions}ms ease-in-out, background-color ${240*configuration.transitions}ms ease-in-out, color ${240*configuration.transitions}ms ease-in-out`);
        }

        function getBlockId(row, column) {
            if (typeof board[row] != "undefined") {
                if (typeof board[row][column] != "undefined") {
                    block = board[row][column];
                } else {
                    block = null;
                }
            } else {
                block = null;
            }
            return block;
        }

        function checkMoveOptions(row, column, direction) {
            var canMove = false;
            var powerUp = false;
            var localBlock = getBlockId(row, column);
            var obstructingBlock = null;
            var moveSteps = 1;
            if (localBlock != null) {
                while (obstructingBlock == null && ((direction == "right" && moveSteps+column < configuration.gridSize) || (direction == "up" && row-moveSteps >= 0) || (direction == "left" && column-moveSteps >= 0) || (direction == "down" && moveSteps+row < configuration.gridSize))) {
                    switch (direction) {
                        case "right":
                            obstructingBlock = getBlockId(row, column+moveSteps);
                            break;
                        case "up":
                            obstructingBlock = getBlockId(row-moveSteps, column);
                            break;
                        case "left":
                            obstructingBlock = getBlockId(row, column-moveSteps);
                            break;
                        case "down":
                            obstructingBlock = getBlockId(row+moveSteps, column);
                            break;
                        default:
                            break;
                    }
                    moveSteps++;
                }
                if (obstructingBlock != null) {
                    if (blocks[obstructingBlock].power == blocks[localBlock].power) {
                        canMove = true;
                        powerUp = true;
                    } else if (moveSteps > 2) {
                        canMove = true;
                        moveSteps--;
                    }
                } else if (moveSteps > 1) {
                    canMove = true;
                }
            }
            return [canMove, localBlock, obstructingBlock, powerUp, direction, moveSteps];
        }

        function decideBlockMove(row, column, direction) {
            var moveOptions = checkMoveOptions(row, column, direction);
            if (moveOptions[0]) {
                move.moves++;
                moveSingleBlock(moveOptions[1], moveOptions[2], moveOptions[3], moveOptions[4], moveOptions[5]);
            }
        }

        function checkLostGame() {
            var lostGame = true;
            ["right", "up", "left", "down"].forEach((direction) => {
                for (column = 0; column < configuration.gridSize; column ++) {
                    for (row = 0; row < configuration.gridSize; row++) {
                        if (checkMoveOptions(row, column, direction)[0]) {
                            lostGame = false;
                        }
                    }
                }
            });
            return lostGame;
        }

        function updateSaves() {
            if (saves.length > 2) {
                saves.splice(0, 1);
            }
            saves.push({blocks: structuredClone(JSON.parse(JSON.stringify(blocks))), board: structuredClone(board), statistics: structuredClone(JSON.parse(JSON.stringify(statistics)))});
            window[storage].setItem("saves", JSON.stringify(saves));
        }

        function moveBlocks(direction) {
            updateSaves();
            move.moves = 0;
            switch (direction) {
                case "right":
                    for (column = configuration.gridSize-2; column >= 0; column--) {
                        for (row = 0; row < configuration.gridSize; row++) {
                            decideBlockMove(row, column, direction);
                        }
                    }
                    break;
                case "up":
                    for (row = 1; row < configuration.gridSize; row++) {
                        for (column = 0; column < configuration.gridSize; column++) {
                            decideBlockMove(row, column, direction);
                        }
                    }
                    break;
                case "left":
                    for (column = 1; column < configuration.gridSize; column++) {
                        for (row = configuration.gridSize-1; row >= 0; row--) {
                            decideBlockMove(row, column, direction);
                        }
                    }
                    break;
                case "down":
                    for (row = configuration.gridSize-2; row >= 0; row--) {
                        for (column = configuration.gridSize-1; column >= 0; column--) {
                            decideBlockMove(row, column, direction);
                        }
                    }
                    break;
                default:
                    break;
            }
            if (move.moves > 0) {
                updateBlockElement(createBlock(1));

                var previousValue = statistics.moves;
                statistics.moves++;
                updateUserStatistics("moves", previousValue);
            } else if (configuration.soundEffects) {
                stuckAudioEffect.play();
                saves.pop();
            }

            // save current game state into storage
            window[storage].setItem("blocks", JSON.stringify(blocks));
            window[storage].setItem("board", JSON.stringify(board));
            window[storage].setItem("statistics", JSON.stringify(statistics));

            if (checkLostGame()) {
                showToast("you are stuck", `<svg xmlns="http://www.w3.org/2000/svg" height="30px" viewBox="0 0 24 24" width="30px" fill=var(--text-color)><path d="M0 0h24v24H0V0z" fill="none"/><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zM4 12c0-4.42 3.58-8 8-8 1.85 0 3.55.63 4.9 1.69L5.69 16.9C4.63 15.55 4 13.85 4 12zm8 8c-1.85 0-3.55-.63-4.9-1.69L18.31 7.1C19.37 8.45 20 10.15 20 12c0 4.42-3.58 8-8 8z"/></svg>`);
            }
        }

        function updateUserStatistics(statisticId, previousValue) {
            var highestId = `highest${capitalize(statisticId)}`;
            var totalId = `total${capitalize(statisticId)}`;

            if (statistics[statisticId] > statistics[highestId].grid) {
                statistics[highestId].grid = statistics[statisticId];

                if (statisticId == "highestPower" && statistics[statisticId] >= 128) {
                    showToast(`new block discovered!: ${statistics[statisticId]}`, `<svg xmlns="http://www.w3.org/2000/svg" height="30px" viewBox="0 0 24 24" width="30px" fill="var(--text-color)"><path d="M0 0h24v24H0V0z" fill="none"></path><path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V5h14v14zm-4-4h-4v-2h2c1.1 0 2-.89 2-2V9c0-1.11-.9-2-2-2H9v2h4v2h-2c-1.1 0-2 .89-2 2v4h6v-2z"></path></svg>`);
                }
            }
            if (statistics[statisticId] > statistics[highestId][`grid${configuration.gridSize}`]) {
                statistics[highestId][`grid${configuration.gridSize}`] = statistics[statisticId];
            }
            if (userStatisticsIds[statisticId].total) {
                statistics[totalId].grid += (statistics[statisticId] - previousValue);
                statistics[totalId][`grid${configuration.gridSize}`] += (statistics[statisticId] - previousValue);
            }
        }

        function updateUserStatisticsDOM() {
            for (statisticId in userStatisticsIds) {
                var highestId = `highest${capitalize(statisticId)}`;
                var totalId = `total${capitalize(statisticId)}`;

                document.getElementById(`game-${statisticId}-value`).innerHTML = Math.round(statistics[statisticId]);
                if (!statistics.ignoreGridSize) {
                    document.getElementById(`game-${highestId}-value`).innerHTML = Math.round(statistics[highestId][`grid${configuration.gridSize}`]);
                } else {
                    document.getElementById(`game-${highestId}-value`).innerHTML = Math.round(statistics[highestId].grid);
                }
                if (userStatisticsIds[statisticId].total) {
                    if (!statistics.ignoreGridSize) {
                        document.getElementById(`game-${totalId}-value`).innerHTML = Math.round(statistics[totalId][`grid${configuration.gridSize}`]);
                    } else {
                        document.getElementById(`game-${totalId}-value`).innerHTML = Math.round(statistics[totalId].grid);
                    }
                }
            }
        }

        function moveSingleBlock(localBlock, obstructingBlock, powerUp, direction, moveSteps) {

            board[blocks[localBlock].row][blocks[localBlock].column] = null;
            
            if (powerUp) {
                blocks[obstructingBlock].power++;

                if (2 ** blocks[obstructingBlock].power > statistics.highestPower) {
                    var previousValue = statistics.highestPower;
                    statistics.highestPower = 2 ** blocks[obstructingBlock].power;
                    updateUserStatistics("highestPower", previousValue);
                }

                var previousValue = statistics.blocksPowered;
                statistics.blocksPowered++;
                updateUserStatistics("blocksPowered", previousValue);

                var previousValue = statistics.score;
                statistics.score += 2 ** blocks[obstructingBlock].power;
                updateUserStatistics("score", previousValue);
                
                blocks[obstructingBlock].transforms[0] = "scale(1.2)";
                blocks[obstructingBlock].element.style.setProperty("transform", blocks[obstructingBlock].transforms[0] + " " + blocks[obstructingBlock].transforms[1]);
                blocks[localBlock].element.style.setProperty("z-index", 0);
                blocks[localBlock].transforms[0] = "scale(0)";
                blocks[localBlock].element.style.setProperty("transform", blocks[localBlock].transforms[0] + " " + blocks[localBlock].transforms[1]);

                blocks[obstructingBlock].element.style.setProperty("background-color", `var(--power${blocks[obstructingBlock].power}-color)`);
                blocks[obstructingBlock].element.style.setProperty("color", getReadableTextColor(configuration.powerColors[blocks[obstructingBlock].power-1]));

                move.powerUpBlockPairs.push({localBlock: blocks[localBlock], obstructingBlock: blocks[obstructingBlock]});
                statistics.blocksToRemove.push(blocks[localBlock]);

                setTimeout(function() {
                    var powerUpBlockPair = move.powerUpBlockPairs[0];
                    updateBlockElement(powerUpBlockPair.obstructingBlock);
                    powerUpBlockPair.obstructingBlock.transforms[0] = "scale(1)";
                    powerUpBlockPair.obstructingBlock.element.style.setProperty("transform", powerUpBlockPair.obstructingBlock.transforms[0] + " " + powerUpBlockPair.obstructingBlock.transforms[1]);
                    removeBlock(powerUpBlockPair.localBlock);
                    move.powerUpBlockPairs.splice(0, 1);
                    statistics.blocksToRemove.splice(0, 1);
                }, 120 * configuration.transitions + 10);

                setTimeout(function() {
                    if (configuration.soundEffects) {
                        joinAudioEffect.play();
                    }
                }, (Math.max(120*configuration.transitions)-80, 0));

            }

            switch (direction) {
                case "right":
                    blocks[localBlock].column += moveSteps-1;
                    break;
                case "up":
                    blocks[localBlock].row -= moveSteps-1;
                    break;
                case "left":
                    blocks[localBlock].column -= moveSteps-1;
                    break;
                case "down":
                    blocks[localBlock].row += moveSteps-1;
                    break;
                default:
                    break;
            }

            if (!powerUp) {
                board[blocks[localBlock].row][blocks[localBlock].column] = blocks[localBlock].id;
            }

            updateBlockElement(blocks[localBlock]);
            
        }

        function capitalize(string) {
            return string.substring(0, 1).toUpperCase() + string.substring(1, string.length); 
        }

        function removeBlock(block) {
            removeBlockElement(block);
            delete blocks[block.id];
            window[storage].setItem("blocks", JSON.stringify(blocks));
        }

        function removeBlockElement(block, transition = false) {
            try {
                var blockElement = block.element;
            } catch (error) {
                var blockElement = document.getElementById(`block-${block.id}`);
            }
            if (transition) {
                block.transforms[0] = "scale(0)";
                block.element.style.setProperty("transform", block.transforms[0] + " " + block.transforms[1]);
                setTimeout(function() {
                    blockElement.remove();
                }, 120 * configuration.transitions + 10);
            } else {
                blockElement.remove();
            }
        }

        function getReadableTextColor(backgroundRGB) {

            var backgroundRGB = getRGBvalues(backgroundRGB);
            var R = backgroundRGB[1]*1;
            var G = backgroundRGB[2]*1;
            var B = backgroundRGB[3]*1;

            if (R <= 10) {
                var Rg = R / 3294;
            } else {
                var Rg = (R / 269 + 0.0513) ** 2.4;
            }

            if (G <= 10) {
                var Gg = G / 3294;
            } else {
                var Gg = (G / 269 + 0.0513) ** 2.4;
            }

            if (B <= 10) {
                var Bg = B / 3294;
            } else {
                var Bg = B / (269 + 0.0513) ** 2.4;
            }

            var relativeLumninance = 0.2126 * Rg + 0.7152 * Gg + 0.0722 * Bg;
            if (relativeLumninance < 0.5) return "white";
            else return "black";

        }

        function createBlock(power) {

            blockId = getRandomId(4);
            do {
                var startRow = getRandomNumber(0, configuration.gridSize-1);
                var startColumn = getRandomNumber(0, configuration.gridSize-1);
            }
            while (getBlockId(startRow, startColumn) != null);

            board[startRow][startColumn] = blockId;
            window[storage].setItem("board", JSON.stringify(board));

            var blockElement = document.createElement("div");
            blockElement.id = `block-${blockId}`;
            blockElement.setAttribute("class", "block");

            var boxFromSide = getBoxFromSide(startRow, startColumn);
            var halfBoxSize = cssVariables.style.getPropertyValue("--box-size").replace("px", "")/2;
            var transforms = ["scale(0)", `translate(${boxFromSide[0]}px, ${boxFromSide[1]}px)`];
            blockElement.style.setProperty("transform", transforms[0] + " " + transforms[1]);
            blockElement.style.setProperty("transform-origin", `${(boxFromSide[0]+halfBoxSize)}px ${(boxFromSide[1]+halfBoxSize)}px`);
            blockElement.style.setProperty("color", getReadableTextColor(configuration.powerColors[power-1]));

            document.getElementById("blocks-container").appendChild(blockElement);

            blocks[blockId] = {id: blockId, row: startRow, column: startColumn, power: power, element: blockElement, transforms: transforms};

            statistics.hiddenBlocks.push(blocks[blockId]);
            setTimeout(function() {
                statistics.hiddenBlocks[0].transforms[0] = "scale(1)";
                statistics.hiddenBlocks[0].element.style.setProperty("transform",  statistics.hiddenBlocks[0].transforms[0] + " " + statistics.hiddenBlocks[0].transforms[1]);
                statistics.hiddenBlocks.splice(0, 1);
            }, 50);

            var previousValue = statistics.blocksCreated;
            statistics.blocksCreated++;
            updateUserStatistics("blocksCreated", previousValue);
            return blocks[blockId];

        }

        function undoBlockMove() {
            if (saves.length >= 1 && statistics.blockMovesUndoed < 3) {
                if (configuration.soundEffects) {
                    undoAudioEffect.play();
                }

                var previousBlocks = structuredClone(JSON.parse(JSON.stringify(blocks)));

                // restore old global objects
                blocks = {};
                Object.assign(blocks, saves[saves.length - 1].blocks);
                board = [];
                Object.assign(board, saves[saves.length - 1].board);
                var statisticsIgnoreGridSize = statistics.ignoreGridSize;
                var statisticsBlockMovesUndoed = statistics.blockMovesUndoed;
                statistics = {};
                Object.assign(statistics, saves[saves.length - 1].statistics);
                statistics.ignoreGridSize = statisticsIgnoreGridSize;
                statistics.blockMovesUndoed = statisticsBlockMovesUndoed;

                // remove block objects that weren't removed because of former ongoing transition
                for (blockToRemove of statistics.blocksToRemove) {
                    delete blocks[blockToRemove.id];
                }

                // set every block scale to normal
                for (block in blocks) {
                    blocks[block].transforms[0] = "scale(1)";
                }

                var currentBlocksIds = [];
                for (block in blocks) {
                    currentBlocksIds.push(block);
                }

                // restore element properties
                for (block in blocks) {
                    blocks[block].element = document.getElementById(`block-${block}`);
                }

                // remove blocks created in future
                for (blockId in previousBlocks) {
                    if (!currentBlocksIds.includes(blockId)) {
                        previousBlocks[blockId].element = document.getElementById(`block-${blockId}`);
                        removeBlockElement(previousBlocks[blockId], true);
                    }
                }

                // restore blocks removed in past
                for (blockId in blocks) {
                    if (!previousBlocks.hasOwnProperty(blockId)) {
                        restoreBlockElement(blocks[blockId]);
                    }
                }

                saves.splice(saves.length - 1);
                updateBoard(true);
                statistics.blockMovesUndoed++;

                window[storage].setItem("blocks", JSON.stringify(blocks));
                window[storage].setItem("statistics", JSON.stringify(statistics));
                window[storage].setItem("saves", JSON.stringify(saves));
                window[storage].setItem("board", JSON.stringify(board));
            } else if (statistics.moves != 0) {
                showToast("You reached undo limit", `<svg xmlns="http://www.w3.org/2000/svg" height="30px" viewBox="0 0 24 24" width="30px" fill=var(--text-color)><path d="M0 0h24v24H0V0z" fill="none"/><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zM4 12c0-4.42 3.58-8 8-8 1.85 0 3.55.63 4.9 1.69L5.69 16.9C4.63 15.55 4 13.85 4 12zm8 8c-1.85 0-3.55-.63-4.9-1.69L18.31 7.1C19.37 8.45 20 10.15 20 12c0 4.42-3.58 8-8 8z"/></svg>`);
            }
        }

        function restoreBlockElement(block) {

            var blockElement = document.createElement("div");
            block.element = blockElement;
            blockElement.id = `block-${block.id}`;
            blockElement.setAttribute("class", "block");

            var boxFromSide = getBoxFromSide(block.row, block.column);
            var halfBoxSize = cssVariables.style.getPropertyValue("--box-size").replace("px", "")/2;
            var transforms = ["scale(0)", `translate(${boxFromSide[0]}px, ${boxFromSide[1]}px)`];
            blockElement.style.setProperty("transform", transforms[0] + " " + transforms[1]);
            blockElement.style.setProperty("transform-origin", `${(boxFromSide[0]+halfBoxSize)}px ${(boxFromSide[1]+halfBoxSize)}px`);
            blockElement.style.setProperty("background-color", `var(--power${block.power}-color)`);
            blockElement.style.setProperty("color", getReadableTextColor(configuration.powerColors[block.power-1]));

            document.getElementById("blocks-container").appendChild(blockElement);

            statistics.hiddenBlocks.push(block);
            setTimeout(function() {
                statistics.hiddenBlocks[0].transforms[0] = "scale(1)";
                statistics.hiddenBlocks[0].element.style.setProperty("transform", statistics.hiddenBlocks[0].transforms[0] + " " + statistics.hiddenBlocks[0].transforms[1]);
                statistics.hiddenBlocks.splice(0, 1);
            }, 10);

            return block;
            
        }

        function getBoxFromSide(row, column) {
            var originalBoxScale = cssVariables.style.getPropertyValue("--box-scale");
            cssVariables.style.setProperty("--box-scale", "scale(1)");
            var boxFromLeft = ((document.getElementById(`box-${row}-${column}`).getBoundingClientRect().left + scrollX) * 1 - (document.getElementById(`play-board`).getBoundingClientRect().left*1 + scrollX*1) - (cssVariables.style.getPropertyValue("--box-margin").replace("px", "")) * 1) + configuration.offsetX;
            var boxFromTop = ((document.getElementById(`box-${row}-${column}`).getBoundingClientRect().top + scrollY) * 1 - (document.getElementById(`play-board`).getBoundingClientRect().top*1 + scrollX*1) - (cssVariables.style.getPropertyValue("--box-margin").replace("px", "")) * 1) + configuration.offsetY;
            cssVariables.style.setProperty("--box-scale", originalBoxScale);
            return [boxFromLeft, boxFromTop];
        }

        function updateBoard(transitions = true) {

            if (!transitions) {
                setTimeout(function() {
                    cssVariables.style.setProperty("--block-transitions", `top 0 ease-in-out, left 0 ease-in-out, transform 0 ease-in-out, background-color 0 ease-in-out, color 0 ease-in-out`);
                }, 10);
                var timeout = 10;
            } else {
                var timeout = 0;
            }

            setTimeout(function() {
                for (block in blocks) {
                    updateBlockElement(blocks[block]);
                }
            }, timeout);

            if (!transitions) {
                setTimeout(function() {
                    cssVariables.style.setProperty("--block-transitions", `top ${120*configuration.transitions}ms ease-in-out, left ${120*configuration.transitions}ms ease-in-out, transform ${120*configuration.transitions}ms ease-in-out, background-color ${240*configuration.transitions}ms ease-in-out, color ${240*configuration.transitions}ms ease-in-out`);
                }, 10);
            }

        }

        function updateBlockElement(block) {

            var boxFromSide = getBoxFromSide(block.row, block.column);
            var halfBoxSize = cssVariables.style.getPropertyValue("--box-size").replace("px", "")/2;

            block.element.style.setProperty("transform-origin", `${(boxFromSide[0]+halfBoxSize)}px ${(boxFromSide[1]+halfBoxSize)}px`);
            block.transforms[1] = `translate(${boxFromSide[0]}px, ${boxFromSide[1]}px)`;
            block.element.style.setProperty("transform", block.transforms[0] + " " + block.transforms[1]);
            block.element.innerHTML = 2 ** block.power;
            block.element.style.setProperty("background-color", `var(--power${block.power}-color)`);
            block.element.style.setProperty("color", getReadableTextColor(configuration.powerColors[block.power-1]));

            if (block.power > 9) {
                var powerText = 2 ** block.power + "";
                var blockFontSize = cssVariables.style.getPropertyValue("--block-font-size").replace("px", "") * 1;
                block.element.style.setProperty("font-size", `${blockFontSize / powerText.length * 3}px`);
            }

        }

        function getRandomNumber(from, to) {
            var number = Math.round((Math.random() * (to + 1 - from)) + (from - 0.5)) * 1;
            if (number == -0) number = 0;
            return number;
        }

        // https://github.com/john-doherty/swiped-events
        (function (window, document) {

            'use strict';

            // patch CustomEvent to allow constructor creation (IE/Chrome)
            if (typeof window.CustomEvent !== 'function') {

                window.CustomEvent = function (event, params) {

                    params = params || { bubbles: false, cancelable: false, detail: undefined };

                    var evt = document.createEvent('CustomEvent');
                    evt.initCustomEvent(event, params.bubbles, params.cancelable, params.detail);
                    return evt;
                };

                window.CustomEvent.prototype = window.Event.prototype;
            }

            document.addEventListener('touchstart', handleTouchStart, false);
            document.addEventListener('touchmove', handleTouchMove, false);
            document.addEventListener('touchend', handleTouchEnd, false);

            var xDown = null;
            var yDown = null;
            var xDiff = null;
            var yDiff = null;
            var timeDown = null;
            var startEl = null;

            /**
             * Fires swiped event if swipe detected on touchend
             * @param {object} e - browser event object
             * @returns {void}
             */
            function handleTouchEnd(e) {

                // if the user released on a different target, cancel!
                if (startEl !== e.target) return;

                var swipeThreshold = parseInt(getNearestAttribute(startEl, 'data-swipe-threshold', '20'), 10); // default 20px
                var swipeTimeout = parseInt(getNearestAttribute(startEl, 'data-swipe-timeout', '500'), 10);    // default 500ms
                var timeDiff = Date.now() - timeDown;
                var eventType = '';
                var changedTouches = e.changedTouches || e.touches || [];

                if (Math.abs(xDiff) > Math.abs(yDiff)) { // most significant
                    if (Math.abs(xDiff) > swipeThreshold && timeDiff < swipeTimeout) {
                        if (xDiff > 0) {
                            eventType = 'swiped-left';
                        }
                        else {
                            eventType = 'swiped-right';
                        }
                    }
                }
                else if (Math.abs(yDiff) > swipeThreshold && timeDiff < swipeTimeout) {
                    if (yDiff > 0) {
                        eventType = 'swiped-up';
                    }
                    else {
                        eventType = 'swiped-down';
                    }
                }

                if (eventType !== '') {

                    var eventData = {
                        dir: eventType.replace(/swiped-/, ''),
                        touchType: (changedTouches[0] || {}).touchType || 'direct',
                        xStart: parseInt(xDown, 10),
                        xEnd: parseInt((changedTouches[0] || {}).clientX || -1, 10),
                        yStart: parseInt(yDown, 10),
                        yEnd: parseInt((changedTouches[0] || {}).clientY || -1, 10)
                    };

                    // fire `swiped` event event on the element that started the swipe
                    startEl.dispatchEvent(new CustomEvent('swiped', { bubbles: true, cancelable: true, detail: eventData }));

                    // fire `swiped-dir` event on the element that started the swipe
                    startEl.dispatchEvent(new CustomEvent(eventType, { bubbles: true, cancelable: true, detail: eventData }));
                }

                // reset values
                xDown = null;
                yDown = null;
                timeDown = null;
            }

            /**
             * Records current location on touchstart event
             * @param {object} e - browser event object
             * @returns {void}
             */
            function handleTouchStart(e) {

                // if the element has data-swipe-ignore="true" we stop listening for swipe events
                if (e.target.getAttribute('data-swipe-ignore') === 'true') return;

                startEl = e.target;

                timeDown = Date.now();
                xDown = e.touches[0].clientX;
                yDown = e.touches[0].clientY;
                xDiff = 0;
                yDiff = 0;
            }

            /**
             * Records location diff in px on touchmove event
             * @param {object} e - browser event object
             * @returns {void}
             */
            function handleTouchMove(e) {

                if (!xDown || !yDown) return;

                var xUp = e.touches[0].clientX;
                var yUp = e.touches[0].clientY;

                xDiff = xDown - xUp;
                yDiff = yDown - yUp;
            }

            /**
             * Gets attribute off HTML element or nearest parent
             * @param {object} el - HTML element to retrieve attribute from
             * @param {string} attributeName - name of the attribute
             * @param {any} defaultValue - default value to return if no match found
             * @returns {any} attribute value or defaultValue
             */
            function getNearestAttribute(el, attributeName, defaultValue) {

                // walk up the dom tree looking for attributeName
                while (el && el !== document.documentElement) {

                    var attributeValue = el.getAttribute(attributeName);

                    if (attributeValue) {
                        return attributeValue;
                    }

                    el = el.parentNode;
                }

                return defaultValue;
            }

        }(window, document));

    </script>

</html>
